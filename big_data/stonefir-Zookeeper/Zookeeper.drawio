<mxfile host="65bd71144e">
    <diagram id="oeAwX8FV1f2qziCl02cy" name="Page-1">
        <mxGraphModel dx="1614" dy="790" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="850" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="4" value="实现" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="2" target="3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;fillColor=#ffe6cc;strokeColor=#d79b00;dashed=1;strokeWidth=2;" parent="1" source="2" target="6" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="2" value="CuratorFrameworkImpl" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
                    <mxGeometry x="290" y="260" width="190" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="3" value="CuratorFramework:&lt;br&gt;官方注释: zk风格的client" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="290" y="150" width="190" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;dashed=1;" parent="1" source="6" target="39" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="6" value="构造器(builder)&lt;br&gt;1. 创建一个watcher, 并创建一个client&lt;br&gt;2. 创建很多其他的...." style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="270" y="360" width="230" height="160" as="geometry"/>
                </mxCell>
                <mxCell id="15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" source="10" target="16" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="10" value="CuratorZookeeperClient" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
                    <mxGeometry x="630" y="340" width="190" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="11" value="Watcher:匿名内部" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="560" y="490" width="110" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeWidth=2;" parent="1" source="12" target="10" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="12" value="Client" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="520" y="290" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;fillColor=#ffe6cc;strokeColor=#d79b00;dashed=1;strokeWidth=2;" parent="1" source="2" target="12" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="395" y="330" as="sourcePoint"/>
                        <mxPoint x="395" y="370" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeWidth=2;" parent="1" source="16" target="11" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeWidth=1;" parent="1" source="16" target="23" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="26" value="装填&lt;br&gt;进去" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="25" vertex="1" connectable="0">
                    <mxGeometry x="-0.1229" y="-1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="16" value="watcher" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="580" y="440" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeWidth=2;" parent="1" source="19" target="21" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="19" value="state" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="770" y="440" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" source="10" target="19" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="735.0344827586207" y="410" as="sourcePoint"/>
                        <mxPoint x="675" y="450" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="48" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeWidth=2;dashed=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" source="21" target="41" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="21" value="ConnectionState: 也是一个watcher" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
                    <mxGeometry x="750" y="500" width="110" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="23" value="parentWatchers" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="710" y="560" width="90" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" source="21" target="23" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="735.0344827586207" y="410" as="sourcePoint"/>
                        <mxPoint x="815" y="450" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="27" value="process(event)&lt;br&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="780" y="750" width="230" height="160" as="geometry"/>
                </mxCell>
                <mxCell id="37" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeWidth=2;" parent="1" source="29" target="31" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="29" value="stateHolder" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="880" y="505" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="31" value="StateHolder:&lt;br&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1030" y="500" width="110" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="32" value="zkFactory" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="1000" y="580" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="54" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeWidth=1;" parent="1" source="33" target="51" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="55" value="设进去&lt;br&gt;watcher" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="54" vertex="1" connectable="0">
                    <mxGeometry x="0.2193" y="1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="33" value="watcher: connectionState" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="1090" y="580" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="35" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" source="31" target="32" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="815.0344827586207" y="562.5" as="sourcePoint"/>
                        <mxPoint x="765" y="582.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" source="31" target="33" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1095.034482758621" y="587.5" as="sourcePoint"/>
                        <mxPoint x="1055.034482758621" y="607.5344827586207" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" source="29" target="21" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="815.0344827586207" y="550" as="sourcePoint"/>
                        <mxPoint x="765" y="570" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeWidth=2;strokeColor=#FF0000;" parent="1" source="39" target="41" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="43" value="1. 启动zkCli" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="42" vertex="1" connectable="0">
                    <mxGeometry x="-0.7588" y="1" relative="1" as="geometry">
                        <mxPoint x="16" y="1" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="39" value="start()&lt;br&gt;一直call大家的start()方法&lt;br&gt;1. 最终启动zkClient路径" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="270" y="570" width="230" height="160" as="geometry"/>
                </mxCell>
                <mxCell id="49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" source="41" target="27" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="56" value="3.拜托holder&lt;br&gt;创建zk" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" parent="1" source="41" target="51" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="41" value="reset()&lt;br&gt;1. 清理计数器什么的&lt;br&gt;2. 调用holder.clearAndReset, 创建一个新的helper&lt;br&gt;3. 调用holder.getZookeeper, 会让helper从zkFactory里面创建一个新的zk." style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="690" y="610" width="230" height="90" as="geometry"/>
                </mxCell>
                <mxCell id="52" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" source="47" target="51" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="47" value="helper:&lt;br&gt;装着zk, 和连接url" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="1085" y="630" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="50" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" source="33" target="47" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1085.034482758621" y="570" as="sourcePoint"/>
                        <mxPoint x="1135" y="590" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="51" value="Zookeeper" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="1090" y="690" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="57" value="CuratorCacheImpl" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
                    <mxGeometry x="280" y="890" width="190" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="59" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endArrow=none;endFill=0;strokeWidth=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="58" target="2" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="230" y="1005"/>
                            <mxPoint x="230" y="290"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="58" value="Client" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="280" y="990" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="60" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;dashed=1;" parent="1" source="57" target="58" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="395" y="530" as="sourcePoint"/>
                        <mxPoint x="395" y="580" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="67" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" parent="1" source="61" target="63" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="61" value="addListener(CuratorCacheListener):&lt;br&gt;把listenr添加到container里面" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="260" y="1040" width="230" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="62" value="listenerManager" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="410" y="990" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="63" value="container:&lt;br&gt;容器" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="510" y="990" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="65" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;dashed=1;" parent="1" source="57" target="62" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="385" y="960" as="sourcePoint"/>
                        <mxPoint x="325" y="1000" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="66" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;dashed=1;" parent="1" source="62" target="63" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="385" y="960" as="sourcePoint"/>
                        <mxPoint x="455" y="1000" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="68" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;dashed=1;" parent="1" source="57" target="61" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="385.02857142857147" y="960" as="sourcePoint"/>
                        <mxPoint x="325" y="1000" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="69" value="persistentWatcher" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="595" y="1040" width="100" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="71" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;dashed=1;" parent="1" source="57" target="69" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="385.0344827586207" y="960" as="sourcePoint"/>
                        <mxPoint x="455" y="1000" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="72" value="listeners: list" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="570" y="1110" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="74" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;dashed=1;" parent="1" source="69" target="72" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="655" y="950" as="sourcePoint"/>
                        <mxPoint x="655" y="1050" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="76" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#FF0000;strokeWidth=1;" parent="1" source="75" target="72" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="75" value="processEvent匿名类" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="570" y="1165" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="78" value="resetListeners:list" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="660" y="1110" width="90" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="79" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;dashed=1;" parent="1" source="69" target="78" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="655" y="1090" as="sourcePoint"/>
                        <mxPoint x="645" y="1110" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="81" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#FF0000;strokeWidth=1;" parent="1" source="80" target="78" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="82" value="设进去" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#FF0000;strokeWidth=1;" parent="1" source="80" target="78" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="88" value="curator连接好了" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#FF0000;strokeWidth=1;" parent="1" source="80" target="86" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="80" value="resetListner:&lt;br&gt;重置cache" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="670" y="1165" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="83" value="processBackgroundOpeartion(operationAndData)&lt;br&gt;巴拉巴拉, 没看到线程池, 反复串联的调用, 看不太懂" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="750" y="980" width="290" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="89" value="等连接好了&lt;br&gt;就干活" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeColor=#FF0000;strokeWidth=1;" parent="1" source="84" target="86" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="84" value="start():&amp;nbsp;&lt;br&gt;1. 会调用persistentWatcher的start()-&amp;gt;watcher会监听CuratorFramework的connectionState的事件, 一旦连接建立, 就reset(初始化)" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="255" y="1145" width="240" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="93" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#FF0000;strokeWidth=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="86" target="62" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="95" value="事件来了" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="93" vertex="1" connectable="0">
                    <mxGeometry x="-0.7133" y="-3" relative="1" as="geometry">
                        <mxPoint x="-19" y="3" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="96" value="包装callback执行" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeWidth=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="86" target="83" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="86" value="reset():&amp;nbsp;&lt;br&gt;1. 这里转转转, 还创建了operation什么的, &lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;最终会注册到zkClient上一个路径事件&lt;/font&gt;&lt;/b&gt;&lt;br&gt;-- 这里太复杂了, 只能说一旦event来了之后, 包装callback方法什么的, 最终最终会调用listenerManager的每一个方法" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="525" y="1250" width="240" height="130" as="geometry"/>
                </mxCell>
                <mxCell id="87" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;dashed=1;" parent="1" source="69" target="86" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="655" y="1090" as="sourcePoint"/>
                        <mxPoint x="715" y="1120" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="90" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;dashed=1;" parent="1" source="61" target="84" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="385" y="960" as="sourcePoint"/>
                        <mxPoint x="385" y="1050" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="91" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeWidth=2;strokeColor=#FF0000;" parent="1" target="84" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="60" y="1180" as="sourcePoint"/>
                        <mxPoint x="700" y="665" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="92" value="启动对指定路径cache的监听" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="91" vertex="1" connectable="0">
                    <mxGeometry x="-0.7588" y="1" relative="1" as="geometry">
                        <mxPoint x="16" y="1" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="97" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" source="83" target="27" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="815" y="710" as="sourcePoint"/>
                        <mxPoint x="815" y="760" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram id="DPCjVYEebe5Jq4DRqgq5" name="ZK1. ZK启动过程">
        <mxGraphModel dx="1498" dy="910" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="1100" pageHeight="850" math="0" shadow="0">
            <root>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-0"/>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-1" parent="NbPgL9O8-m7nmaHf1V12-0"/>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-2" target="NbPgL9O8-m7nmaHf1V12-3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-6" value="创建, 启动" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeWidth=2;strokeColor=#FF0000;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-2" target="NbPgL9O8-m7nmaHf1V12-5" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-2" value="QuorumPeerMain:&lt;br&gt;1. 启动清理线程&lt;br&gt;2. 配置, 启动ZK peer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="390" y="250" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-12" value="定时清理" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeWidth=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-3" target="NbPgL9O8-m7nmaHf1V12-9" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-3" target="NbPgL9O8-m7nmaHf1V12-11" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-3" value="DatadirCleanup:&lt;br&gt;定时清理" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="460" y="140" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-5" target="NbPgL9O8-m7nmaHf1V12-7" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-5" value="QuorumPeer:&lt;br&gt;线程, 一个zk服务" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="670" y="270" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-14" value="4. 启动本线程" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=2;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-7" target="NbPgL9O8-m7nmaHf1V12-13" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-29" value="1. 恢复数据" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-7" target="NbPgL9O8-m7nmaHf1V12-25" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-46" value="2. 启动clientServer" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-7" target="NbPgL9O8-m7nmaHf1V12-32" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-52" value="创建选举算法&lt;br&gt;并启动" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-7" target="NbPgL9O8-m7nmaHf1V12-47" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-7" value="start()&lt;br&gt;1. 加载磁盘文件到内存&lt;span style=&quot;color: rgb(135 , 16 , 148) ; background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;zkDb&lt;/span&gt;&lt;span&gt;, 加载epoch&lt;/span&gt;&lt;br&gt;2. 启动面向client端的socket和worker, serverCnxFactory&lt;br&gt;3. 启动面向peer的leaderElection组件&lt;br&gt;4. 启动本线程" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="575" y="425" width="310" height="95" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-9" value="磁盘: dataDir" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="740" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-18" value="恢复数据" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-25" target="NbPgL9O8-m7nmaHf1V12-15" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-11" value="磁盘: dataLogDir" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="740" y="60" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-65" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-13" target="NbPgL9O8-m7nmaHf1V12-62" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-66" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-13" target="NbPgL9O8-m7nmaHf1V12-63" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-67" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-13" target="NbPgL9O8-m7nmaHf1V12-64" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-68" value="2. 选举leader" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-13" target="NbPgL9O8-m7nmaHf1V12-61" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-13" value="run()&lt;br&gt;&lt;b&gt;1. whileTrue, 按照当前peer的state来运行不同的模式&lt;br&gt;&lt;/b&gt;2. 如果是looking状态, 从leaderElection那里拿leader的vote, 存成currVote&lt;br&gt;3. 如果是observering, followering, leading状态, 分别创建出各自的组件,然后start&lt;br&gt;4. 退出各自状态时候会把组件删掉的, 不影响家庭" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="575" y="575" width="310" height="105" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-15" value="zkDb" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="910" y="277.5" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-16" value="currentEpoch&lt;br&gt;acceptedEpoch" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="1010" y="277.5" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-5" target="NbPgL9O8-m7nmaHf1V12-15" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="740" y="340" as="sourcePoint"/>
                        <mxPoint x="740" y="435" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-20" value="snapshot" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="740" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-21" target="NbPgL9O8-m7nmaHf1V12-25" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-21" value="acceptEpoch" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="870" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-22" target="NbPgL9O8-m7nmaHf1V12-25" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-22" value="currentEpoch" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="870" y="20" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-25" target="NbPgL9O8-m7nmaHf1V12-16" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-25" value="loadDataBases: 启动peer时候恢复数据" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="940" y="130" width="130" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-30" target="NbPgL9O8-m7nmaHf1V12-32" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-30" value="serverCnxFactory" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="1200" y="277.5" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-31" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-16" target="NbPgL9O8-m7nmaHf1V12-30" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="800" y="310" as="sourcePoint"/>
                        <mxPoint x="920" y="310" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-34" value="workerPool" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="1330" y="431.25" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-42" value="检查过期conn" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;startArrow=none;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-35" target="NbPgL9O8-m7nmaHf1V12-37" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-35" value="exporerThread" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="1210" y="488.75" width="80" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-36" target="NbPgL9O8-m7nmaHf1V12-37" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-36" value="acceptThread" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="1090" y="431.25" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-41" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-37" target="NbPgL9O8-m7nmaHf1V12-34" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-37" value="selectorThreads" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="1200" y="431.25" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-45" value="" style="group" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1" connectable="0">
                    <mxGeometry x="1090" y="368.75" width="320" height="151.25" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-32" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;" parent="NbPgL9O8-m7nmaHf1V12-45" vertex="1">
                    <mxGeometry y="1.25" width="320" height="150" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-43" value="&lt;span style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250); display: inline; float: none;&quot;&gt;NioServerCnxnFactory:&lt;/span&gt;&lt;br style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250);&quot;&gt;&lt;span style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250); display: inline; float: none;&quot;&gt;默认的nioserver&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;" parent="NbPgL9O8-m7nmaHf1V12-45" vertex="1">
                    <mxGeometry x="102.5" width="150" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-56" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-47" target="NbPgL9O8-m7nmaHf1V12-55" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-47" value="electionAlgorithm" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="280" y="392.25" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-58" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-48" target="NbPgL9O8-m7nmaHf1V12-57" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-48" value="quorumCnxMgr" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="130" y="431.25" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-50" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-47" target="NbPgL9O8-m7nmaHf1V12-48" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="220" y="101.25" as="sourcePoint"/>
                        <mxPoint x="310" y="101.25" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-51" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-5" target="NbPgL9O8-m7nmaHf1V12-47" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="390.0002519532677" y="413.57142857142867" as="sourcePoint"/>
                        <mxPoint x="340.0000000000001" y="449.75" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-53" value="currVote: leader" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="230" y="310" width="90" height="36.25" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-54" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-47" target="NbPgL9O8-m7nmaHf1V12-53" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="740" y="340" as="sourcePoint"/>
                        <mxPoint x="440" y="391" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-55" value="FastLeaderElection&lt;br&gt;leader选举" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="270" y="488.75" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-57" value="&lt;b&gt;QuorumCnxManager&lt;br&gt;&lt;/b&gt;peer的连接, 收发队列" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="110" y="488.75" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-59" value="&lt;font color=&quot;#ff0000&quot;&gt;start()&lt;br&gt;&lt;/font&gt;&amp;nbsp;todo" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="232.5" y="572.5" width="195" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-60" value="zkDb" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="660" y="205" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-61" value="&lt;font color=&quot;#ff0000&quot;&gt;lookForLeader()&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="232.5" y="680" width="195" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-62" value="follower" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="575" y="735" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-63" value="observer" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="690" y="735" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-64" value="leader" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="NbPgL9O8-m7nmaHf1V12-1" vertex="1">
                    <mxGeometry x="810" y="735" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-69" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-59" target="NbPgL9O8-m7nmaHf1V12-55" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="290.0002972660441" y="424.8275862068965" as="sourcePoint"/>
                        <mxPoint x="219.99994054692388" y="456.2758620689656" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="NbPgL9O8-m7nmaHf1V12-70" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="NbPgL9O8-m7nmaHf1V12-1" source="NbPgL9O8-m7nmaHf1V12-59" target="NbPgL9O8-m7nmaHf1V12-61" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="340" y="582.5" as="sourcePoint"/>
                        <mxPoint x="340" y="558.75" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram name="ZK2. Looking状态选举过程" id="jVjA85MLJJOv70pykz2O">
        <mxGraphModel grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" page="0" fold="1" pageScale="1" pageWidth="1100" pageHeight="850" math="0" shadow="0">
            <root>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-0"/>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-1" parent="UtrOZooaUX3hYhCwdXiv-0"/>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-4" target="UtrOZooaUX3hYhCwdXiv-7" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-3" value="创建, 启动" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeWidth=2;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-4" target="UtrOZooaUX3hYhCwdXiv-9" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-4" value="QuorumPeerMain:&lt;br&gt;1. 启动清理线程&lt;br&gt;2. 配置, 启动ZK peer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="390" y="250" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-5" value="定时清理" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeWidth=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-7" target="UtrOZooaUX3hYhCwdXiv-15" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-7" target="UtrOZooaUX3hYhCwdXiv-17" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-7" value="DatadirCleanup:&lt;br&gt;定时清理" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="460" y="140" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-9" target="UtrOZooaUX3hYhCwdXiv-14" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-9" value="QuorumPeer:&lt;br&gt;线程, 一个zk服务" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="670" y="270" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-10" value="4. 启动本线程" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=2;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-14" target="UtrOZooaUX3hYhCwdXiv-22" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-11" value="1. 恢复数据" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-14" target="UtrOZooaUX3hYhCwdXiv-32" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-12" value="2. 启动clientServer" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-14" target="UtrOZooaUX3hYhCwdXiv-44" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-13" value="3. 创建选举&lt;br&gt;算法组件&lt;br&gt;会start()" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeWidth=2;strokeColor=#FF0000;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-14" target="UtrOZooaUX3hYhCwdXiv-54" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-14" value="start()&lt;br&gt;1. 加载磁盘文件到内存&lt;span style=&quot;color: rgb(135 , 16 , 148) ; background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;zkDb&lt;/span&gt;&lt;span&gt;, 加载epoch&lt;/span&gt;&lt;br&gt;2. 启动面向client端的socket和worker, serverCnxFactory&lt;br&gt;&lt;b&gt;3. 初始化一张myid的选票, 启动面向peer的leaderElection组件&lt;br&gt;&lt;/b&gt;4. 启动本线程" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="575" y="425" width="310" height="95" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-15" value="磁盘: dataDir" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="740" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-16" value="恢复数据" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-32" target="UtrOZooaUX3hYhCwdXiv-23" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-17" value="磁盘: dataLogDir" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="740" y="60" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-22" target="UtrOZooaUX3hYhCwdXiv-59" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-22" target="UtrOZooaUX3hYhCwdXiv-60" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-22" target="UtrOZooaUX3hYhCwdXiv-61" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-21" value="2. 选举leader" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeWidth=2;strokeColor=#FF0000;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-22" target="UtrOZooaUX3hYhCwdXiv-58" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-22" value="run()&lt;br&gt;&lt;b&gt;1. whileTrue, 按照当前peer的state来运行不同的模式&lt;br&gt;&lt;font color=&quot;#ff0000&quot;&gt;2. 如果是looking状态&lt;/font&gt;&lt;/b&gt;, 从leaderElection那里拿leader的vote, 存成currVote&lt;br&gt;3. 如果是observering, followering, leading状态, 分别创建出各自的组件,然后start&lt;br&gt;4. 退出各自状态时候会把组件删掉的, 不影响家庭" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="575" y="575" width="310" height="105" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-23" value="zkDb" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="910" y="277.5" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-24" value="currentEpoch&lt;br&gt;acceptedEpoch" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="1010" y="277.5" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-9" target="UtrOZooaUX3hYhCwdXiv-23" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="740" y="340" as="sourcePoint"/>
                        <mxPoint x="740" y="435" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-26" value="snapshot" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="740" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-28" target="UtrOZooaUX3hYhCwdXiv-32" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-28" value="acceptEpoch" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="870" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-30" target="UtrOZooaUX3hYhCwdXiv-32" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-30" value="currentEpoch" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="870" y="20" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-31" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-32" target="UtrOZooaUX3hYhCwdXiv-24" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-32" value="loadDataBases: 启动peer时候恢复数据" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="940" y="130" width="130" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-34" target="UtrOZooaUX3hYhCwdXiv-44" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-34" value="serverCnxFactory" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="1200" y="277.5" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-35" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-24" target="UtrOZooaUX3hYhCwdXiv-34" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="800" y="310" as="sourcePoint"/>
                        <mxPoint x="920" y="310" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-36" value="workerPool" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="1330" y="431.25" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-37" value="检查过期conn" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;startArrow=none;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-38" target="UtrOZooaUX3hYhCwdXiv-42" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-38" value="exporerThread" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="1210" y="488.75" width="80" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-40" target="UtrOZooaUX3hYhCwdXiv-42" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-40" value="acceptThread" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="1090" y="431.25" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-41" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-42" target="UtrOZooaUX3hYhCwdXiv-36" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-42" value="selectorThreads" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="1200" y="431.25" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-43" value="" style="group" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1" connectable="0">
                    <mxGeometry x="1090" y="368.75" width="320" height="151.25" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-44" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;" parent="UtrOZooaUX3hYhCwdXiv-43" vertex="1">
                    <mxGeometry y="1.25" width="320" height="150" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-45" value="&lt;span style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250); display: inline; float: none;&quot;&gt;NioServerCnxnFactory:&lt;/span&gt;&lt;br style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250);&quot;&gt;&lt;span style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250); display: inline; float: none;&quot;&gt;默认的nioserver&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;" parent="UtrOZooaUX3hYhCwdXiv-43" vertex="1">
                    <mxGeometry x="102.5" width="150" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-47" target="UtrOZooaUX3hYhCwdXiv-54" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-47" value="electionAlgorithm" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="280" y="392.25" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-48" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-49" target="UtrOZooaUX3hYhCwdXiv-55" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-49" value="quorumCnxMgr" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="-80" y="488" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-50" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-54" target="UtrOZooaUX3hYhCwdXiv-49" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="220" y="101.25" as="sourcePoint"/>
                        <mxPoint x="310" y="101.25" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-51" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-9" target="UtrOZooaUX3hYhCwdXiv-47" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="390.0002519532677" y="413.57142857142867" as="sourcePoint"/>
                        <mxPoint x="340.0000000000001" y="449.75" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-52" value="currVote: leader" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="230" y="310" width="90" height="36.25" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-53" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-47" target="UtrOZooaUX3hYhCwdXiv-52" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="740" y="340" as="sourcePoint"/>
                        <mxPoint x="440" y="391" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-54" value="FastLeaderElection&lt;br&gt;leader选举" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="270" y="488.75" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-55" value="&lt;b&gt;QuorumCnxManager&lt;br&gt;&lt;/b&gt;peer的连接, 收发队列" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="-100" y="545.5" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-89" value="3. 启动" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=9;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-56" target="puGpuqbUjW5oyIaAnzhM-14" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-56" value="- 启动QCM的listener开始连peer&lt;br&gt;&lt;font color=&quot;#ff0000&quot;&gt;start()&lt;/font&gt;&lt;br&gt;1. 初始化收发组件&lt;br&gt;3. 启动ws, wr." style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="232.5" y="660" width="195" height="63" as="geometry"/>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-17" value="2. 经过sendQueue, &lt;br&gt;ws线程, 实际发送" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF0000;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-58" target="puGpuqbUjW5oyIaAnzhM-16" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-58" value="&lt;font color=&quot;#ff0000&quot;&gt;lookForLeader()&lt;/font&gt;&lt;br&gt;1. 更新自己的&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;logicalclock,&amp;nbsp;&lt;/span&gt;&lt;span&gt;proposal, 投自己.&lt;/span&gt;&lt;br&gt;2. 把自己的选票, 状态, txid, epoch, 和集群配置都发给所有peer(包括自己).&lt;br&gt;3. 阻塞拿recvQueue里面的响应的投票, 收不到就发一遍, 循环&lt;br&gt;4. 拿到一个peer的44字节信息.&lt;br&gt;4.1 如果是looking发过来的-&amp;gt;&lt;br&gt;&lt;b&gt;对方胜于自己(peerEpoch, zxid, sid)自己的选票就跟随对方. 对方弱就扔掉.&lt;br&gt;&lt;/b&gt;自己的&lt;b&gt;选票每更新一次都会sendNotifications&lt;/b&gt;给所有peer.&lt;br&gt;&lt;b&gt;统计当前的选票过半, 修改peer的状态, 清掉recvQue.&lt;/b&gt;&lt;br&gt;4.2 如果是&lt;b&gt;Follower, Leader发来的选票: 还会等待大多数响应校验一下过半机制, 还会校验一下leader(&lt;span style=&quot;color: rgb(8 , 8 , 8) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;checkLeader&lt;/span&gt;&lt;span&gt;). 修改peer状态, 清掉recvQueue&lt;/span&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="181.5" y="805" width="297" height="244" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-59" value="follower" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="575" y="735" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-60" value="observer" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="690" y="735" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-61" value="leader" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="810" y="735" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-62" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-56" target="UtrOZooaUX3hYhCwdXiv-54" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="290.0002972660441" y="424.8275862068965" as="sourcePoint"/>
                        <mxPoint x="219.99994054692388" y="456.2758620689656" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-63" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-56" target="UtrOZooaUX3hYhCwdXiv-58" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="340" y="582.5" as="sourcePoint"/>
                        <mxPoint x="340" y="558.75" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-64" value="listener: 监听3888" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="-439" y="575.5" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-66" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-55" target="UtrOZooaUX3hYhCwdXiv-64" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="147" y="479.79999999999995" as="sourcePoint"/>
                        <mxPoint x="-29" y="514" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-67" value="&lt;b&gt;QCM.Listener&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#82b366;fillColor=none;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="-459" y="634" width="120" height="40.5" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-69" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-64" target="UtrOZooaUX3hYhCwdXiv-67" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-216" y="568.5" as="sourcePoint"/>
                        <mxPoint x="-216" y="596" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-70" target="puGpuqbUjW5oyIaAnzhM-4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-3" value="2. 每个sid&lt;br&gt;都有queue和&lt;br&gt;两个worker线程" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="puGpuqbUjW5oyIaAnzhM-2" vertex="1" connectable="0">
                    <mxGeometry x="-0.1681" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-70" value="run():&lt;br&gt;大概原理: 为端口3888绑定一个handler处理, 一直监听.&lt;br&gt;&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;handleConnection(sock) :&lt;br&gt;&lt;/font&gt;&lt;/b&gt;1. &lt;b&gt;拒绝sid小的连自己&lt;/b&gt;, 遇到了, 清空sock相关收发worker, 尝试连对方.&lt;br&gt;2. sid小的, &lt;b&gt;创建sendWorker, recvWorker, 启动. 创建一个sendQueue.同步队列!&lt;br&gt;3. observer的sid递减, 负数.&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="-518" y="690" width="244" height="131" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-71" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-67" target="UtrOZooaUX3hYhCwdXiv-70" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-277" y="601" as="sourcePoint"/>
                        <mxPoint x="-349" y="600.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-55" target="puGpuqbUjW5oyIaAnzhM-4" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-89" y="601.5" as="sourcePoint"/>
                        <mxPoint x="-318" y="621" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-6" value="" style="group" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1" connectable="0">
                    <mxGeometry x="-170" y="654.5" width="82" height="101" as="geometry"/>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-4" value="" style="rounded=0;whiteSpace=wrap;html=1;align=left;strokeColor=#d79b00;dashed=1;fillColor=none;" parent="puGpuqbUjW5oyIaAnzhM-6" vertex="1">
                    <mxGeometry width="82" height="101" as="geometry"/>
                </mxCell>
                <mxCell id="UtrOZooaUX3hYhCwdXiv-72" value="senderWorker&lt;br&gt;&amp;lt;sid, SW&amp;gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="puGpuqbUjW5oyIaAnzhM-6" vertex="1">
                    <mxGeometry x="1" y="5.5" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-0" value="queueSendMap&lt;br&gt;&amp;lt;sid,&lt;b&gt;bqueue1&lt;/b&gt;&amp;gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="puGpuqbUjW5oyIaAnzhM-6" vertex="1">
                    <mxGeometry x="1" y="35.5" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-1" value="lastMsgSent&lt;br&gt;&amp;lt;sid, buff&amp;gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="puGpuqbUjW5oyIaAnzhM-6" vertex="1">
                    <mxGeometry x="1" y="65.5" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-7" value="workerSender" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="235" y="553" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-9" value="workerReceiver" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="235" y="583" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-10" value="sendQueue" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="342" y="553" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-11" value="recvQueue:" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="342" y="583" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-12" value="&lt;b&gt;WorkerSender:&lt;/b&gt;&lt;br&gt;单纯把队列拿取交给QCM发给指定sid" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="112" y="545" width="107" height="46" as="geometry"/>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="UtrOZooaUX3hYhCwdXiv-1" source="puGpuqbUjW5oyIaAnzhM-12" target="puGpuqbUjW5oyIaAnzhM-7" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-29" y="544" as="sourcePoint"/>
                        <mxPoint x="-29" y="571.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-88" value="一个peer的44字节的信息" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=9;strokeColor=#FF0000;" parent="UtrOZooaUX3hYhCwdXiv-1" source="puGpuqbUjW5oyIaAnzhM-14" target="puGpuqbUjW5oyIaAnzhM-11" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-14" value="&lt;b&gt;WorkerReceiver:&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;font color=&quot;#ff0000&quot;&gt;接收, 解析:&lt;/font&gt;&lt;br&gt;&lt;div style=&quot;text-align: left&quot;&gt;1. 自己是looking, 放入recvQueue里. 对方也是, 而且electionEpoch比自己小, 响应对方投自己&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;2. 自己不是looking, 对方是, 把自己的vote给它&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="109" y="593.25" width="107" height="91.75" as="geometry"/>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="UtrOZooaUX3hYhCwdXiv-1" source="puGpuqbUjW5oyIaAnzhM-14" target="puGpuqbUjW5oyIaAnzhM-9" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="203" y="578" as="sourcePoint"/>
                        <mxPoint x="245" y="578" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-11" value="- 序列化" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;" parent="UtrOZooaUX3hYhCwdXiv-1" source="puGpuqbUjW5oyIaAnzhM-16" target="GW1vWSZwJK0EqwMKYa0h-9" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-16" value="3. 连接peer: 假设这是两个peer" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fontSize=9;" parent="UtrOZooaUX3hYhCwdXiv-1" source="puGpuqbUjW5oyIaAnzhM-16" target="UtrOZooaUX3hYhCwdXiv-70" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-17" value="2. 放sid的&lt;br&gt;sendQue" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;strokeColor=#FF0000;" parent="UtrOZooaUX3hYhCwdXiv-1" source="puGpuqbUjW5oyIaAnzhM-16" target="puGpuqbUjW5oyIaAnzhM-0" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-16" value="toSend(sid, buff)&lt;br&gt;- buff是把信息序列化了: state, leader, zxid, logicClock, peerEpoch, configData.&lt;br&gt;1. 如果sid是自己, 直接塞入cecvQueue&lt;br&gt;2. 把buffer放到sid自己的BQueue里面(&lt;b&gt;阻塞&lt;/b&gt;)&lt;br&gt;3.&amp;nbsp;&lt;b&gt;第一次就连peer. 放入线程池异步, 创建Bio的socket连&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="-161" y="798" width="244" height="113" as="geometry"/>
                </mxCell>
                <mxCell id="puGpuqbUjW5oyIaAnzhM-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" source="UtrOZooaUX3hYhCwdXiv-55" target="puGpuqbUjW5oyIaAnzhM-16" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-29" y="631.5" as="sourcePoint"/>
                        <mxPoint x="-109.97142857142853" y="664.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;" parent="UtrOZooaUX3hYhCwdXiv-1" source="GW1vWSZwJK0EqwMKYa0h-8" target="GW1vWSZwJK0EqwMKYa0h-9" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-9" value="v2版本的notification&lt;br&gt;固定44字节:&lt;br&gt;&lt;b&gt;实际发送:len+buff&lt;/b&gt;" style="whiteSpace=wrap;html=1;rounded=1;fontSize=9;fillColor=none;arcSize=0;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="-66.5" y="1001" width="53" height="61" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-12" value="" style="group" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1" connectable="0">
                    <mxGeometry x="-226.5" y="928" width="115" height="248" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-0" value="当前peer状态:&lt;br style=&quot;font-size: 9px;&quot;&gt;Looking: 4byte" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="GW1vWSZwJK0EqwMKYa0h-12" vertex="1">
                    <mxGeometry width="63" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-1" value="proposedLeader&lt;br style=&quot;font-size: 9px;&quot;&gt;自己的sid:8byte" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="GW1vWSZwJK0EqwMKYa0h-12" vertex="1">
                    <mxGeometry y="31" width="95" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-2" value="electionEpoch:&lt;br style=&quot;font-size: 9px;&quot;&gt;自己的logicClock:8byte" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="GW1vWSZwJK0EqwMKYa0h-12" vertex="1">
                    <mxGeometry y="93" width="95" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-3" value="peerEpoch:&lt;br style=&quot;font-size: 9px;&quot;&gt;数据的epoch:8byte" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="GW1vWSZwJK0EqwMKYa0h-12" vertex="1">
                    <mxGeometry y="124" width="95" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-4" value="zxid:&lt;br style=&quot;font-size: 9px;&quot;&gt;本地数据的事务id: 8B" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="GW1vWSZwJK0EqwMKYa0h-12" vertex="1">
                    <mxGeometry y="62" width="95" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-5" value="当前ZK数据版本:&lt;br style=&quot;font-size: 9px&quot;&gt;3.5是v1, 3.6是v2: 4B" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="GW1vWSZwJK0EqwMKYa0h-12" vertex="1">
                    <mxGeometry y="155" width="95" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-6" value="configData.lenth: 4byte" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="GW1vWSZwJK0EqwMKYa0h-12" vertex="1">
                    <mxGeometry y="186" width="73" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-7" value="configData 配置" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="GW1vWSZwJK0EqwMKYa0h-12" vertex="1">
                    <mxGeometry y="217" width="96" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-8" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;flipH=1;dashed=1;fontSize=9;fillColor=none;" parent="GW1vWSZwJK0EqwMKYa0h-12" vertex="1">
                    <mxGeometry x="95" y="2" width="20" height="202" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-87" value="阻塞收" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeColor=#FF0000;" parent="UtrOZooaUX3hYhCwdXiv-1" source="GW1vWSZwJK0EqwMKYa0h-14" target="puGpuqbUjW5oyIaAnzhM-14" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-14" value="recvQueue:100&lt;br&gt;peer共享" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="-23" y="644" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-15" value="1. 假装收到" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;exitX=0.75;exitY=0;exitDx=0;exitDy=0;" parent="UtrOZooaUX3hYhCwdXiv-1" source="puGpuqbUjW5oyIaAnzhM-16" target="GW1vWSZwJK0EqwMKYa0h-14" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-29" y="921" as="sourcePoint"/>
                        <mxPoint x="-30" y="1086" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeColor=#FF0000;" parent="UtrOZooaUX3hYhCwdXiv-1" source="GW1vWSZwJK0EqwMKYa0h-20" target="GW1vWSZwJK0EqwMKYa0h-21" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-20" value="&lt;b&gt;SendWorker:&amp;nbsp;&lt;/b&gt;&lt;br&gt;阻塞拿, 直接发" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#82b366;fillColor=none;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="-271" y="654.5" width="93" height="30.5" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeColor=#FF0000;" parent="UtrOZooaUX3hYhCwdXiv-1" source="GW1vWSZwJK0EqwMKYa0h-21" target="GW1vWSZwJK0EqwMKYa0h-14" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-21" value="&lt;b&gt;RecvWorker:&lt;/b&gt;&lt;br&gt;loop收, 放que里" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#82b366;fillColor=none;" parent="UtrOZooaUX3hYhCwdXiv-1" vertex="1">
                    <mxGeometry x="-270" y="603.5" width="92" height="30.5" as="geometry"/>
                </mxCell>
                <mxCell id="GW1vWSZwJK0EqwMKYa0h-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;fontSize=9;strokeColor=#FF0000;" parent="UtrOZooaUX3hYhCwdXiv-1" source="puGpuqbUjW5oyIaAnzhM-0" target="GW1vWSZwJK0EqwMKYa0h-20" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram name="ZK3. Follower, Leader数据同步" id="gF0AWooflOvIGpuxUxd2">
        <mxGraphModel dx="3448" dy="658" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="1100" pageHeight="850" math="0" shadow="0">
            <root>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-0"/>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-1" parent="LTb61guYh8OZ6e0CkLJ9-0"/>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-41" value="" style="group" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1" connectable="0">
                    <mxGeometry x="1727" y="1278" width="126" height="56" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-36" value="LearnerHandler:&lt;br&gt;满足learner的需求" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="rF2zj_3eaPOYDtz99KDT-41" vertex="1">
                    <mxGeometry width="117" height="47" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-37" value="LearnerHandler:&lt;br&gt;满足learner的需求" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="rF2zj_3eaPOYDtz99KDT-41" vertex="1">
                    <mxGeometry x="3" y="3" width="117" height="47" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-38" value="LearnerHandler:&lt;br&gt;满足learner的需求" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="rF2zj_3eaPOYDtz99KDT-41" vertex="1">
                    <mxGeometry x="6" y="6" width="117" height="47" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-39" value="LearnerHandler:&lt;br&gt;满足learner的需求" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="rF2zj_3eaPOYDtz99KDT-41" vertex="1">
                    <mxGeometry x="9" y="9" width="117" height="47" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-49" value="socket" style="aspect=fixed;html=1;points=[];align=center;image;fontSize=12;image=img/lib/mscae/Connection.svg;fillColor=none;" parent="rF2zj_3eaPOYDtz99KDT-41" vertex="1">
                    <mxGeometry x="-25" y="17" width="50" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-44" value="" style="group" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1" connectable="0">
                    <mxGeometry x="1090" y="368.75" width="320" height="164.25" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-45" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-44" vertex="1">
                    <mxGeometry y="1.25" width="320" height="150" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-46" value="&lt;span style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250); display: inline; float: none;&quot;&gt;NioServerCnxnFactory:&lt;/span&gt;&lt;br style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250);&quot;&gt;&lt;span style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250); display: inline; float: none;&quot;&gt;默认的nioserver&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;" parent="LTb61guYh8OZ6e0CkLJ9-44" vertex="1">
                    <mxGeometry x="102.5" width="150" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-13" value="2181端口" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-44" vertex="1">
                    <mxGeometry x="22" y="139.25" width="46" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-2" value="" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1986" y="445" width="1084" height="914" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-5" target="LTb61guYh8OZ6e0CkLJ9-8" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-4" value="创建, 启动" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeWidth=2;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-5" target="LTb61guYh8OZ6e0CkLJ9-10" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-5" value="QuorumPeerMain:&lt;br&gt;1. 启动清理线程&lt;br&gt;2. 配置, 启动ZK peer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="390" y="250" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-6" value="定时清理" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeWidth=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-8" target="LTb61guYh8OZ6e0CkLJ9-16" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-8" target="LTb61guYh8OZ6e0CkLJ9-18" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-8" value="DatadirCleanup:&lt;br&gt;定时清理" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="460" y="140" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-10" target="LTb61guYh8OZ6e0CkLJ9-15" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-10" value="QuorumPeer:&lt;br&gt;线程, 一个zk服务" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="670" y="270" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-11" value="4. 启动本线程" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=2;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-15" target="LTb61guYh8OZ6e0CkLJ9-23" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-12" value="1. 恢复数据" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-15" target="LTb61guYh8OZ6e0CkLJ9-33" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-13" value="2. 启动clientServer" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-15" target="LTb61guYh8OZ6e0CkLJ9-45" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-14" value="3. 创建选举&lt;br&gt;算法组件&lt;br&gt;会start()" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeWidth=2;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-15" target="LTb61guYh8OZ6e0CkLJ9-55" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-15" value="start()&lt;br&gt;1. 加载磁盘文件到内存&lt;span style=&quot;color: rgb(135 , 16 , 148) ; background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;zkDb&lt;/span&gt;&lt;span&gt;, 加载epoch&lt;/span&gt;&lt;br&gt;2. 启动面向client端的socket和worker, serverCnxFactory&lt;br&gt;&lt;b&gt;3. 初始化一张myid的选票, 启动面向peer的leaderElection组件&lt;br&gt;&lt;/b&gt;4. 启动本线程" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="575" y="425" width="310" height="95" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-16" value="磁盘: dataDir" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="740" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-17" value="恢复数据" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-33" target="LTb61guYh8OZ6e0CkLJ9-24" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-18" value="磁盘: dataLogDir" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="740" y="60" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-23" target="LTb61guYh8OZ6e0CkLJ9-62" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-23" target="LTb61guYh8OZ6e0CkLJ9-63" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-23" target="LTb61guYh8OZ6e0CkLJ9-64" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-22" value="2. 选举leader" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeWidth=2;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-23" target="LTb61guYh8OZ6e0CkLJ9-61" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-23" value="run()&lt;br&gt;&lt;b&gt;1. whileTrue, 按照当前peer的state来运行不同的模式&lt;br&gt;2. 如果是looking状态&lt;/b&gt;, 从leaderElection那里拿leader的vote, 存成currVote&lt;br&gt;3. 如果是observering, followering, leading状态, 分别创建出各自的组件,然后start&lt;br&gt;4. 退出各自状态时候会把组件删掉的, 不影响家庭" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="575" y="575" width="310" height="105" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-24" value="zkDb" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="910" y="277.5" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-25" value="currentEpoch&lt;br&gt;acceptedEpoch" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1010" y="277.5" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-10" target="LTb61guYh8OZ6e0CkLJ9-24" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="740" y="340" as="sourcePoint"/>
                        <mxPoint x="740" y="435" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-27" value="snapshot" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="740" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-29" target="LTb61guYh8OZ6e0CkLJ9-33" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-29" value="acceptEpoch" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="870" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-31" target="LTb61guYh8OZ6e0CkLJ9-33" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-31" value="currentEpoch" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="870" y="20" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-33" target="LTb61guYh8OZ6e0CkLJ9-25" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-33" value="loadDataBases: 启动peer时候恢复数据" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="940" y="130" width="130" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-35" target="LTb61guYh8OZ6e0CkLJ9-45" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-35" value="serverCnxFactory" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1200" y="277.5" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-25" target="LTb61guYh8OZ6e0CkLJ9-35" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="800" y="310" as="sourcePoint"/>
                        <mxPoint x="920" y="310" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-37" value="workerPool" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1330" y="431.25" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-38" value="检查过期conn" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;startArrow=none;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-39" target="LTb61guYh8OZ6e0CkLJ9-43" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-39" value="exporerThread" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1210" y="488.75" width="80" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-41" target="LTb61guYh8OZ6e0CkLJ9-43" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-41" value="acceptThread" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1090" y="431.25" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-43" target="LTb61guYh8OZ6e0CkLJ9-37" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-43" value="selectorThreads" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1200" y="431.25" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-48" target="LTb61guYh8OZ6e0CkLJ9-55" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-48" value="electionAlgorithm" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="280" y="392.25" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-50" target="LTb61guYh8OZ6e0CkLJ9-56" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-50" value="quorumCnxMgr" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-80" y="488" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-51" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-55" target="LTb61guYh8OZ6e0CkLJ9-50" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="220" y="101.25" as="sourcePoint"/>
                        <mxPoint x="310" y="101.25" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-52" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-10" target="LTb61guYh8OZ6e0CkLJ9-48" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="390.0002519532677" y="413.57142857142867" as="sourcePoint"/>
                        <mxPoint x="340.0000000000001" y="449.75" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-53" value="currVote: leader" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="230" y="310" width="90" height="36.25" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-54" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-48" target="LTb61guYh8OZ6e0CkLJ9-53" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="740" y="340" as="sourcePoint"/>
                        <mxPoint x="440" y="391" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-55" value="FastLeaderElection&lt;br&gt;leader选举" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="270" y="488.75" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-56" value="&lt;b&gt;QuorumCnxManager&lt;br&gt;&lt;/b&gt;peer的连接, 收发队列" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-100" y="545.5" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-57" value="3. 启动" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-58" target="LTb61guYh8OZ6e0CkLJ9-88" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-58" value="- 启动QCM的listener开始连peer&lt;br&gt;&lt;font color=&quot;#ff0000&quot;&gt;start()&lt;/font&gt;&lt;br&gt;1. 初始化收发组件&lt;br&gt;3. 启动ws, wr." style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="232.5" y="660" width="195" height="63" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-60" value="2. 经过sendQueue, &lt;br&gt;ws线程, 实际发送" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-61" target="LTb61guYh8OZ6e0CkLJ9-93" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-61" value="&lt;font color=&quot;#ff0000&quot;&gt;lookForLeader()&lt;/font&gt;&lt;br&gt;1. 更新自己的&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;logicalclock,&amp;nbsp;&lt;/span&gt;&lt;span&gt;proposal, 投自己.&lt;/span&gt;&lt;br&gt;2. 把自己的选票, 状态, txid, epoch, 和集群配置都发给所有peer(包括自己).&lt;br&gt;3. 阻塞拿recvQueue里面的响应的投票, 收不到就发一遍, 循环&lt;br&gt;4. 拿到一个peer的44字节信息.&lt;br&gt;4.1 如果是looking发过来的-&amp;gt;&lt;br&gt;&lt;b&gt;对方胜于自己(peerEpoch, zxid, sid)自己的选票就跟随对方. 对方弱就扔掉.&lt;br&gt;&lt;/b&gt;自己的&lt;b&gt;选票每更新一次都会sendNotifications&lt;/b&gt;给所有peer.&lt;br&gt;&lt;b&gt;统计当前的选票过半, 修改peer的状态, 清掉recvQue.&lt;/b&gt;&lt;br&gt;4.2 如果是&lt;b&gt;Follower, Leader发来的选票: 还会等待大多数响应校验一下过半机制, 还会校验一下leader(&lt;span style=&quot;color: rgb(8 , 8 , 8) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;checkLeader&lt;/span&gt;&lt;span&gt;). 修改peer状态, 清掉recvQueue&lt;/span&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="181.5" y="805" width="297" height="244" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-11" value="1. folower模式就是启动Follower" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;strokeWidth=2;strokeColor=#FF0000;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-62" target="rF2zj_3eaPOYDtz99KDT-6" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-62" value="follower" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="575" y="735" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-63" value="observer" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="690" y="735" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-64" value="leader" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="810" y="735" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-65" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-58" target="LTb61guYh8OZ6e0CkLJ9-55" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="290.0002972660441" y="424.8275862068965" as="sourcePoint"/>
                        <mxPoint x="219.99994054692388" y="456.2758620689656" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-66" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-58" target="LTb61guYh8OZ6e0CkLJ9-61" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="340" y="582.5" as="sourcePoint"/>
                        <mxPoint x="340" y="558.75" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-67" value="listener: 监听3888" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-439" y="575.5" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-68" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-56" target="LTb61guYh8OZ6e0CkLJ9-67" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="147" y="479.79999999999995" as="sourcePoint"/>
                        <mxPoint x="-29" y="514" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-69" value="&lt;b&gt;QCM.Listener&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#82b366;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-459" y="634" width="120" height="40.5" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-70" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-67" target="LTb61guYh8OZ6e0CkLJ9-69" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-216" y="568.5" as="sourcePoint"/>
                        <mxPoint x="-216" y="596" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-71" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-73" target="LTb61guYh8OZ6e0CkLJ9-77" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-72" value="2. 每个sid&lt;br&gt;都有queue和&lt;br&gt;两个worker线程" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="LTb61guYh8OZ6e0CkLJ9-71" vertex="1" connectable="0">
                    <mxGeometry x="-0.1681" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-73" value="run():&lt;br&gt;大概原理: 为端口3888绑定一个handler处理, 一直监听.&lt;br&gt;&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;handleConnection(sock) :&lt;br&gt;&lt;/font&gt;&lt;/b&gt;1. &lt;b&gt;拒绝sid小的连自己&lt;/b&gt;, 遇到了, 清空sock相关收发worker, 尝试连对方.&lt;br&gt;2. sid小的, &lt;b&gt;创建sendWorker, recvWorker, 启动. 创建一个sendQueue.同步队列!&lt;br&gt;3. observer的sid递减, 负数.&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-518" y="690" width="244" height="131" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-74" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-69" target="LTb61guYh8OZ6e0CkLJ9-73" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-277" y="601" as="sourcePoint"/>
                        <mxPoint x="-349" y="600.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-75" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-56" target="LTb61guYh8OZ6e0CkLJ9-77" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-89" y="601.5" as="sourcePoint"/>
                        <mxPoint x="-318" y="621" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-76" value="" style="group" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1" connectable="0">
                    <mxGeometry x="-170" y="654.5" width="82" height="101" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-77" value="" style="rounded=0;whiteSpace=wrap;html=1;align=left;strokeColor=#d79b00;dashed=1;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-76" vertex="1">
                    <mxGeometry width="82" height="101" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-78" value="senderWorker&lt;br&gt;&amp;lt;sid, SW&amp;gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-76" vertex="1">
                    <mxGeometry x="1" y="5.5" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-79" value="queueSendMap&lt;br&gt;&amp;lt;sid,&lt;b&gt;bqueue1&lt;/b&gt;&amp;gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-76" vertex="1">
                    <mxGeometry x="1" y="35.5" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-80" value="lastMsgSent&lt;br&gt;&amp;lt;sid, buff&amp;gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-76" vertex="1">
                    <mxGeometry x="1" y="65.5" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-81" value="workerSender" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="235" y="553" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-82" value="workerReceiver" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="235" y="583" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-83" value="sendQueue" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="342" y="553" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-84" value="recvQueue:" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="342" y="583" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-85" value="&lt;b&gt;WorkerSender:&lt;/b&gt;&lt;br&gt;单纯把队列拿取交给QCM发给指定sid" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="112" y="545" width="107" height="46" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-86" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-85" target="LTb61guYh8OZ6e0CkLJ9-81" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-29" y="544" as="sourcePoint"/>
                        <mxPoint x="-29" y="571.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-87" value="一个peer的44字节的信息" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-88" target="LTb61guYh8OZ6e0CkLJ9-84" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-88" value="&lt;b&gt;WorkerReceiver:&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;font color=&quot;#ff0000&quot;&gt;接收, 解析:&lt;/font&gt;&lt;br&gt;&lt;div style=&quot;text-align: left&quot;&gt;1. 自己是looking, 放入recvQueue里. 对方也是, 而且electionEpoch比自己小, 响应对方投自己&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;2. 自己不是looking, 对方是, 把自己的vote给它&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="109" y="593.25" width="107" height="91.75" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-89" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-88" target="LTb61guYh8OZ6e0CkLJ9-82" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="203" y="578" as="sourcePoint"/>
                        <mxPoint x="245" y="578" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-90" value="- 序列化" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-93" target="LTb61guYh8OZ6e0CkLJ9-96" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-91" value="3. 连接peer: 假设这是两个peer" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-93" target="LTb61guYh8OZ6e0CkLJ9-73" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-92" value="2. 放sid的&lt;br&gt;sendQue" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-93" target="LTb61guYh8OZ6e0CkLJ9-79" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-93" value="toSend(sid, buff)&lt;br&gt;- buff是把信息序列化了: state, leader, zxid, logicClock, peerEpoch, configData.&lt;br&gt;1. 如果sid是自己, 直接塞入cecvQueue&lt;br&gt;2. 把buffer放到sid自己的BQueue里面(&lt;b&gt;阻塞&lt;/b&gt;)&lt;br&gt;3.&amp;nbsp;&lt;b&gt;第一次就连peer. 放入线程池异步, 创建Bio的socket连&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-161" y="798" width="244" height="113" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-94" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-56" target="LTb61guYh8OZ6e0CkLJ9-93" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-29" y="631.5" as="sourcePoint"/>
                        <mxPoint x="-109.97142857142853" y="664.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-95" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-106" target="LTb61guYh8OZ6e0CkLJ9-96" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-96" value="v2版本的notification&lt;br&gt;固定44字节:&lt;br&gt;&lt;b&gt;实际发送:len+buff&lt;/b&gt;" style="whiteSpace=wrap;html=1;rounded=1;fontSize=9;fillColor=none;arcSize=0;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-66.5" y="1001" width="53" height="61" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-97" value="" style="group" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1" connectable="0">
                    <mxGeometry x="-226.5" y="928" width="115" height="248" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-98" value="当前peer状态:&lt;br style=&quot;font-size: 9px;&quot;&gt;Looking: 4byte" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-97" vertex="1">
                    <mxGeometry width="63" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-99" value="proposedLeader&lt;br style=&quot;font-size: 9px;&quot;&gt;自己的sid:8byte" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-97" vertex="1">
                    <mxGeometry y="31" width="95" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-100" value="electionEpoch:&lt;br style=&quot;font-size: 9px;&quot;&gt;自己的logicClock:8byte" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-97" vertex="1">
                    <mxGeometry y="93" width="95" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-101" value="peerEpoch:&lt;br style=&quot;font-size: 9px;&quot;&gt;数据的epoch:8byte" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-97" vertex="1">
                    <mxGeometry y="124" width="95" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-102" value="zxid:&lt;br style=&quot;font-size: 9px;&quot;&gt;本地数据的事务id: 8B" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-97" vertex="1">
                    <mxGeometry y="62" width="95" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-103" value="当前ZK数据版本:&lt;br style=&quot;font-size: 9px&quot;&gt;3.5是v1, 3.6是v2: 4B" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-97" vertex="1">
                    <mxGeometry y="155" width="95" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-104" value="configData.lenth: 4byte" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-97" vertex="1">
                    <mxGeometry y="186" width="73" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-105" value="configData 配置" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-97" vertex="1">
                    <mxGeometry y="217" width="96" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-106" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;flipH=1;dashed=1;fontSize=9;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-97" vertex="1">
                    <mxGeometry x="95" y="2" width="20" height="202" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-107" value="阻塞收" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-108" target="LTb61guYh8OZ6e0CkLJ9-88" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-108" value="recvQueue:100&lt;br&gt;peer共享" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-23" y="644" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-109" value="1. 假装收到" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;exitX=0.75;exitY=0;exitDx=0;exitDy=0;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-93" target="LTb61guYh8OZ6e0CkLJ9-108" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-29" y="921" as="sourcePoint"/>
                        <mxPoint x="-30" y="1086" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-110" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-111" target="LTb61guYh8OZ6e0CkLJ9-113" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-111" value="&lt;b&gt;SendWorker:&amp;nbsp;&lt;/b&gt;&lt;br&gt;阻塞拿, 直接发" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#82b366;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-271" y="654.5" width="93" height="30.5" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-112" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-113" target="LTb61guYh8OZ6e0CkLJ9-108" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-113" value="&lt;b&gt;RecvWorker:&lt;/b&gt;&lt;br&gt;loop收, 放que里" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#82b366;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-270" y="603.5" width="92" height="30.5" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-114" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-79" target="LTb61guYh8OZ6e0CkLJ9-111" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-115" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-116" target="LTb61guYh8OZ6e0CkLJ9-119" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-116" value="quorumCnxMgr" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1501" y="644" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-117" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-118" target="LTb61guYh8OZ6e0CkLJ9-116" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-1201" y="257.25" as="sourcePoint"/>
                        <mxPoint x="-1111" y="257.25" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-118" value="FastLeaderElection&lt;br&gt;leader选举" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1151" y="644.75" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-119" value="&lt;b&gt;QuorumCnxManager&lt;br&gt;&lt;/b&gt;peer的连接, 收发队列" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1521" y="701.5" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-120" value="- 启动QCM的listener开始连peer&lt;br&gt;&lt;font color=&quot;#ff0000&quot;&gt;start()&lt;/font&gt;&lt;br&gt;1. 初始化收发组件&lt;br&gt;3. 启动ws, wr." style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1188.5" y="816" width="195" height="63" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-121" value="2. 经过sendQueue, &lt;br&gt;ws线程, 实际发送" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF0000;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-122" target="LTb61guYh8OZ6e0CkLJ9-150" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-122" value="&lt;font color=&quot;#ff0000&quot;&gt;lookForLeader()&lt;br&gt;1. 更新自己的proposal, 投自己.&lt;br&gt;2. 把自己的选票, 状态, txid, epoch, 和集群配置都发给所有peer(包括自己).&lt;br&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1188.5" y="957" width="195" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-123" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-120" target="LTb61guYh8OZ6e0CkLJ9-118" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-1130.999702733956" y="580.8275862068965" as="sourcePoint"/>
                        <mxPoint x="-1201.0000594530761" y="612.2758620689656" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-124" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-120" target="LTb61guYh8OZ6e0CkLJ9-122" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-1081" y="738.5" as="sourcePoint"/>
                        <mxPoint x="-1081" y="714.75" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-125" value="listener: 监听3888" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1860" y="731.5" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-126" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-119" target="LTb61guYh8OZ6e0CkLJ9-125" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-1274" y="635.8" as="sourcePoint"/>
                        <mxPoint x="-1450" y="670" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-127" value="&lt;b&gt;QCM.Listener&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#82b366;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1880" y="790" width="120" height="40.5" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-128" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-125" target="LTb61guYh8OZ6e0CkLJ9-127" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-1637" y="724.5" as="sourcePoint"/>
                        <mxPoint x="-1637" y="752" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-129" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-131" target="LTb61guYh8OZ6e0CkLJ9-135" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-130" value="2. 每个sid&lt;br&gt;都有queue和&lt;br&gt;两个worker线程" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="LTb61guYh8OZ6e0CkLJ9-129" vertex="1" connectable="0">
                    <mxGeometry x="-0.1681" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-131" value="run():&lt;br&gt;大概原理: 为端口3888绑定一个handler处理, 一直监听.&lt;br&gt;&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;handleConnection(sock) :&lt;br&gt;&lt;/font&gt;&lt;/b&gt;1. &lt;b&gt;拒绝sid小的连自己&lt;/b&gt;, 遇到了, 清空sock相关收发worker, 尝试连对方.&lt;br&gt;2. sid小的, &lt;b&gt;创建sendWorker, recvWorker, 启动. 创建一个sendQueue.同步队列!&lt;br&gt;3. observer的sid递减, 负数.&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1939" y="846" width="244" height="131" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-132" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-127" target="LTb61guYh8OZ6e0CkLJ9-131" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-1698" y="757" as="sourcePoint"/>
                        <mxPoint x="-1770" y="756.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-133" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-119" target="LTb61guYh8OZ6e0CkLJ9-135" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-1510" y="757.5" as="sourcePoint"/>
                        <mxPoint x="-1739" y="777" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-134" value="" style="group" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1" connectable="0">
                    <mxGeometry x="-1591" y="810.5" width="82" height="101" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-135" value="" style="rounded=0;whiteSpace=wrap;html=1;align=left;strokeColor=#d79b00;dashed=1;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-134" vertex="1">
                    <mxGeometry width="82" height="101" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-136" value="senderWorker&lt;br&gt;&amp;lt;sid, SW&amp;gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-134" vertex="1">
                    <mxGeometry x="1" y="5.5" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-137" value="queueSendMap&lt;br&gt;&amp;lt;sid, bqueue&amp;gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-134" vertex="1">
                    <mxGeometry x="1" y="35.5" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-138" value="lastMsgSent&lt;br&gt;&amp;lt;sid, buff&amp;gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-134" vertex="1">
                    <mxGeometry x="1" y="65.5" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-139" value="workerSender" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1186" y="709" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-140" value="workerReceiver" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1186" y="739" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-141" value="sendQueue" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1079" y="709" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-142" value="recvQueue" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1079" y="739" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-143" value="&lt;b&gt;WorkerSender:&lt;/b&gt;&lt;br&gt;单纯把队列拿取交给QCM发给指定sid" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1335" y="701" width="107" height="46" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-144" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-143" target="LTb61guYh8OZ6e0CkLJ9-139" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-1450" y="700" as="sourcePoint"/>
                        <mxPoint x="-1450" y="727.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-145" value="&lt;b&gt;WorkerReceiver:&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#ff0000&quot;&gt;从QCM接收, 解析, 放到recvQueue里&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1335" y="752" width="107" height="46" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-146" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-145" target="LTb61guYh8OZ6e0CkLJ9-140" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-1218" y="734" as="sourcePoint"/>
                        <mxPoint x="-1176" y="734" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-147" value="- 序列化" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-150" target="LTb61guYh8OZ6e0CkLJ9-153" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-148" value="3. 连接peer: 假设这是两个peer" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-150" target="LTb61guYh8OZ6e0CkLJ9-131" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-149" value="2. 放sid的&lt;br&gt;sendQue" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;strokeColor=#FF0000;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-150" target="LTb61guYh8OZ6e0CkLJ9-137" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-150" value="toSend(sid, buff)&lt;br&gt;- buff是把信息序列化了: state, leader, zxid, logicClock, peerEpoch, configData.&lt;br&gt;1. 如果sid是自己, 直接塞入cecvQueue&lt;br&gt;2. 把buffer放到sid自己的BQueue里面(&lt;b&gt;阻塞&lt;/b&gt;)&lt;br&gt;3.&amp;nbsp;&lt;b&gt;第一次就连peer. 放入线程池异步, 创建Bio的socket连&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1582" y="954" width="244" height="113" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-151" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-119" target="LTb61guYh8OZ6e0CkLJ9-150" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-1450" y="787.5" as="sourcePoint"/>
                        <mxPoint x="-1530.9714285714285" y="820.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-152" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-163" target="LTb61guYh8OZ6e0CkLJ9-153" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-153" value="v2版本的notification&lt;br&gt;固定44字节:&lt;br&gt;&lt;b&gt;实际发送:len+buff&lt;/b&gt;" style="whiteSpace=wrap;html=1;rounded=1;fontSize=9;fillColor=none;arcSize=0;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1487.5" y="1157" width="53" height="61" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-154" value="" style="group" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1" connectable="0">
                    <mxGeometry x="-1647.5" y="1084" width="115" height="248" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-155" value="当前peer状态:&lt;br style=&quot;font-size: 9px;&quot;&gt;Looking: 4byte" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-154" vertex="1">
                    <mxGeometry width="63" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-156" value="proposedLeader&lt;br style=&quot;font-size: 9px;&quot;&gt;自己的sid:8byte" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-154" vertex="1">
                    <mxGeometry y="31" width="95" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-157" value="electionEpoch:&lt;br style=&quot;font-size: 9px;&quot;&gt;自己的logicClock:8byte" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-154" vertex="1">
                    <mxGeometry y="93" width="95" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-158" value="peerEpoch:&lt;br style=&quot;font-size: 9px;&quot;&gt;数据的epoch:8byte" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-154" vertex="1">
                    <mxGeometry y="124" width="95" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-159" value="zxid:&lt;br style=&quot;font-size: 9px;&quot;&gt;本地数据的事务id: 8B" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-154" vertex="1">
                    <mxGeometry y="62" width="95" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-160" value="当前ZK数据版本:&lt;br style=&quot;font-size: 9px&quot;&gt;3.5是v1, 3.6是v2: 4B" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-154" vertex="1">
                    <mxGeometry y="155" width="95" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-161" value="configData.lenth: 4byte" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-154" vertex="1">
                    <mxGeometry y="186" width="73" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-162" value="configData 配置" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-154" vertex="1">
                    <mxGeometry y="217" width="96" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-163" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;flipH=1;dashed=1;fontSize=9;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-154" vertex="1">
                    <mxGeometry x="95" y="2" width="20" height="202" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-164" value="recvQueue:&lt;br&gt;peer共享" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1444" y="800" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-165" value="1. 假装收到" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;exitX=0.75;exitY=0;exitDx=0;exitDy=0;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-150" target="LTb61guYh8OZ6e0CkLJ9-164" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-1450" y="1077" as="sourcePoint"/>
                        <mxPoint x="-1451" y="1242" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-166" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeColor=#FF0000;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-167" target="LTb61guYh8OZ6e0CkLJ9-169" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-167" value="&lt;b&gt;SendWorker:&amp;nbsp;&lt;/b&gt;&lt;br&gt;阻塞拿, 直接发" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#82b366;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1692" y="810.5" width="93" height="30.5" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-168" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeColor=#FF0000;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-169" target="LTb61guYh8OZ6e0CkLJ9-164" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-169" value="&lt;b&gt;RecvWorker:&lt;/b&gt;&lt;br&gt;loop收, 放que里" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#82b366;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1691" y="759.5" width="92" height="30.5" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-170" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;fontSize=9;strokeColor=#FF0000;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-137" target="LTb61guYh8OZ6e0CkLJ9-167" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LTb61guYh8OZ6e0CkLJ9-171" value="&lt;font style=&quot;font-size: 12px&quot;&gt;另一个Peer&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-1557.5" y="448.5" width="195" height="48" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-0" value="fileTxnSnapLog" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="910" y="330" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="LTb61guYh8OZ6e0CkLJ9-10" target="rF2zj_3eaPOYDtz99KDT-0" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="800" y="310" as="sourcePoint"/>
                        <mxPoint x="920" y="310" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeColor=#000000;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-3" target="rF2zj_3eaPOYDtz99KDT-4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-3" value="Follower" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1330" y="1007" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-4" value="Learner" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1435" y="894" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeColor=#000000;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-5" target="rF2zj_3eaPOYDtz99KDT-4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-5" value="Observer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1526" y="1007" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-57" value="2. 三次握手注册给leader" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=classic;startFill=1;strokeColor=#000000;strokeWidth=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-6" target="rF2zj_3eaPOYDtz99KDT-55" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-58" value="1. 接受follower的注册: 三次握手" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" parent="rF2zj_3eaPOYDtz99KDT-57" vertex="1" connectable="0">
                    <mxGeometry x="0.4769" y="2" relative="1" as="geometry">
                        <mxPoint x="11" y="2" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-6" value="followerLeader()&lt;br&gt;1. 直接拿到vote的leader, 使用BIO的&lt;b&gt;socket&lt;/b&gt;连接, tcpNoDealy之类的参数设一下&lt;br&gt;2. 注册到leader上: 发送sid-zxid, 接收新的zxid" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1235" y="1145.5" width="310" height="105" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-3" target="rF2zj_3eaPOYDtz99KDT-6" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="740" y="340" as="sourcePoint"/>
                        <mxPoint x="740" y="435" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-12" value="&lt;pre style=&quot;color: rgb(8 , 8 , 8) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;&lt;b&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;// zk&lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic ; font-family: &amp;#34;courier new&amp;#34; , monospace&quot;&gt;的&lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;port: host:leaderPort(2888):leaderElectionPort(3888);clientPort(2181)&lt;/span&gt;&lt;/b&gt;&lt;/pre&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="-677" y="537" width="510" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeColor=#FF0000;strokeWidth=2;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-13" target="LTb61guYh8OZ6e0CkLJ9-41" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-16" value="Leader" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1994" y="977" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-17" value="构造器: 创建一个BIOServerSocket, 绑定2888端口" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1942" y="1095" width="224" height="41" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-16" target="rF2zj_3eaPOYDtz99KDT-17" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1400" y="1077" as="sourcePoint"/>
                        <mxPoint x="2083" y="1126" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-30" value="1. 准备数据" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-19" target="rF2zj_3eaPOYDtz99KDT-28" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-34" value="2. 监听" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-19" target="rF2zj_3eaPOYDtz99KDT-32" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-19" value="lead() - 启动方法&lt;br&gt;1. zkServer.loadData. 准备好数据&lt;br&gt;2. 启动2888端口的acceptor&lt;br&gt;3. === 开启新的一轮epoch. TODO&lt;br&gt;..." style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1942" y="1183" width="224" height="109.5" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-17" target="rF2zj_3eaPOYDtz99KDT-19" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2064" y="1047" as="sourcePoint"/>
                        <mxPoint x="2064" y="1105" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-21" value="serverSockets:&lt;br&gt;2888" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1803" y="1013" width="69" height="34" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-22" value="leaderZKServer" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="2278" y="986" width="69" height="34" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-23" value="LeaderZkServer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="2324" y="1067" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-23" target="rF2zj_3eaPOYDtz99KDT-22" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="340" y="447.25" as="sourcePoint"/>
                        <mxPoint x="340" y="498.75" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-16" target="rF2zj_3eaPOYDtz99KDT-22" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2064" y="1047" as="sourcePoint"/>
                        <mxPoint x="2064" y="1105" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-26" value="cnxAcceptor" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1803" y="1037" width="69" height="34" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-16" target="rF2zj_3eaPOYDtz99KDT-26" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2064" y="1047" as="sourcePoint"/>
                        <mxPoint x="2064" y="1105" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-28" value="loadData()&lt;br&gt;1. 检查zkDB是不是初始化好了&lt;br&gt;2. 清理zkDB里面过期session&lt;br&gt;3. 让log组件做一个snapshot" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="2289" y="1170" width="188" height="90" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-23" target="rF2zj_3eaPOYDtz99KDT-28" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2064" y="1145.9999999999998" as="sourcePoint"/>
                        <mxPoint x="2064" y="1193" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-31" value="LearnerCnxAcceptor&lt;br&gt;处理learner的连接" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1730" y="1085.5" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-44" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.422;entryY=0.45;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=9;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-32" target="rF2zj_3eaPOYDtz99KDT-43" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-32" value="run()&lt;br&gt;1. 接收2888端口的新socket, 包装一个来&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;LearnerHandler&lt;/span&gt;&lt;span&gt;维护leader-learner的交流&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1698.5" y="1180" width="183" height="56" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-31" target="rF2zj_3eaPOYDtz99KDT-32" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2064" y="1145.9999999999998" as="sourcePoint"/>
                        <mxPoint x="2064" y="1193" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-35" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-31" target="rF2zj_3eaPOYDtz99KDT-26" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2394" y="1077" as="sourcePoint"/>
                        <mxPoint x="2322.5" y="1030" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-40" value="每个learner一个" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;strokeColor=#000000;strokeWidth=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-32" target="rF2zj_3eaPOYDtz99KDT-38" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-43" value="2888" style="outlineConnect=0;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;shape=mxgraph.aws3.elastic_network_interface;fillColor=#F58534;gradientColor=none;fontSize=9;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1657.29" y="1186.5" width="41.21" height="43" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-51" value="TCP连接" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=-0.014;entryY=0.504;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=9;strokeColor=#000000;strokeWidth=1;startArrow=classic;startFill=1;shape=link;dashed=1;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-50" target="rF2zj_3eaPOYDtz99KDT-49" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-50" value="socket" style="aspect=fixed;html=1;points=[];align=center;image;fontSize=12;image=img/lib/mscae/Connection.svg;fillColor=none;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1473" y="1079" width="50" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-52" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-3" target="rF2zj_3eaPOYDtz99KDT-50" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1400" y="1077" as="sourcePoint"/>
                        <mxPoint x="1467" y="1086" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-55" value="run()&lt;br&gt;&lt;b&gt;1. 和followersocket打开之后, 马上&quot;三次握手&quot;, 确认folower的zxid, 把自己的zxid发出去&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="LTb61guYh8OZ6e0CkLJ9-1" vertex="1">
                    <mxGeometry x="1703" y="1377" width="183" height="56" as="geometry"/>
                </mxCell>
                <mxCell id="rF2zj_3eaPOYDtz99KDT-56" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="LTb61guYh8OZ6e0CkLJ9-1" source="rF2zj_3eaPOYDtz99KDT-39" target="rF2zj_3eaPOYDtz99KDT-55" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1800" y="1155.5" as="sourcePoint"/>
                        <mxPoint x="1800" y="1190" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram id="5ObTLin1ipmyGnda6Hol" name="ZK4. ZKClient连接zkServer+Session">
        <mxGraphModel dx="2032" dy="717" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="1100" pageHeight="850" math="0" shadow="0">
            <root>
                <mxCell id="MHNppVWY9drHL_FHM4H_-0"/>
                <mxCell id="MHNppVWY9drHL_FHM4H_-1" parent="MHNppVWY9drHL_FHM4H_-0"/>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-0" target="MgtR8uemiQP_vpUSRu0I-6">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-0" target="MgtR8uemiQP_vpUSRu0I-10">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-0" value="Zookeeper" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="1485" y="1025" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-1" value="ClientCnxn:&lt;br&gt;维护与一个peer的连接" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="1915" y="1120" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-2" target="MgtR8uemiQP_vpUSRu0I-21">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-2" value="sendThread" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="1990" y="1210" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-3" value="eventThread" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="1900" y="1210" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-13" value="1. 启动ZK" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-4" target="MgtR8uemiQP_vpUSRu0I-6">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-15" value="2. 执行命令" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#FF0000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-4" target="MgtR8uemiQP_vpUSRu0I-14">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-4" value="ZookeeperMain: &lt;br&gt;启动类&lt;br&gt;1. 启动ZK&lt;br&gt;2. 监听命令输入, 执行" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="1144" y="1140" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-49" value="2. 创建, 启动收发, event处理线程" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-6" target="MgtR8uemiQP_vpUSRu0I-1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-6" value="构造器&lt;br&gt;1. 创建一个clientCnx&lt;br&gt;2. 把clientCnx启动起来: 启动两个线程, 会正式连接上socket" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="1460" y="1145" width="170" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-1" target="MgtR8uemiQP_vpUSRu0I-2">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1755" y="1150" as="sourcePoint"/>
                        <mxPoint x="1755" y="1190" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-1" target="MgtR8uemiQP_vpUSRu0I-3">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985" y="1190" as="sourcePoint"/>
                        <mxPoint x="1955" y="1220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-10" target="MgtR8uemiQP_vpUSRu0I-1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-10" value="ClientCnx" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="1755" y="1045" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-19" value="2. 执行命令!!!" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-14" target="MgtR8uemiQP_vpUSRu0I-17">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-14" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;while(true)&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;1. 解析命令行, 拿到对应的command类&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;2. 把zk和命令参数都给它, 执行command&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="1119" y="1270" width="170" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-16" value="CliCommand:&lt;br&gt;所有command父类" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;dashed=1;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="1244" y="1325" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-18" value="继承" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-17" target="MgtR8uemiQP_vpUSRu0I-16">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-50" value="&lt;b&gt;发送请求&lt;/b&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#FF0000;strokeWidth=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-17" target="MgtR8uemiQP_vpUSRu0I-34">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-17" value="CreateCommnad&lt;br&gt;LsCommand&lt;br&gt;SetCommand&lt;br&gt;DeleteCommand&lt;br&gt;..... 一系列的操作" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="1244" y="1415" width="120" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-20" value="clientCnxnSocket" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2325" y="1290" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-21" value="SendThread:&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;发送消息, 心跳, 接收响应&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2035" y="1280" width="120" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-21" target="MgtR8uemiQP_vpUSRu0I-20">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985.0344827586207" y="1190" as="sourcePoint"/>
                        <mxPoint x="2030" y="1220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-24" value="ClientCnxnSocketNio:&lt;br&gt;socket维护, Nio实现" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2300" y="1330" width="120" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-20" target="MgtR8uemiQP_vpUSRu0I-24">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2030" y="1267.5" as="sourcePoint"/>
                        <mxPoint x="2100" y="1267.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-26" value="watcherMgr" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="1630" y="1350" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-28" target="MgtR8uemiQP_vpUSRu0I-26">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985.0344827586207" y="1190" as="sourcePoint"/>
                        <mxPoint x="1940" y="1220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-28" value="EventThread" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="1780" y="1290" width="120" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-3" target="MgtR8uemiQP_vpUSRu0I-28">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2060" y="1235" as="sourcePoint"/>
                        <mxPoint x="2130" y="1235" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-30" value="run()&lt;br&gt;1. 一直从waitingEvents队列里阻塞取事件组处理, 直到收到结束事件, 而且没有其他事件&lt;br&gt;2. 处理事件就是把每个watcher回调一下" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="1755" y="1365" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-16" value="1. nio连接" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-31" target="MgtR8uemiQP_vpUSRu0I-42">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-17" value="3. 新一轮收发包" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-31" target="MgtR8uemiQP_vpUSRu0I-41">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-31" value="run() while(true)&lt;br&gt;1. 刚开始启动, 初始化nio连接:&lt;br&gt;&amp;nbsp; &amp;nbsp;- 从打乱的serverList里面顺序选一个连接&lt;br&gt;&lt;b&gt;2. 如果连接正常, 隔1s发送ping&lt;br&gt;&lt;/b&gt;3. nioSocket开始一轮select收发包" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;strokeColor=#FF0000;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2010" y="1347.5" width="170" height="62.5" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-21" target="MgtR8uemiQP_vpUSRu0I-31">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2165" y="1302.5" as="sourcePoint"/>
                        <mxPoint x="2250" y="1302.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-28" target="MgtR8uemiQP_vpUSRu0I-30">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2105.034482758621" y="1325" as="sourcePoint"/>
                        <mxPoint x="2105.034482758621" y="1340" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-34" target="kyka5EhIQeqjiCoUDyh9-24">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-34" value="outgoingQue" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="1910" y="1705" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-1" target="MgtR8uemiQP_vpUSRu0I-34">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985.0344827586207" y="1190" as="sourcePoint"/>
                        <mxPoint x="2030" y="1220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-15" value="TCP连接" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;shape=link;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-37" target="kyka5EhIQeqjiCoUDyh9-3">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-37" value="selector" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2490" y="1410" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-24" target="MgtR8uemiQP_vpUSRu0I-37">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985" y="1372.5" as="sourcePoint"/>
                        <mxPoint x="2345" y="1400" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-39" value="pendingQue" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="1970" y="1705" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-1" target="MgtR8uemiQP_vpUSRu0I-39">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2045" y="1160" as="sourcePoint"/>
                        <mxPoint x="2195" y="1200" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-20" value="3. 连接响应&lt;br&gt;正式连接了" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-41" target="kyka5EhIQeqjiCoUDyh9-18">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-26" value="4. 普通收发包" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-41" target="kyka5EhIQeqjiCoUDyh9-24">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-28" value="&lt;b&gt;2. 两次握手&lt;br&gt;交换sessionId&lt;/b&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-41" target="kyka5EhIQeqjiCoUDyh9-21">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-41" value="doTransport: - &lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;两次握手&lt;/font&gt;&lt;/b&gt;&lt;br&gt;1. selector.select(timeout)开始收socket的包&lt;br&gt;2. 如果是connected事件, 回调senThread, 包装一个connectionReq, 放到outgoing队列里, 然后注册selector的write事件, 下次就发出去.&lt;br&gt;3. 如果收到了connectionRsp响应, 回调sendThread.onConnection方法, 正式建立了&lt;br&gt;&lt;b&gt;4. 普通的selector事件处理:&amp;nbsp;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2267.5" y="1440" width="185" height="110" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-43" value="连上" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-42" target="MgtR8uemiQP_vpUSRu0I-37">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-42" value="connect(addr)&lt;br&gt;1. 简单的创建socketChannel,绑定在selector上&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-style: italic ; background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;OP_CONNECT&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2282.5" y="1380" width="155" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-44" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-24" target="MgtR8uemiQP_vpUSRu0I-42">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2430" y="1385.0344827586207" as="sourcePoint"/>
                        <mxPoint x="2535" y="1420" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="MgtR8uemiQP_vpUSRu0I-45" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-42" target="MgtR8uemiQP_vpUSRu0I-41">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2370" y="1407.5" as="sourcePoint"/>
                        <mxPoint x="2370" y="1420" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="kyka5EhIQeqjiCoUDyh9-5" target="kyka5EhIQeqjiCoUDyh9-1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-5" value="serverCnxFactory" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3886.5" y="1645.5" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" target="kyka5EhIQeqjiCoUDyh9-5" source="c9IUDB4x94eiGEWMFtiM-0">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3674.5" y="1041.5" as="sourcePoint"/>
                        <mxPoint x="3484.5" y="1051.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-42" value="2. watchedEvt" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="kyka5EhIQeqjiCoUDyh9-18" target="kyka5EhIQeqjiCoUDyh9-41">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-18" value="onConnected()&lt;br&gt;1. &lt;b&gt;存起来sessionId和password&lt;/b&gt;&lt;br&gt;2. 包装一个连接状态(connected)的Null事件, 给eventThread" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2010" y="1530" width="170" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-31" target="kyka5EhIQeqjiCoUDyh9-18">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2105.034482758621" y="1335" as="sourcePoint"/>
                        <mxPoint x="2105.034482758621" y="1357.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-21" value="connectionReq:" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2540" y="1460" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="kyka5EhIQeqjiCoUDyh9-22" target="kyka5EhIQeqjiCoUDyh9-24">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-22" value="&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;典型NIO收发包逻辑&lt;/font&gt;&lt;/b&gt;: buffer:&lt;br&gt;4个字节的length+真实数据:&lt;br&gt;这次buffer收不满下次收, 反正只有一个socket.&lt;br&gt;&lt;b&gt;&amp;nbsp;确保拆包粘包问题&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f8cecc;align=left;strokeColor=#b85450;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2481" y="1650" width="140" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-30" value="2. 发送完等待响应" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="kyka5EhIQeqjiCoUDyh9-24" target="MgtR8uemiQP_vpUSRu0I-39">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-46" value="1. 响应来了&lt;br&gt;处理" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.25;exitDx=0;exitDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="kyka5EhIQeqjiCoUDyh9-24" target="kyka5EhIQeqjiCoUDyh9-45">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-24" value="doIO() - &lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;普通收发包&lt;/font&gt;&lt;/b&gt;&lt;br&gt;1. 收数据时候: 收满了一条数据的byte, 就会掉sendThread&lt;br&gt;2. 发数据时候: 把数据序列化, 发出去. 如果不是ping之类的无意义请求, 把请求放在pendingQue里面等着响应." style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2267.5" y="1642.5" width="185" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-41" target="kyka5EhIQeqjiCoUDyh9-24">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2370" y="1460" as="sourcePoint"/>
                        <mxPoint x="2370" y="1500" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="kyka5EhIQeqjiCoUDyh9-31" target="kyka5EhIQeqjiCoUDyh9-3">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-31" value="&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic ; font-family: &amp;#34;courier new&amp;#34; , monospace&quot;&gt;协议版本号&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic&quot;&gt;0, lastZxid, sessionTimeout, sessId, sessionPasswd)&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2610" y="1465" width="310" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="kyka5EhIQeqjiCoUDyh9-33" target="MgtR8uemiQP_vpUSRu0I-41">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-33" value="connectionResp" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2540" y="1490" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-35" value="&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic ; font-family: &amp;#34;courier new&amp;#34; , monospace&quot;&gt;协议版本号&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic&quot;&gt;0, sessionTimeout, sessId, sessionPasswd)&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2610" y="1495" width="310" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="c9IUDB4x94eiGEWMFtiM-25" target="kyka5EhIQeqjiCoUDyh9-35">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-37" value="&lt;b&gt;sessionId&lt;/b&gt;:两次握手确认" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2080" y="1115" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-1" target="kyka5EhIQeqjiCoUDyh9-37">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985.0344827586207" y="1190" as="sourcePoint"/>
                        <mxPoint x="2030" y="1220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-1" target="kyka5EhIQeqjiCoUDyh9-40">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2045" y="1160" as="sourcePoint"/>
                        <mxPoint x="2090.0000792708142" y="1155.034482758621" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-40" value="&lt;b&gt;sessionPasswd&lt;/b&gt;" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2080" y="1157.5" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-44" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="kyka5EhIQeqjiCoUDyh9-41" target="kyka5EhIQeqjiCoUDyh9-43">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-41" value="queueEvent:&lt;br&gt;1. 从watcherMgr里挑出来感兴趣的watcher&lt;br&gt;2. 包装event-watcher入队" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="1755" y="1530" width="170" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-48" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="kyka5EhIQeqjiCoUDyh9-43" target="MgtR8uemiQP_vpUSRu0I-30">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-43" value="waitingEvents:&lt;br&gt;等待处理的" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="1630" y="1380" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-45" value="&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;readResponse&lt;/font&gt;&lt;/b&gt;(buffer)&lt;br&gt;TODO&lt;br&gt;&lt;b&gt;1. 如果pendingQue里面没有对应的请求, 就报错!!! 返回到run里面再建立连接.&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2010" y="1610" width="170" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="kyka5EhIQeqjiCoUDyh9-18" target="kyka5EhIQeqjiCoUDyh9-45">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2105" y="1420" as="sourcePoint"/>
                        <mxPoint x="2105" y="1540" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-6" value="启动的对应角色的组件" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="c9IUDB4x94eiGEWMFtiM-0" target="_xIqxkqASvMHlLcb5cVr-0">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-0" value="QuorumPeer:&lt;br&gt;线程, 一个zk服务" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="4170.5" y="1638" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-1" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3320" y="1244.64" width="912" height="353.36" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-2" value="&lt;span style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250); display: inline; float: none;&quot;&gt;NioServerCnxnFactory:&lt;/span&gt;&lt;br style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250);&quot;&gt;&lt;span style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250); display: inline; float: none;&quot;&gt;默认的nioserver&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3720.01" y="1244.64" width="135.99" height="44.36" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-3" value="2181端口" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3238" y="1349.8037290715374" width="131.10000000000005" height="67.8462709284627" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="kyka5EhIQeqjiCoUDyh9-11" target="c9IUDB4x94eiGEWMFtiM-2">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-11" value="acceptThread" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3426" y="1306" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-13" value="selectorThreads" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3568" y="1306" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-9" value="exporerThread" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3578" y="1250" width="80" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-7" value="workerPool" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3715" y="1305" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeColor=#FF0000;strokeWidth=2;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="kyka5EhIQeqjiCoUDyh9-3" target="c9IUDB4x94eiGEWMFtiM-2">
                    <mxGeometry x="3320" y="1241.25" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="kyka5EhIQeqjiCoUDyh9-11" target="kyka5EhIQeqjiCoUDyh9-13">
                    <mxGeometry x="3320" y="1241.25" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-8" value="检查过期conn" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;startArrow=none;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="kyka5EhIQeqjiCoUDyh9-9" target="kyka5EhIQeqjiCoUDyh9-13">
                    <mxGeometry x="3320" y="1241.25" as="geometry"/>
                </mxCell>
                <mxCell id="kyka5EhIQeqjiCoUDyh9-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="kyka5EhIQeqjiCoUDyh9-13" target="kyka5EhIQeqjiCoUDyh9-7">
                    <mxGeometry x="3320" y="1241.25" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#FF0000;strokeWidth=2;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="c9IUDB4x94eiGEWMFtiM-2" target="c9IUDB4x94eiGEWMFtiM-8">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-2" value="NIO接收新的socket,&amp;nbsp;&lt;br&gt;交给后面的selectorThread" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3406.95" y="1365.3000000000002" width="118.1" height="36.85" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-6" value="处理socket的事情" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3558.95" y="1357" width="118.1" height="15" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="kyka5EhIQeqjiCoUDyh9-13" target="c9IUDB4x94eiGEWMFtiM-6">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3476" y="1346" as="sourcePoint"/>
                        <mxPoint x="3475.9666666666667" y="1375.3000000000002" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-8" value="processAcceptedCnxns()&lt;br&gt;1. 为&lt;b&gt;新的socketC包装NioServerCnxn&lt;/b&gt;, 附在selectionKey里面, 记录好.&lt;br&gt;2. 注册到自己的selector上." style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3558.95" y="1372" width="118.1" height="54" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#FF0000;strokeWidth=2;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="c9IUDB4x94eiGEWMFtiM-10" target="c9IUDB4x94eiGEWMFtiM-18">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-28" value="为cnxn延期" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="c9IUDB4x94eiGEWMFtiM-10" target="c9IUDB4x94eiGEWMFtiM-26">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-10" value="select() - loop逻辑&lt;br&gt;1. 把有读写事件的selectionKey包装一下放入第一个worker里面运行&lt;br&gt;2. 同时关闭key的兴趣事件" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3558.95" y="1426" width="118.1" height="54" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-11" value="&lt;font style=&quot;font-size: 9px&quot;&gt;selector&lt;/font&gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;dashed=1;dashPattern=1 1;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3426" y="1335" width="36" height="17" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-14" value="&lt;font style=&quot;font-size: 9px&quot;&gt;selector&lt;/font&gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;dashed=1;dashPattern=1 1;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3576" y="1332.8" width="36" height="17" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="c9IUDB4x94eiGEWMFtiM-15" target="c9IUDB4x94eiGEWMFtiM-16">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-15" value="selectionKey" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3579" y="1546" width="79" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-16" value="&lt;b&gt;NIOServerCnxn&lt;/b&gt;:&lt;br&gt;维护一个client连接" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3558.95" y="1615" width="120" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-21" value="&lt;b&gt;最终socket的数据&lt;br&gt;都会来这里&lt;/b&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#FF0000;strokeWidth=2;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="c9IUDB4x94eiGEWMFtiM-18" target="c9IUDB4x94eiGEWMFtiM-25">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-18" value="第一个worker" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;dashed=1;dashPattern=1 1;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3715" y="1440" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="kyka5EhIQeqjiCoUDyh9-7" target="c9IUDB4x94eiGEWMFtiM-18">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3476.0000000000005" y="1346" as="sourcePoint"/>
                        <mxPoint x="3476.083333333333" y="1375.3000000000002" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="c9IUDB4x94eiGEWMFtiM-10" target="c9IUDB4x94eiGEWMFtiM-15">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3748" y="1346" as="sourcePoint"/>
                        <mxPoint x="3765.000000000001" y="1450" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="iZC0TIBgW0QKMaOiYxMS-17" value="1.2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="c9IUDB4x94eiGEWMFtiM-25" target="_xIqxkqASvMHlLcb5cVr-8">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-25" value="doIO(selectionKey)&lt;br&gt;1. 读取事件&lt;br&gt;1,1. 和发送时候一样len+data的nio读取策略&lt;br&gt;&lt;b&gt;1.2 第一个包是握手包, 把buffer发给zkServer&lt;br&gt;1.3 其他的包也把buffer数据交给zkServer&lt;br&gt;&lt;/b&gt;&lt;br&gt;2. 发送事件&lt;br&gt;&lt;b&gt;把outgoingBuffer里面的所有buffer, 都用socket写出去&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3518.29" y="1741" width="201.72" height="143" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-26" value="cnxnExpireQue&lt;br&gt;10s过期" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3499" y="1546" width="79" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="c9IUDB4x94eiGEWMFtiM-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="c9IUDB4x94eiGEWMFtiM-16" target="c9IUDB4x94eiGEWMFtiM-25">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3627.916666666667" y="1490" as="sourcePoint"/>
                        <mxPoint x="3628.5" y="1556" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-0" value="Leader/Follower/Observer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3864.5" y="1745" width="171" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-1" value="对应角色的&lt;br&gt;&lt;b&gt;ZookeeperServer&lt;br&gt;代表不同的处理链条&lt;br&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3820.5" y="1895" width="171" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-2" value="zk" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3856" y="1833" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="_xIqxkqASvMHlLcb5cVr-2" target="_xIqxkqASvMHlLcb5cVr-0">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4180.5" y="1678" as="sourcePoint"/>
                        <mxPoint x="3996.5" y="1678" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="_xIqxkqASvMHlLcb5cVr-2" target="_xIqxkqASvMHlLcb5cVr-1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3901.5" y="1880" as="sourcePoint"/>
                        <mxPoint x="3824.5" y="1505" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-17" value="3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="_xIqxkqASvMHlLcb5cVr-8" target="_xIqxkqASvMHlLcb5cVr-16">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-19" value="2. 创建session" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="_xIqxkqASvMHlLcb5cVr-8" target="_xIqxkqASvMHlLcb5cVr-10">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="3825" y="2002"/>
                            <mxPoint x="4275" y="2002"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-8" value="processConnectionRequests(cnxn, bytesBuff)&lt;br&gt;1. 反序列化&lt;br&gt;2. 搞一个本地的递增sessionId, 设置好cnxn&lt;br&gt;3. 把信息都包装成一个createSession类型的Request, 放入队列里" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3674" y="2019" width="201.72" height="59" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-10" value="createSession&lt;br&gt;1. learner的实现, 就是返回一个递增的sessionId&lt;br&gt;2. Leader的实现, 创建id, 并且把id和timeout包装起来存起来.&lt;br&gt;touch: 延期session" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="4176" y="1886.25" width="198" height="52" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-22" value="2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="_xIqxkqASvMHlLcb5cVr-12" target="_xIqxkqASvMHlLcb5cVr-20">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-12" value="submitRequestNow()&lt;br&gt;交给process链条处理:&amp;nbsp;&lt;br&gt;1. &lt;b&gt;touchSession: 延期&lt;/b&gt;.&amp;nbsp;&lt;br&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; color: rgb(135 , 16 , 148)&quot;&gt;2. firstProcessor&lt;/span&gt;&lt;span style=&quot;color: rgb(8 , 8 , 8) ; font-family: &amp;#34;consolas&amp;#34; , monospace&quot;&gt;.processRequest(si);&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3674" y="2129" width="201.72" height="58" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="_xIqxkqASvMHlLcb5cVr-1" target="_xIqxkqASvMHlLcb5cVr-8">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3915.5" y="1861" as="sourcePoint"/>
                        <mxPoint x="3960" y="1826" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="_xIqxkqASvMHlLcb5cVr-8" target="_xIqxkqASvMHlLcb5cVr-12">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3915.5" y="2001" as="sourcePoint"/>
                        <mxPoint x="3917.8999999999996" y="2039" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="_xIqxkqASvMHlLcb5cVr-16" target="_xIqxkqASvMHlLcb5cVr-12">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="iZC0TIBgW0QKMaOiYxMS-8" value="session过期&lt;br&gt;断掉连接" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;labelBackgroundColor=none;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="iZC0TIBgW0QKMaOiYxMS-14" target="iZC0TIBgW0QKMaOiYxMS-13">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4228.9" y="2055.25" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-16" value="&lt;b&gt;RequestThrottler:&lt;br&gt;可以暂时看成阻塞的队列&lt;br&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3832" y="2083" width="156" height="42" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-25" value="对于链接握手包&lt;br&gt;几乎没做什么处理" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="_xIqxkqASvMHlLcb5cVr-20" target="_xIqxkqASvMHlLcb5cVr-24">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-20" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=5;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3701" y="2236.5" width="409" height="74" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-21" value="Leader的链条" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=9;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3888" y="2266" width="65" height="15" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-27" value="握手响应包" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="_xIqxkqASvMHlLcb5cVr-24" target="_xIqxkqASvMHlLcb5cVr-26">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-24" value="finishSessionInit()&lt;br&gt;1. 把二次握手包组装好, 用递增的sessionId, 算好passwd. 组装好, 放入serverCnxn的&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-family: &amp;#34;consolas&amp;#34; , monospace&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;outgoingBuffers&lt;/font&gt;&lt;/span&gt;&lt;span&gt;队列里. 然后会注册socket的write事件.&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3798" y="2356" width="237" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="_xIqxkqASvMHlLcb5cVr-26" target="c9IUDB4x94eiGEWMFtiM-25">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-26" value="outgoingBuffer" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3362" y="1675" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="c9IUDB4x94eiGEWMFtiM-16" target="_xIqxkqASvMHlLcb5cVr-26">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3629" y="1670" as="sourcePoint"/>
                        <mxPoint x="3628" y="1703" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="JWMifir0Im7Wn5Q8Echb-16" value="1. 更新session桶" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#b85450;strokeWidth=1;fillColor=#f8cecc;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="_xIqxkqASvMHlLcb5cVr-30" target="_xIqxkqASvMHlLcb5cVr-10">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-30" value="&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;processPacket&lt;/font&gt;&lt;/b&gt;(cnxn, buff) - 处理普通请求&lt;br&gt;1. touch(cnxn) 更新session" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3974.2799999999997" y="2020.75" width="201.72" height="59" as="geometry"/>
                </mxCell>
                <mxCell id="_xIqxkqASvMHlLcb5cVr-31" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="_xIqxkqASvMHlLcb5cVr-1" target="_xIqxkqASvMHlLcb5cVr-30">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3915.5172413793107" y="2000.9999999999998" as="sourcePoint"/>
                        <mxPoint x="3915.4482758620697" y="2039.0000000000002" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="JWMifir0Im7Wn5Q8Echb-0" value="&lt;b&gt;SessionTracker:&lt;br&gt;run: 不断清理过期ses桶&lt;br&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="4392" y="1888.75" width="156" height="42" as="geometry"/>
                </mxCell>
                <mxCell id="JWMifir0Im7Wn5Q8Echb-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="_xIqxkqASvMHlLcb5cVr-10" target="JWMifir0Im7Wn5Q8Echb-0">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4075" y="1851.2500000000002" as="sourcePoint"/>
                        <mxPoint x="4327" y="1851.7500000000002" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="JWMifir0Im7Wn5Q8Echb-3" value="sessionsById&lt;br&gt;&amp;lt;递增sessId, Session&amp;lt;id, timeout&amp;gt;&amp;gt;" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="4336" y="1968.25" width="150" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="JWMifir0Im7Wn5Q8Echb-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="JWMifir0Im7Wn5Q8Echb-3" target="JWMifir0Im7Wn5Q8Echb-0">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4315.5" y="1919.75" as="sourcePoint"/>
                        <mxPoint x="4388" y="1933.25" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="JWMifir0Im7Wn5Q8Echb-5" value="sessionExpireQue" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="4486" y="1968.25" width="150" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="JWMifir0Im7Wn5Q8Echb-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="JWMifir0Im7Wn5Q8Echb-5" target="JWMifir0Im7Wn5Q8Echb-0">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4315.5" y="1919.7499999999998" as="sourcePoint"/>
                        <mxPoint x="4402" y="1919.7499999999998" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="JWMifir0Im7Wn5Q8Echb-7" value="nextSessionId: [8位myId] + [40位timestamp] + [16位0]" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f8cecc;align=left;strokeColor=#b85450;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="4595" y="1894.75" width="236" height="21.5" as="geometry"/>
                </mxCell>
                <mxCell id="JWMifir0Im7Wn5Q8Echb-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="JWMifir0Im7Wn5Q8Echb-7" target="JWMifir0Im7Wn5Q8Echb-0">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4571" y="1978.25" as="sourcePoint"/>
                        <mxPoint x="4480" y="1940.75" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="JWMifir0Im7Wn5Q8Echb-10" value="expireMap&amp;lt;time, set&amp;gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="4486" y="2034.75" width="150" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="JWMifir0Im7Wn5Q8Echb-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="JWMifir0Im7Wn5Q8Echb-5" target="JWMifir0Im7Wn5Q8Echb-10">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4571" y="1978.25" as="sourcePoint"/>
                        <mxPoint x="4480" y="1940.75" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="JWMifir0Im7Wn5Q8Echb-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="JWMifir0Im7Wn5Q8Echb-13" target="JWMifir0Im7Wn5Q8Echb-10">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="JWMifir0Im7Wn5Q8Echb-13" value="session分桶管理:&lt;br&gt;10s一桶, 因为10s默认timeout" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f8cecc;align=left;strokeColor=#b85450;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="4683" y="2042.25" width="74" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="iZC0TIBgW0QKMaOiYxMS-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="JWMifir0Im7Wn5Q8Echb-17" target="JWMifir0Im7Wn5Q8Echb-18">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="iZC0TIBgW0QKMaOiYxMS-6" value="touch session, 延期" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" vertex="1" connectable="0" parent="iZC0TIBgW0QKMaOiYxMS-5">
                    <mxGeometry x="-0.0205" relative="1" as="geometry">
                        <mxPoint x="1" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="JWMifir0Im7Wn5Q8Echb-17" value="ping请求" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2508" y="1932" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="iZC0TIBgW0QKMaOiYxMS-4" value="更新lastHeard时间戳, 但没有什么用. session再server维护" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="JWMifir0Im7Wn5Q8Echb-18" target="JWMifir0Im7Wn5Q8Echb-17">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="JWMifir0Im7Wn5Q8Echb-18" value="ping响应" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3081" y="1968" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="iZC0TIBgW0QKMaOiYxMS-0" value="lastHeard: &lt;br&gt;时间戳: 每次响应更新" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2277" y="1602" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="iZC0TIBgW0QKMaOiYxMS-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-41" target="iZC0TIBgW0QKMaOiYxMS-0">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2370" y="1560" as="sourcePoint"/>
                        <mxPoint x="2370" y="1652.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="iZC0TIBgW0QKMaOiYxMS-2" value="negotiateSession&lt;br&gt;Timeout:握手拿" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2077" y="1187.5" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="iZC0TIBgW0QKMaOiYxMS-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="MgtR8uemiQP_vpUSRu0I-1" target="iZC0TIBgW0QKMaOiYxMS-2">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2045" y="1160" as="sourcePoint"/>
                        <mxPoint x="2090.0000198176836" y="1182.4827586206898" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="JWMifir0Im7Wn5Q8Echb-15" value="run: 每桶间隔来清理" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=2;strokeColor=#FF0000;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="JWMifir0Im7Wn5Q8Echb-0" target="JWMifir0Im7Wn5Q8Echb-5">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="iZC0TIBgW0QKMaOiYxMS-9" value="ConnectionExpirerThread" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3888" y="1328.5" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="iZC0TIBgW0QKMaOiYxMS-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="iZC0TIBgW0QKMaOiYxMS-10">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2524" y="2029.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="iZC0TIBgW0QKMaOiYxMS-12" value="client这边没有发过请求, 会报错, 重新建立连接走一遍" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" vertex="1" connectable="0" parent="iZC0TIBgW0QKMaOiYxMS-11">
                    <mxGeometry x="-0.0662" y="-1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="iZC0TIBgW0QKMaOiYxMS-10" value="sessionTimeout之后:&amp;nbsp;&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-style: italic ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;closeSession&lt;/span&gt;" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="3083" y="2014.5" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="iZC0TIBgW0QKMaOiYxMS-13" value="run() 清理session会发一个请求, 最终转到zkServer发送一个sessionTimeout的请求.&lt;br&gt;还会经历process队列最终发出去的" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="4608" y="1930.75" width="182" height="31.5" as="geometry"/>
                </mxCell>
                <mxCell id="iZC0TIBgW0QKMaOiYxMS-14" value="sessionTimeout之后:&amp;nbsp;&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-style: italic ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;closeSession&lt;/span&gt;" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="4794" y="1933.25" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="iZC0TIBgW0QKMaOiYxMS-15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=1;strokeWidth=1;labelBackgroundColor=none;" edge="1" parent="MHNppVWY9drHL_FHM4H_-1" source="JWMifir0Im7Wn5Q8Echb-0" target="iZC0TIBgW0QKMaOiYxMS-14">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4548" y="1909.7205882352941" as="sourcePoint"/>
                        <mxPoint x="4608" y="1946.544117647059" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="iZC0TIBgW0QKMaOiYxMS-16" value="&lt;b&gt;几种典型的包和效果&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;strokeColor=#9673a6;fillColor=#e1d5e7;" vertex="1" parent="MHNppVWY9drHL_FHM4H_-1">
                    <mxGeometry x="2530" y="1892" width="588" height="19" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram name="ZK5. Leader的数据处理流程!!!" id="yY7ppPPQ66jO9e_vmY4q">
        <mxGraphModel grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" page="0" fold="1" pageScale="1" pageWidth="1100" pageHeight="850" math="0" shadow="0">
            <root>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-0"/>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-1" parent="3PNKWoKE6hOF7LYr9HsG-0"/>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-4" target="3PNKWoKE6hOF7LYr9HsG-13" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-4" target="3PNKWoKE6hOF7LYr9HsG-17" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-4" value="Zookeeper" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1485" y="1025" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-5" value="ClientCnxn:&lt;br&gt;维护与一个peer的连接" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1915" y="1120" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-7" target="3PNKWoKE6hOF7LYr9HsG-25" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-7" value="sendThread" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1990" y="1210" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-8" value="eventThread" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1900" y="1210" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-9" value="1. 启动ZK" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-11" target="3PNKWoKE6hOF7LYr9HsG-13" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-10" value="2. 执行命令" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#FF0000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-11" target="3PNKWoKE6hOF7LYr9HsG-19" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-11" value="ZookeeperMain: &lt;br&gt;启动类&lt;br&gt;1. 启动ZK&lt;br&gt;2. 监听命令输入, 执行" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1144" y="1140" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-12" value="2. 创建, 启动收发, event处理线程" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-13" target="3PNKWoKE6hOF7LYr9HsG-5" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-13" value="构造器&lt;br&gt;1. 创建一个clientCnx&lt;br&gt;2. 把clientCnx启动起来: 启动两个线程, 会正式连接上socket" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1460" y="1145" width="170" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-5" target="3PNKWoKE6hOF7LYr9HsG-7" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1755" y="1150" as="sourcePoint"/>
                        <mxPoint x="1755" y="1190" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-5" target="3PNKWoKE6hOF7LYr9HsG-8" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985" y="1190" as="sourcePoint"/>
                        <mxPoint x="1955" y="1220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-17" target="3PNKWoKE6hOF7LYr9HsG-5" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-17" value="ClientCnx" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1755" y="1045" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-18" value="2. 执行命令!!!" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-19" target="3PNKWoKE6hOF7LYr9HsG-23" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-19" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;while(true)&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;1. 解析命令行, 拿到对应的command类&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;2. 把zk和命令参数都给它, 执行command&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1119" y="1270" width="170" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-20" value="CliCommand:&lt;br&gt;所有command父类" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1244" y="1325" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-21" value="继承" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-23" target="3PNKWoKE6hOF7LYr9HsG-20" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-22" value="&lt;b&gt;发送请求&lt;/b&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#FF0000;strokeWidth=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-209" target="3PNKWoKE6hOF7LYr9HsG-40" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-23" value="CreateCommnad&lt;br&gt;LsCommand&lt;br&gt;SetCommand&lt;br&gt;DeleteCommand&lt;br&gt;..... 一系列的操作" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1244" y="1415" width="120" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-24" value="clientCnxnSocket" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2325" y="1290" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-25" value="SendThread:&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;发送消息, 心跳, 接收响应&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2035" y="1280" width="120" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-25" target="3PNKWoKE6hOF7LYr9HsG-24" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985.0344827586207" y="1190" as="sourcePoint"/>
                        <mxPoint x="2030" y="1220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-27" value="ClientCnxnSocketNio:&lt;br&gt;socket维护, Nio实现" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2300" y="1330" width="120" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-24" target="3PNKWoKE6hOF7LYr9HsG-27" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2030" y="1267.5" as="sourcePoint"/>
                        <mxPoint x="2100" y="1267.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-29" value="watcherMgr" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1630" y="1350" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-31" target="3PNKWoKE6hOF7LYr9HsG-29" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985.0344827586207" y="1190" as="sourcePoint"/>
                        <mxPoint x="1940" y="1220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-31" value="EventThread" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1780" y="1290" width="120" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-8" target="3PNKWoKE6hOF7LYr9HsG-31" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2060" y="1235" as="sourcePoint"/>
                        <mxPoint x="2130" y="1235" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-33" value="run()&lt;br&gt;1. 一直从waitingEvents队列里阻塞取事件组处理, 直到收到结束事件, 而且没有其他事件&lt;br&gt;2. 处理事件就是把每个watcher回调一下" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1755" y="1365" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-34" value="1. nio连接" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-36" target="3PNKWoKE6hOF7LYr9HsG-52" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-35" value="3. 新一轮收发包" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-36" target="3PNKWoKE6hOF7LYr9HsG-50" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-36" value="run() while(true)&lt;br&gt;1. 刚开始启动, 初始化nio连接:&lt;br&gt;&amp;nbsp; &amp;nbsp;- 从打乱的serverList里面顺序选一个连接&lt;br&gt;&lt;b&gt;2. 如果连接正常, 隔1s发送ping&lt;br&gt;&lt;/b&gt;3. nioSocket开始一轮select收发包" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;strokeColor=#FF0000;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2010" y="1347.5" width="170" height="62.5" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-37" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-25" target="3PNKWoKE6hOF7LYr9HsG-36" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2165" y="1302.5" as="sourcePoint"/>
                        <mxPoint x="2250" y="1302.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-31" target="3PNKWoKE6hOF7LYr9HsG-33" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2105.034482758621" y="1325" as="sourcePoint"/>
                        <mxPoint x="2105.034482758621" y="1340" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-40" target="3PNKWoKE6hOF7LYr9HsG-66" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-40" value="outgoingQue" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1910" y="1705" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-41" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-5" target="3PNKWoKE6hOF7LYr9HsG-40" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985.0344827586207" y="1190" as="sourcePoint"/>
                        <mxPoint x="2030" y="1220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-42" value="TCP连接" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;shape=link;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-43" target="3PNKWoKE6hOF7LYr9HsG-88" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-43" value="selector" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2490" y="1410" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-44" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-27" target="3PNKWoKE6hOF7LYr9HsG-43" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985" y="1372.5" as="sourcePoint"/>
                        <mxPoint x="2345" y="1400" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-45" value="pendingQue" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1970" y="1705" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-5" target="3PNKWoKE6hOF7LYr9HsG-45" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2045" y="1160" as="sourcePoint"/>
                        <mxPoint x="2195" y="1200" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-47" value="3. 连接响应&lt;br&gt;正式连接了" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-50" target="3PNKWoKE6hOF7LYr9HsG-59" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-48" value="4. 普通收发包" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-50" target="3PNKWoKE6hOF7LYr9HsG-66" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-49" value="&lt;b&gt;2. 两次握手&lt;br&gt;交换sessionId&lt;/b&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-50" target="3PNKWoKE6hOF7LYr9HsG-61" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-50" value="doTransport: - &lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;两次握手&lt;/font&gt;&lt;/b&gt;&lt;br&gt;1. selector.select(timeout)开始收socket的包&lt;br&gt;2. 如果是connected事件, 回调senThread, 包装一个connectionReq, 放到outgoing队列里, 然后注册selector的write事件, 下次就发出去.&lt;br&gt;3. 如果收到了connectionRsp响应, 回调sendThread.onConnection方法, 正式建立了&lt;br&gt;&lt;b&gt;4. 普通的selector事件处理:&amp;nbsp;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2267.5" y="1440" width="185" height="110" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-51" value="连上" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-52" target="3PNKWoKE6hOF7LYr9HsG-43" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-52" value="connect(addr)&lt;br&gt;1. 简单的创建socketChannel,绑定在selector上&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-style: italic ; background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;OP_CONNECT&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2282.5" y="1380" width="155" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-53" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-27" target="3PNKWoKE6hOF7LYr9HsG-52" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2430" y="1385.0344827586207" as="sourcePoint"/>
                        <mxPoint x="2535" y="1420" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-54" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-52" target="3PNKWoKE6hOF7LYr9HsG-50" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2370" y="1407.5" as="sourcePoint"/>
                        <mxPoint x="2370" y="1420" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-55" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-56" target="3PNKWoKE6hOF7LYr9HsG-86" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-56" value="serverCnxFactory" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3886.5" y="1645.5" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-57" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-85" target="3PNKWoKE6hOF7LYr9HsG-56" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3674.5" y="1041.5" as="sourcePoint"/>
                        <mxPoint x="3484.5" y="1051.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-58" value="2. watchedEvt" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-59" target="3PNKWoKE6hOF7LYr9HsG-79" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-59" value="onConnected()&lt;br&gt;1. &lt;b&gt;存起来sessionId和password&lt;/b&gt;&lt;br&gt;2. 包装一个连接状态(connected)的Null事件, 给eventThread" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2010" y="1530" width="170" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-60" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-36" target="3PNKWoKE6hOF7LYr9HsG-59" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2105.034482758621" y="1335" as="sourcePoint"/>
                        <mxPoint x="2105.034482758621" y="1357.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-61" value="connectionReq:" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2540" y="1460" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-62" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-63" target="3PNKWoKE6hOF7LYr9HsG-66" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-63" value="&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;典型NIO收发包逻辑&lt;/font&gt;&lt;/b&gt;: buffer:&lt;br&gt;4个字节的length+真实数据:&lt;br&gt;这次buffer收不满下次收, 反正只有一个socket.&lt;br&gt;&lt;b&gt;&amp;nbsp;确保拆包粘包问题&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f8cecc;align=left;strokeColor=#b85450;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2481" y="1650" width="140" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-64" value="2. 发送完等待响应" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-66" target="3PNKWoKE6hOF7LYr9HsG-45" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-65" value="1. 响应来了&lt;br&gt;处理" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.25;exitDx=0;exitDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-66" target="3PNKWoKE6hOF7LYr9HsG-82" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-66" value="doIO() - &lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;普通收发包&lt;/font&gt;&lt;/b&gt;&lt;br&gt;1. 收数据时候: 收满了一条数据的byte, 就会掉sendThread&lt;br&gt;2. 发数据时候: 把数据序列化, 发出去. 如果不是ping之类的无意义请求, 把请求放在pendingQue里面等着响应." style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2270" y="1642.5" width="185" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-67" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-50" target="3PNKWoKE6hOF7LYr9HsG-66" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2370" y="1460" as="sourcePoint"/>
                        <mxPoint x="2370" y="1500" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-68" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-69" target="3PNKWoKE6hOF7LYr9HsG-88" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-69" value="&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic ; font-family: &amp;#34;courier new&amp;#34; , monospace&quot;&gt;协议版本号&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic&quot;&gt;0, lastZxid, sessionTimeout, sessId, sessionPasswd)&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2610" y="1465" width="310" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-70" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-71" target="3PNKWoKE6hOF7LYr9HsG-50" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-71" value="connectionResp" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2540" y="1490" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-72" value="&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic ; font-family: &amp;#34;courier new&amp;#34; , monospace&quot;&gt;协议版本号&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic&quot;&gt;0, sessionTimeout, sessId, sessionPasswd)&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2610" y="1495" width="310" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-73" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-116" target="3PNKWoKE6hOF7LYr9HsG-72" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-74" value="&lt;b&gt;sessionId&lt;/b&gt;:两次握手确认" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2080" y="1115" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-75" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-5" target="3PNKWoKE6hOF7LYr9HsG-74" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985.0344827586207" y="1190" as="sourcePoint"/>
                        <mxPoint x="2030" y="1220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-76" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-5" target="3PNKWoKE6hOF7LYr9HsG-77" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2045" y="1160" as="sourcePoint"/>
                        <mxPoint x="2090.0000792708142" y="1155.034482758621" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-77" value="&lt;b&gt;sessionPasswd&lt;/b&gt;" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2080" y="1157.5" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-78" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-79" target="3PNKWoKE6hOF7LYr9HsG-81" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-79" value="queueEvent:&lt;br&gt;1. 从watcherMgr里挑出来感兴趣的watcher&lt;br&gt;2. 包装event-watcher入队" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1755" y="1530" width="170" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-80" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-81" target="3PNKWoKE6hOF7LYr9HsG-33" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-81" value="waitingEvents:&lt;br&gt;等待处理的" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1630" y="1380" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-82" value="&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;readResponse&lt;/font&gt;&lt;/b&gt;(buffer)&lt;br&gt;TODO&lt;br&gt;&lt;b&gt;1. 如果pendingQue里面没有对应的请求, 就报错!!! 返回到run里面再建立连接.&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2010" y="1610" width="170" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-83" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-59" target="3PNKWoKE6hOF7LYr9HsG-82" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2105" y="1420" as="sourcePoint"/>
                        <mxPoint x="2105" y="1540" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-84" value="启动的对应角色的组件" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-85" target="3PNKWoKE6hOF7LYr9HsG-119" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-85" value="QuorumPeer:&lt;br&gt;线程, 一个zk服务" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="4235.5" y="1638" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-86" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3320" y="1244.64" width="912" height="353.36" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-87" value="&lt;span style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250); display: inline; float: none;&quot;&gt;NioServerCnxnFactory:&lt;/span&gt;&lt;br style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250);&quot;&gt;&lt;span style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250); display: inline; float: none;&quot;&gt;默认的nioserver&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3720.01" y="1244.64" width="135.99" height="44.36" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-88" value="2181端口" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3238" y="1349.8037290715374" width="131.10000000000005" height="67.8462709284627" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-89" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-90" target="3PNKWoKE6hOF7LYr9HsG-99" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-90" value="acceptThread" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3426" y="1306" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-91" value="selectorThreads" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3568" y="1306" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-92" value="exporerThread" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3578" y="1250" width="80" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-93" value="workerPool" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3715" y="1305" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-94" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeWidth=2;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-88" target="3PNKWoKE6hOF7LYr9HsG-99" edge="1">
                    <mxGeometry x="3320" y="1241.25" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-95" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-90" target="3PNKWoKE6hOF7LYr9HsG-91" edge="1">
                    <mxGeometry x="3320" y="1241.25" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-96" value="检查过期conn" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;startArrow=none;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-92" target="3PNKWoKE6hOF7LYr9HsG-91" edge="1">
                    <mxGeometry x="3320" y="1241.25" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-97" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-91" target="3PNKWoKE6hOF7LYr9HsG-93" edge="1">
                    <mxGeometry x="3320" y="1241.25" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-98" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=2;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-99" target="3PNKWoKE6hOF7LYr9HsG-102" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-99" value="NIO接收新的socket,&amp;nbsp;&lt;br&gt;交给后面的selectorThread" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3406.95" y="1365.3000000000002" width="118.1" height="36.85" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-100" value="处理socket的事情" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3558.95" y="1357" width="118.1" height="15" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-101" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-91" target="3PNKWoKE6hOF7LYr9HsG-100" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3476" y="1346" as="sourcePoint"/>
                        <mxPoint x="3475.9666666666667" y="1375.3000000000002" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-102" value="processAcceptedCnxns()&lt;br&gt;1. 为&lt;b&gt;新的socketC包装NioServerCnxn&lt;/b&gt;, 附在selectionKey里面, 记录好.&lt;br&gt;2. 注册到自己的selector上." style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3558.95" y="1372" width="118.1" height="54" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-103" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=2;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-105" target="3PNKWoKE6hOF7LYr9HsG-112" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-104" value="为cnxn延期" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-105" target="3PNKWoKE6hOF7LYr9HsG-117" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-105" value="select() - loop逻辑&lt;br&gt;1. 把有读写事件的selectionKey包装一下放入第一个worker里面运行&lt;br&gt;2. 同时关闭key的兴趣事件" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3558.95" y="1426" width="118.1" height="54" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-106" value="&lt;font style=&quot;font-size: 9px&quot;&gt;selector&lt;/font&gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;dashed=1;dashPattern=1 1;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3426" y="1335" width="36" height="17" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-107" value="&lt;font style=&quot;font-size: 9px&quot;&gt;selector&lt;/font&gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;dashed=1;dashPattern=1 1;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3576" y="1332.8" width="36" height="17" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-108" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-109" target="3PNKWoKE6hOF7LYr9HsG-110" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-109" value="selectionKey" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3579" y="1546" width="79" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-110" value="&lt;b&gt;NIOServerCnxn&lt;/b&gt;:&lt;br&gt;维护一个client连接" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3558.95" y="1615" width="120" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-111" value="&lt;b&gt;最终socket的数据&lt;br&gt;都会来这里&lt;/b&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=2;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-112" target="3PNKWoKE6hOF7LYr9HsG-116" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-112" value="第一个worker" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;dashed=1;dashPattern=1 1;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3715" y="1440" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-113" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-93" target="3PNKWoKE6hOF7LYr9HsG-112" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3476.0000000000005" y="1346" as="sourcePoint"/>
                        <mxPoint x="3476.083333333333" y="1375.3000000000002" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-114" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-105" target="3PNKWoKE6hOF7LYr9HsG-109" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3748" y="1346" as="sourcePoint"/>
                        <mxPoint x="3765.000000000001" y="1450" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-115" value="1.2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-116" target="3PNKWoKE6hOF7LYr9HsG-126" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-116" value="doIO(selectionKey)&lt;br&gt;1. 读取事件&lt;br&gt;1,1. 和发送时候一样len+data的nio读取策略&lt;br&gt;&lt;b&gt;1.2 第一个包是握手包, 把buffer发给zkServer&lt;br&gt;1.3 其他的包也把buffer数据交给zkServer&lt;br&gt;&lt;/b&gt;&lt;br&gt;2. 发送事件&lt;br&gt;&lt;b&gt;把outgoingBuffer里面的所有buffer, 都用socket写出去&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3518.29" y="1741" width="201.72" height="143" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-117" value="cnxnExpireQue&lt;br&gt;10s过期" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3499" y="1546" width="79" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-118" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-110" target="3PNKWoKE6hOF7LYr9HsG-116" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3627.916666666667" y="1490" as="sourcePoint"/>
                        <mxPoint x="3628.5" y="1556" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-119" value="&lt;b&gt;Leader&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="4210" y="1741" width="171" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-120" value="Leader&lt;b&gt;ZookeeperServer&lt;br&gt;处理链条+session管理&lt;br&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3856" y="1897" width="171" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-121" value="zk" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3889" y="1816.5" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-122" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-121" target="3PNKWoKE6hOF7LYr9HsG-119" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4180.5" y="1678" as="sourcePoint"/>
                        <mxPoint x="3996.5" y="1678" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-123" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-121" target="3PNKWoKE6hOF7LYr9HsG-120" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3901.5" y="1880" as="sourcePoint"/>
                        <mxPoint x="3824.5" y="1505" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-124" value="3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-126" target="3PNKWoKE6hOF7LYr9HsG-134" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-205" value="&#10;&#10;&lt;span style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 9px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline; float: none;&quot;&gt;2. 创建session&lt;/span&gt;&#10;&#10;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-126" target="3PNKWoKE6hOF7LYr9HsG-146" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-126" value="processConnectionRequests(cnxn, bytesBuff)&lt;br&gt;1. 反序列化&lt;br&gt;2. 搞一个本地的递增sessionId, 设置好cnxn&lt;br&gt;3. 把信息都包装成一个createSession类型的Request, 放入队列里" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3674" y="2019" width="201.72" height="59" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-128" value="2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-129" target="3PNKWoKE6hOF7LYr9HsG-136" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-129" value="submitRequestNow()&lt;br&gt;交给process链条处理:&amp;nbsp;&lt;br&gt;1. &lt;b&gt;touchSession: 延期&lt;/b&gt;.&amp;nbsp;&lt;br&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; color: rgb(135 , 16 , 148)&quot;&gt;2. firstProcessor&lt;/span&gt;&lt;span style=&quot;color: rgb(8 , 8 , 8) ; font-family: &amp;#34;consolas&amp;#34; , monospace&quot;&gt;.processRequest(si);&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3811.64" y="2150" width="201.72" height="58" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-130" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-120" target="3PNKWoKE6hOF7LYr9HsG-126" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3915.5" y="1861" as="sourcePoint"/>
                        <mxPoint x="3960" y="1826" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-131" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-126" target="3PNKWoKE6hOF7LYr9HsG-129" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3915.5" y="2001" as="sourcePoint"/>
                        <mxPoint x="3917.8999999999996" y="2039" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-132" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-134" target="3PNKWoKE6hOF7LYr9HsG-129" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-134" value="&lt;b&gt;RequestThrottler:&lt;br&gt;可以暂时看成阻塞的队列&lt;br&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#82b366;fillColor=none;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3835.5" y="2100" width="154" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-135" value="对于链接握手包&lt;br&gt;几乎没做什么处理" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-136" target="3PNKWoKE6hOF7LYr9HsG-139" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-136" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=5;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3701" y="2236.5" width="409" height="74" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-137" value="Leader的链条:&amp;nbsp;&lt;span style=&quot;color: rgb(140 , 140 , 140) ; font-style: italic ; font-family: &amp;#34;consolas&amp;#34; , monospace&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;LeaderRequestProcessor -&amp;gt; prepRequestProcessor -&amp;gt; &lt;br&gt;proposalProcessor -&amp;gt; commitProcessor -&amp;gt; [leader -&amp;gt; finalProcessor]&lt;/font&gt;&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=9;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3734" y="2261" width="373" height="26" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-138" value="握手响应包" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-139" target="3PNKWoKE6hOF7LYr9HsG-141" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-139" value="finishSessionInit()&lt;br&gt;1. 把二次握手包组装好, 用递增的sessionId, 算好passwd. 组装好, 放入serverCnxn的&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-family: &amp;#34;consolas&amp;#34; , monospace&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;outgoingBuffers&lt;/font&gt;&lt;/span&gt;&lt;span&gt;队列里. 然后会注册socket的write事件.&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3293.5" y="2243" width="237" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-140" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-141" target="3PNKWoKE6hOF7LYr9HsG-116" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-141" value="outgoingBuffer" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3362" y="1675" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-142" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-110" target="3PNKWoKE6hOF7LYr9HsG-141" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3629" y="1670" as="sourcePoint"/>
                        <mxPoint x="3628" y="1703" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-143" value="1. 更新session桶" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#b85450;strokeWidth=1;fillColor=#f8cecc;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-129" target="3PNKWoKE6hOF7LYr9HsG-146" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4275" y="1938.2499999999995" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-212" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-144" target="3PNKWoKE6hOF7LYr9HsG-134" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-144" value="&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;processPacket&lt;/font&gt;&lt;/b&gt;(cnxn, buff) - 处理普通请求&lt;br&gt;1. 反序列化, 交给队列" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3953" y="2019.5" width="201.72" height="41" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-145" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-120" target="3PNKWoKE6hOF7LYr9HsG-144" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3915.5172413793107" y="2000.9999999999998" as="sourcePoint"/>
                        <mxPoint x="3915.4482758620697" y="2039.0000000000002" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-146" value="&lt;b&gt;SessionTracker:&lt;br&gt;run: 不断清理过期ses桶&lt;br&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="4245" y="1954.75" width="156" height="42" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-148" value="sessionsById&lt;br&gt;&amp;lt;sessId, Session&amp;lt;id, timeout&amp;gt;&amp;gt;" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="4206" y="2029.25" width="133" height="39.75" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-149" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-148" target="3PNKWoKE6hOF7LYr9HsG-146" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4168.5" y="1985.75" as="sourcePoint"/>
                        <mxPoint x="4241" y="1999.25" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-150" value="sessionExpireQue" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="4342" y="2028.25" width="113" height="38.75" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-151" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-150" target="3PNKWoKE6hOF7LYr9HsG-146" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4168.5" y="1985.7499999999998" as="sourcePoint"/>
                        <mxPoint x="4255" y="1985.7499999999998" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-152" value="nextSessionId: [8位myId] + [40位timestamp] + [16位0]" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f8cecc;align=left;strokeColor=#b85450;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="4427" y="1947" width="236" height="21.5" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-153" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-152" target="3PNKWoKE6hOF7LYr9HsG-146" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4424" y="2044.25" as="sourcePoint"/>
                        <mxPoint x="4333" y="2006.75" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-154" value="expireMap&amp;lt;time, set&amp;gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="4474" y="2032" width="124" height="31.25" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-155" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-150" target="3PNKWoKE6hOF7LYr9HsG-154" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4424" y="2044.25" as="sourcePoint"/>
                        <mxPoint x="4561" y="2048" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-156" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-157" target="3PNKWoKE6hOF7LYr9HsG-154" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-157" value="session分桶管理:&lt;br&gt;10s一桶, 因为10s默认timeout" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f8cecc;align=left;strokeColor=#b85450;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="4626" y="2032" width="74" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-158" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-160" target="3PNKWoKE6hOF7LYr9HsG-162" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-159" value="touch session, 延期" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" parent="3PNKWoKE6hOF7LYr9HsG-158" vertex="1" connectable="0">
                    <mxGeometry x="-0.0205" relative="1" as="geometry">
                        <mxPoint x="1" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-160" value="ping请求" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2508" y="1932" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-161" value="更新lastHeard时间戳, 但没有什么用. session再server维护" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-162" target="3PNKWoKE6hOF7LYr9HsG-160" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-162" value="ping响应" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3081" y="1968" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-163" value="lastHeard: &lt;br&gt;时间戳: 每次响应更新" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2277" y="1602" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-164" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-50" target="3PNKWoKE6hOF7LYr9HsG-163" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2370" y="1560" as="sourcePoint"/>
                        <mxPoint x="2370" y="1652.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-165" value="negotiateSession&lt;br&gt;Timeout:握手拿" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2077" y="1187.5" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-166" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-5" target="3PNKWoKE6hOF7LYr9HsG-165" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2045" y="1160" as="sourcePoint"/>
                        <mxPoint x="2090.0000198176836" y="1182.4827586206898" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-167" value="run: 每桶间隔来清理" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=2;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-146" target="3PNKWoKE6hOF7LYr9HsG-150" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-168" value="ConnectionExpirerThread" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3888" y="1328.5" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-169" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-171" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2524" y="2029.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-170" value="client这边没有发过请求, 会报错, 重新建立连接走一遍" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" parent="3PNKWoKE6hOF7LYr9HsG-169" vertex="1" connectable="0">
                    <mxGeometry x="-0.0662" y="-1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-171" value="sessionTimeout之后:&amp;nbsp;&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-style: italic ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;closeSession&lt;/span&gt;" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3083" y="2014.5" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-204" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-172" target="3PNKWoKE6hOF7LYr9HsG-173" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-172" value="run() 清理session会发一个请求, 最终转到zkServer发送一个sessionTimeout的请求.&lt;br&gt;还会经历process队列最终发出去的" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="4435" y="1983" width="182" height="31.5" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-173" value="&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-style: italic ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;closeSession&lt;/span&gt;" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="4642" y="1983.75" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="3PNKWoKE6hOF7LYr9HsG-175" value="&lt;b&gt;几种典型的包和效果&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="2530" y="1892" width="588" height="19" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-160" value="" style="group" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1" connectable="0">
                    <mxGeometry x="5041" y="2119.5" width="126" height="56" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-161" value="LearnerHandler:&lt;br&gt;满足learner的需求" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="ExK-BNytYWB1BpZ5nD6j-160" vertex="1">
                    <mxGeometry width="117" height="47" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-162" value="LearnerHandler:&lt;br&gt;满足learner的需求" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="ExK-BNytYWB1BpZ5nD6j-160" vertex="1">
                    <mxGeometry x="3" y="3" width="117" height="47" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-163" value="LearnerHandler:&lt;br&gt;满足learner的需求" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="ExK-BNytYWB1BpZ5nD6j-160" vertex="1">
                    <mxGeometry x="6" y="6" width="117" height="47" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-164" value="LearnerHandler:&lt;br&gt;满足learner的需求" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="ExK-BNytYWB1BpZ5nD6j-160" vertex="1">
                    <mxGeometry x="9" y="9" width="117" height="47" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-166" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeColor=#000000;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-167" target="ExK-BNytYWB1BpZ5nD6j-168" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-167" value="Follower" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="5692.5" y="2064" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-168" value="Learner" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="5797.5" y="1951" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-169" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeColor=#000000;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-170" target="ExK-BNytYWB1BpZ5nD6j-168" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-170" value="Observer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="5888.5" y="2064" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-171" value="2. 三次握手注册给leader" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=classic;startFill=1;strokeColor=#000000;strokeWidth=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-173" target="ExK-BNytYWB1BpZ5nD6j-201" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-172" value="1. 接受follower的注册: 三次握手" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" parent="ExK-BNytYWB1BpZ5nD6j-171" vertex="1" connectable="0">
                    <mxGeometry x="0.4769" y="2" relative="1" as="geometry">
                        <mxPoint x="11" y="2" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-64" value="不断地接受leader的消息" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-173" target="lR2BVqurL7FwfjYkvMsN-63">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-173" value="followerLeader()&lt;br&gt;1. 直接拿到vote的leader, 使用BIO的&lt;b&gt;socket&lt;/b&gt;连接, tcpNoDealy之类的参数设一下&lt;br&gt;2. 注册到leader上: 发送sid-zxid, 接收新的zxid" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="5597.5" y="2202.5" width="310" height="105" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-174" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-167" target="ExK-BNytYWB1BpZ5nD6j-173" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5102.5" y="1397" as="sourcePoint"/>
                        <mxPoint x="5102.5" y="1492" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-176" value="构造器: 创建一个BIOServerSocket, 绑定2888端口" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="4488" y="1592.75" width="224" height="41" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-177" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-119" target="ExK-BNytYWB1BpZ5nD6j-176" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5124" y="2246" as="sourcePoint"/>
                        <mxPoint x="5153" y="2335" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-179" value="2. 监听" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-180" target="ExK-BNytYWB1BpZ5nD6j-187" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-180" value="lead() - 启动方法&lt;br&gt;1. zkServer.loadData. 准备好数据&lt;br&gt;2. 启动2888端口的acceptor&lt;br&gt;3. === 开启新的一轮epoch. TODO&lt;br&gt;..." style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="4488" y="1633.75" width="224" height="109.5" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-181" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-176" target="ExK-BNytYWB1BpZ5nD6j-180" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5134" y="2256" as="sourcePoint"/>
                        <mxPoint x="5134" y="2314" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-182" value="serverSockets:&lt;br&gt;2888" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="4860" y="1798" width="69" height="34" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-187" value="cnxAcceptor" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="4860" y="1822" width="69" height="34" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-188" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-119" target="ExK-BNytYWB1BpZ5nD6j-187" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5064" y="2216.0588235294117" as="sourcePoint"/>
                        <mxPoint x="5134" y="2314" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-191" value="LearnerCnxAcceptor&lt;br&gt;处理learner的连接" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="4835" y="2019.5" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-192" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.422;entryY=0.45;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=9;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-193" target="ExK-BNytYWB1BpZ5nD6j-197" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-193" value="run()&lt;br&gt;1. 接收2888端口的新socket, 包装一个来&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;LearnerHandler&lt;/span&gt;&lt;span&gt;维护leader-learner的交流&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="5012.5" y="2021.5" width="183" height="56" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-194" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-191" target="ExK-BNytYWB1BpZ5nD6j-193" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5378" y="1987.5" as="sourcePoint"/>
                        <mxPoint x="5378" y="2034.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-195" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-191" target="ExK-BNytYWB1BpZ5nD6j-187" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5464" y="2286" as="sourcePoint"/>
                        <mxPoint x="5392.5" y="2239" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-196" value="每个learner一个" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-193" target="ExK-BNytYWB1BpZ5nD6j-163" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-197" value="2888" style="outlineConnect=0;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;shape=mxgraph.aws3.elastic_network_interface;fillColor=#F58534;gradientColor=none;fontSize=9;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="5230.29" y="2030" width="41.21" height="43" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-198" value="TCP连接" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.98;entryY=0.532;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=9;strokeColor=#000000;strokeWidth=1;startArrow=classic;startFill=1;shape=link;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-199" target="ExK-BNytYWB1BpZ5nD6j-165" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-199" value="socket" style="aspect=fixed;html=1;points=[];align=center;image;fontSize=12;image=img/lib/mscae/Connection.svg;fillColor=none;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="5603.5" y="2136.5" width="50" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-200" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-167" target="ExK-BNytYWB1BpZ5nD6j-199" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5762.5" y="2134" as="sourcePoint"/>
                        <mxPoint x="5829.5" y="2143" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-201" value="run()&lt;br&gt;&lt;b&gt;1. 和followersocket打开之后, 马上&quot;三次握手&quot;, 确认folower的zxid, 把自己的zxid发出去&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="5017" y="2218.5" width="183" height="56" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-202" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-164" target="ExK-BNytYWB1BpZ5nD6j-201" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5114" y="1997" as="sourcePoint"/>
                        <mxPoint x="5114" y="2031.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-203" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-172" target="3PNKWoKE6hOF7LYr9HsG-146" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4437" y="1967.75" as="sourcePoint"/>
                        <mxPoint x="4411" y="1985.6666666666665" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-206" value="loadData()&lt;br&gt;1. 检查zkDB是不是初始化好了&lt;br&gt;2. 清理zkDB里面过期session&lt;br&gt;3. 让log组件做一个snapshot" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="4054" y="1849" width="188" height="63" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-208" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-206" target="3PNKWoKE6hOF7LYr9HsG-120" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3784.8599999999997" y="2088" as="sourcePoint"/>
                        <mxPoint x="3784.8599999999997" y="2139" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-165" value="socket" style="aspect=fixed;html=1;points=[];align=center;image;fontSize=12;image=img/lib/mscae/Connection.svg;fillColor=none;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="5153.29" y="2136.5" width="50" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-210" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-13" target="ExK-BNytYWB1BpZ5nD6j-209" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1555" y="1095" as="sourcePoint"/>
                        <mxPoint x="1555" y="1155" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-209" value="CRUD/.... 之类的API&lt;br&gt;包装一个Request, 包含类型路径,数据之类的命令." style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="1464" y="1690.5" width="170" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-211" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#FF0000;strokeWidth=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-23" target="ExK-BNytYWB1BpZ5nD6j-209" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1304" y="1485" as="sourcePoint"/>
                        <mxPoint x="1910" y="1720" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-218" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-215" target="ExK-BNytYWB1BpZ5nD6j-217" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-215" value="&lt;b&gt;LeaderRequestProcessor: 升级本地session&lt;/b&gt;&lt;br&gt;判断是不是创建临时节点并且是本地session.&lt;br&gt;是的话就升级" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3708" y="2318" width="190.72" height="37" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-226" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-216" target="ExK-BNytYWB1BpZ5nD6j-224" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-216" value="&lt;b&gt;PrepRequestProcessor: 创建事务&lt;br&gt;run()&lt;br&gt;1. 给request创建下一个zxid的transaction&lt;br&gt;2. 把当前node和parentNode的两条changeRecord加入到zkServer里面的outstandingChanges&lt;/b&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3708" y="2399" width="190.72" height="69" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-219" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-217" target="ExK-BNytYWB1BpZ5nD6j-216" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-217" value="submittedRequests&lt;br&gt;阻塞队列" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3924" y="2372" width="133" height="39.75" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-220" value="outstandingChanges" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3715" y="1926" width="107.86" height="36" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-221" value="hzxid" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3715" y="1890" width="107.86" height="36" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-222" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-120" target="ExK-BNytYWB1BpZ5nD6j-220" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3951.51724137931" y="1967" as="sourcePoint"/>
                        <mxPoint x="3784.8275862068967" y="2029" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-223" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-120" target="ExK-BNytYWB1BpZ5nD6j-221" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3866" y="1937.034482758621" as="sourcePoint"/>
                        <mxPoint x="3832.8600000000006" y="1954" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-0" value="2.1&lt;br&gt;等待" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-224" target="lR2BVqurL7FwfjYkvMsN-6">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-16" value="2.2 给所有的learner发出去" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-224" target="lR2BVqurL7FwfjYkvMsN-9">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-27" value="2.3 刷盘" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;startArrow=none;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-224" target="lR2BVqurL7FwfjYkvMsN-18">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-224" value="&lt;b&gt;ProposalProcessor: 简单分发&lt;br&gt;1. 对于learner的同步请求,, 给leader执行sync&lt;br&gt;2. 对于leader的客户端的请求&lt;br&gt;2.1 交给commitProfessor&lt;br&gt;2.2 交给leader做propose()&lt;br&gt;2.3 交给syncProcessor加入DB+刷盘&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="3708" y="2518" width="190.72" height="69" as="geometry"/>
                </mxCell>
                <mxCell id="ExK-BNytYWB1BpZ5nD6j-227" value="&lt;b&gt;&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="3PNKWoKE6hOF7LYr9HsG-1" vertex="1">
                    <mxGeometry x="4110" y="2777" width="388" height="158" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-1" value="queueRequests" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="4222" y="2874" width="95" height="29" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-2" value="queueWriteRequests" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="4219" y="2903" width="114" height="29" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-3" value="&lt;b style=&quot;color: rgb(0 , 0 , 0) ; font-family: &amp;#34;helvetica&amp;#34; ; font-size: 9px ; font-style: normal ; letter-spacing: normal ; text-align: left ; text-indent: 0px ; text-transform: none ; word-spacing: 0px ; background-color: rgb(255 , 255 , 255)&quot;&gt;CommitProfessor: &lt;/b&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0) ; font-family: &amp;#34;helvetica&amp;#34; ; font-size: 9px ; font-style: normal ; letter-spacing: normal ; text-align: left ; text-indent: 0px ; text-transform: none ; word-spacing: 0px ; background-color: rgb(255 , 255 , 255)&quot;&gt;把请求添加到队列里, write请求多添加到write队列里&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="4190.5" y="2777" width="151.5" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-60" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="lR2BVqurL7FwfjYkvMsN-4" target="lR2BVqurL7FwfjYkvMsN-49">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-4" value="commitedReqs" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="4367" y="2798" width="95" height="29" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-5" value="" style="shape=image;verticalLabelPosition=bottom;labelBackgroundColor=#ffffff;verticalAlign=top;aspect=fixed;imageAspect=0;image=https://img2018.cnblogs.com/blog/846961/201906/846961-20190605004041459-1894253433.png;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="3118.22" y="3057" width="695.56" height="519" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-7" value="1. 所有req" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="lR2BVqurL7FwfjYkvMsN-6" target="lR2BVqurL7FwfjYkvMsN-1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-8" value="2需要commit" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="lR2BVqurL7FwfjYkvMsN-6" target="lR2BVqurL7FwfjYkvMsN-2">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-6" value="&lt;b&gt;processRequest:&lt;/b&gt;&lt;br&gt;1. 加入queueRequests里&lt;br&gt;2. 需要commit的request加入到writeQueue里" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="4110" y="2834.5" width="125.5" height="43" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-13" value="发给所有learner" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="lR2BVqurL7FwfjYkvMsN-9" target="lR2BVqurL7FwfjYkvMsN-11">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-9" value="propose(req)&lt;br&gt;1. 把request包装一个&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-style: italic ; font-family: &amp;#34;consolas&amp;#34; , monospace&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;PROPOSAL&lt;/font&gt;&lt;/span&gt;&lt;span&gt;的package&lt;/span&gt;&lt;br&gt;2. 发给所有的learnerHandler" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="4674" y="2377.87" width="176.86" height="42" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-65" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="lR2BVqurL7FwfjYkvMsN-11" target="lR2BVqurL7FwfjYkvMsN-63">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-11" value="&lt;b&gt;queuePackage(package)&lt;br&gt;添加pacakge到发送队列&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="5017" y="2363.87" width="183" height="56" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-201" target="lR2BVqurL7FwfjYkvMsN-11">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5118.5" y="2185.4999999999995" as="sourcePoint"/>
                        <mxPoint x="5118.5" y="2228.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="3PNKWoKE6hOF7LYr9HsG-119" target="lR2BVqurL7FwfjYkvMsN-9">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4391" y="1781" as="sourcePoint"/>
                        <mxPoint x="4904.499999999999" y="1832" as="targetPoint"/>
                        <Array as="points">
                            <mxPoint x="4751" y="1771"/>
                            <mxPoint x="4751" y="2399"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-32" value="3. commit刷盘" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="lR2BVqurL7FwfjYkvMsN-17" target="lR2BVqurL7FwfjYkvMsN-30">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-44" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="lR2BVqurL7FwfjYkvMsN-17" target="lR2BVqurL7FwfjYkvMsN-40">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-17" value="&lt;b&gt;&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="4165" y="2616" width="330" height="123.5" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="lR2BVqurL7FwfjYkvMsN-18" target="lR2BVqurL7FwfjYkvMsN-25">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-18" value="queueRequests" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="4173" y="2680.5" width="95" height="29" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-20" value="&lt;span style=&quot;font-size: 9px ; font-style: normal ; letter-spacing: normal ; text-align: left ; text-indent: 0px ; text-transform: none ; word-spacing: 0px ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font face=&quot;helvetica&quot; style=&quot;color: rgb(0 , 0 , 0) ; font-weight: bold&quot;&gt;SyncProfessor: &lt;/font&gt;&lt;br&gt;&lt;font face=&quot;helvetica&quot;&gt;&lt;font color=&quot;#ff0000&quot;&gt;size+count+flushDelay来判断隔一会调用ZKDatabase.commit刷盘&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="4245.5" y="2616" width="151.5" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-31" value="2. append追加" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="lR2BVqurL7FwfjYkvMsN-25" target="lR2BVqurL7FwfjYkvMsN-30">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-25" value="&lt;b&gt;run()&lt;br&gt;1. 从queue中阻塞(timeout)拿requ&lt;br&gt;2. 把req塞入zkDatabase.append追加log&lt;br&gt;3. 隔一会掉ZKDB.commit, 然后交给下一个processor处理.&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="4294.28" y="2660.5" width="190.72" height="69" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-28" value="syncProcessor" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="3936.5" y="2593" width="95" height="29" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-30" value="zkDb" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="4682" y="2649" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="ExK-BNytYWB1BpZ5nD6j-224" target="lR2BVqurL7FwfjYkvMsN-28">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3908.7199999999993" y="2562.500000000001" as="sourcePoint"/>
                        <mxPoint x="3994" y="2667.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-45" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="lR2BVqurL7FwfjYkvMsN-40" target="lR2BVqurL7FwfjYkvMsN-42">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-40" value="&lt;span style=&quot;font-size: 9px ; font-style: normal ; letter-spacing: normal ; text-align: left ; text-indent: 0px ; text-transform: none ; word-spacing: 0px ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font face=&quot;helvetica&quot;&gt;&lt;b&gt;AckRequestProcessor:&lt;br&gt;&lt;/b&gt;直接调leader.processAck&lt;br&gt;&lt;/font&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="4455" y="2533" width="151.5" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-46" value="2.1 票数够了, 可以commit了" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="lR2BVqurL7FwfjYkvMsN-42" target="lR2BVqurL7FwfjYkvMsN-11">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-48" value="2.2 提交req,&amp;nbsp;&lt;br&gt;已经多数写了" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="lR2BVqurL7FwfjYkvMsN-42" target="lR2BVqurL7FwfjYkvMsN-4">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4380" y="2964" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-42" value="processAck(myid, zxid)&lt;br&gt;1. 把proposal从队列里拿出来, 给它投一个server的sid票&lt;br&gt;2. 如果票数够了,&amp;nbsp;&lt;br&gt;2.1, 给所有的follower发送commit的package&lt;br&gt;2.2 调用本身的commitProcessor来提交zxid" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="4649.43" y="2447" width="226" height="59" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-43" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="lR2BVqurL7FwfjYkvMsN-9" target="lR2BVqurL7FwfjYkvMsN-42">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3908.7200000000003" y="2562.5714285714294" as="sourcePoint"/>
                        <mxPoint x="3995.25" y="2667.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-59" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="lR2BVqurL7FwfjYkvMsN-49" target="lR2BVqurL7FwfjYkvMsN-57">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-49" value="&lt;font face=&quot;helvetica&quot;&gt;&lt;b&gt;run:&lt;br&gt;&lt;/b&gt;&lt;/font&gt;1. 从commitedReq里面拿提交的req&lt;br&gt;2. 维护几个queue&lt;br&gt;3. 把commited好的req通过worker发给下一个processor" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="4336.5" y="2854" width="155" height="64" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-53" value="&lt;pre style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;FinalProcessor&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="4172" y="3024" width="164" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-61" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="lR2BVqurL7FwfjYkvMsN-57" target="3PNKWoKE6hOF7LYr9HsG-141">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-62" value="响应" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="lR2BVqurL7FwfjYkvMsN-61">
                    <mxGeometry x="-0.6913" y="-2" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="UaPRr-t_lMdhw9GQidHw-0" value="2. 处理这条txn,到内存数据库里" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="lR2BVqurL7FwfjYkvMsN-57" target="lR2BVqurL7FwfjYkvMsN-30">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-57" value="&lt;b&gt;processRequest:&lt;/b&gt;&lt;br&gt;1. 根据请求的类型, 调用/包装返回 响应&lt;br&gt;2. 调用ZKDB.procesTxn, 把数据搞到内存数据库里" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="4172" y="3057" width="164.5" height="43" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-66" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="lR2BVqurL7FwfjYkvMsN-63" target="lR2BVqurL7FwfjYkvMsN-11">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-67" value="proposal, commit 请求&amp;amp;响应" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="lR2BVqurL7FwfjYkvMsN-66">
                    <mxGeometry x="0.2118" y="1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="lR2BVqurL7FwfjYkvMsN-63" value="processPacket(quorumPacket):&lt;br&gt;1. 如果是proposal的请求: 大概干的事情流程&lt;br&gt;1.1 使用&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;syncProcessor&lt;/span&gt;&lt;span&gt;&amp;nbsp;刷盘&lt;br&gt;&lt;/span&gt;1.2 刷盘完成后, 交给ackProcessor给响应&lt;br&gt;2. 如果是commit请求,&amp;nbsp;&lt;br&gt;&amp;nbsp;交给follower的&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;commitProcessor&lt;/span&gt;&lt;span&gt;来处理,&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="5597.5" y="2368" width="310" height="105" as="geometry"/>
                </mxCell>
                <mxCell id="JAWkaywf2FrvuUkUFmy7-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="3PNKWoKE6hOF7LYr9HsG-1" source="JAWkaywf2FrvuUkUFmy7-0" target="lR2BVqurL7FwfjYkvMsN-40">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="JAWkaywf2FrvuUkUFmy7-0" value="&lt;font color=&quot;#ff0000&quot;&gt;&lt;b&gt;事务顺序保证&lt;/b&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f8cecc;align=left;strokeColor=#b85450;" vertex="1" parent="3PNKWoKE6hOF7LYr9HsG-1">
                    <mxGeometry x="4498.25" y="2470" width="65" height="23" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram name="ZK6. ZKDatabase维护数据+CRUD流程+监听机制" id="sPpbvzX77a-fmtZef5SL">
        <mxGraphModel dx="814" dy="-10" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="1100" pageHeight="850" math="0" shadow="0">
            <root>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-0"/>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-1" parent="YaZeodDi9gsK6JLhhhEP-0"/>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-2" value="" style="group" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1" connectable="0">
                    <mxGeometry x="6259" y="2960" width="170" height="117" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-278" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="WTuq9ii3-j0sf-YxppwB-2" vertex="1">
                    <mxGeometry y="0.001989762078942262" width="170" height="116.99801023792106" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-1" value="&lt;span style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline; float: none;&quot;&gt;磁盘: dataLogDir&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;" parent="WTuq9ii3-j0sf-YxppwB-2" vertex="1">
                    <mxGeometry x="28.497142857142535" width="110" height="29.249502559480266" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-0" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;dataLogDir/log.起始txid&lt;br&gt;&lt;/b&gt;头[magic, version, dbid]&lt;br&gt;[CRC, bytes(txnHdr, record, digest]&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="WTuq9ii3-j0sf-YxppwB-2" vertex="1">
                    <mxGeometry x="5.75" y="29.25" width="158.5" height="39.75" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-7" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;dataLogDir/log.起始txid&lt;br&gt;&lt;/b&gt;头[magic, version, dbid]&lt;br&gt;[CRC, bytes(txnHdr, record, digest]&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="WTuq9ii3-j0sf-YxppwB-2" vertex="1">
                    <mxGeometry x="5.75" y="73" width="158.5" height="39.75" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-4" target="YaZeodDi9gsK6JLhhhEP-13" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-4" target="YaZeodDi9gsK6JLhhhEP-17" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-4" value="Zookeeper" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1485" y="1025" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-5" value="ClientCnxn:&lt;br&gt;维护与一个peer的连接" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1915" y="1120" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-7" target="YaZeodDi9gsK6JLhhhEP-25" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-7" value="sendThread" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1990" y="1210" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-8" value="eventThread" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1900" y="1210" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-9" value="1. 启动ZK" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-11" target="YaZeodDi9gsK6JLhhhEP-13" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-10" value="2. 执行命令" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#FF0000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-11" target="YaZeodDi9gsK6JLhhhEP-19" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-11" value="ZookeeperMain: &lt;br&gt;启动类&lt;br&gt;1. 启动ZK&lt;br&gt;2. 监听命令输入, 执行" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1144" y="1140" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-12" value="2. 创建, 启动收发, event处理线程" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-13" target="YaZeodDi9gsK6JLhhhEP-5" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-13" value="构造器&lt;br&gt;1. 创建一个clientCnx&lt;br&gt;2. 把clientCnx启动起来: 启动两个线程, 会正式连接上socket" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1460" y="1145" width="170" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-5" target="YaZeodDi9gsK6JLhhhEP-7" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1755" y="1150" as="sourcePoint"/>
                        <mxPoint x="1755" y="1190" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-5" target="YaZeodDi9gsK6JLhhhEP-8" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985" y="1190" as="sourcePoint"/>
                        <mxPoint x="1955" y="1220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-17" target="YaZeodDi9gsK6JLhhhEP-5" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-17" value="ClientCnx" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1755" y="1045" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-18" value="2. 执行命令!!!" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-19" target="YaZeodDi9gsK6JLhhhEP-23" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-19" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;while(true)&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;1. 解析命令行, 拿到对应的command类&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;2. 把zk和命令参数都给它, 执行command&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1119" y="1270" width="170" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-20" value="CliCommand:&lt;br&gt;所有command父类" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1244" y="1325" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-21" value="继承" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-23" target="YaZeodDi9gsK6JLhhhEP-20" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-22" value="&lt;b&gt;发送请求&lt;/b&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#FF0000;strokeWidth=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-214" target="YaZeodDi9gsK6JLhhhEP-40" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-23" value="CreateCommnad&lt;br&gt;LsCommand&lt;br&gt;SetCommand&lt;br&gt;DeleteCommand&lt;br&gt;..... 一系列的操作" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1244" y="1415" width="120" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-24" value="clientCnxnSocket" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2325" y="1290" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-25" value="SendThread:&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;发送消息, 心跳, 接收响应&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2035" y="1280" width="120" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-25" target="YaZeodDi9gsK6JLhhhEP-24" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985.0344827586207" y="1190" as="sourcePoint"/>
                        <mxPoint x="2030" y="1220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-27" value="ClientCnxnSocketNio:&lt;br&gt;socket维护, Nio实现" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2300" y="1330" width="120" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-24" target="YaZeodDi9gsK6JLhhhEP-27" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2030" y="1267.5" as="sourcePoint"/>
                        <mxPoint x="2100" y="1267.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-29" value="watcherMgr" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1630" y="1350" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-31" target="YaZeodDi9gsK6JLhhhEP-29" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985.0344827586207" y="1190" as="sourcePoint"/>
                        <mxPoint x="1940" y="1220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-31" value="EventThread" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1780" y="1290" width="120" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-8" target="YaZeodDi9gsK6JLhhhEP-31" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2060" y="1235" as="sourcePoint"/>
                        <mxPoint x="2130" y="1235" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-33" value="run()&lt;br&gt;1. 一直从waitingEvents队列里阻塞取事件组处理, 直到收到结束事件, 而且没有其他事件&lt;br&gt;2. 处理事件就是把每个watcher回调一下" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1755" y="1365" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-34" value="1. nio连接" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-36" target="YaZeodDi9gsK6JLhhhEP-52" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-35" value="3. 新一轮收发包" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-36" target="YaZeodDi9gsK6JLhhhEP-50" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-36" value="run() while(true)&lt;br&gt;1. 刚开始启动, 初始化nio连接:&lt;br&gt;&amp;nbsp; &amp;nbsp;- 从打乱的serverList里面顺序选一个连接&lt;br&gt;&lt;b&gt;2. 如果连接正常, 隔1s发送ping&lt;br&gt;&lt;/b&gt;3. nioSocket开始一轮select收发包" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;strokeColor=#FF0000;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2010" y="1347.5" width="170" height="62.5" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-37" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-25" target="YaZeodDi9gsK6JLhhhEP-36" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2165" y="1302.5" as="sourcePoint"/>
                        <mxPoint x="2250" y="1302.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-31" target="YaZeodDi9gsK6JLhhhEP-33" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2105.034482758621" y="1325" as="sourcePoint"/>
                        <mxPoint x="2105.034482758621" y="1340" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-40" target="YaZeodDi9gsK6JLhhhEP-66" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-40" value="outgoingQue" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1910" y="1705" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-41" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-5" target="YaZeodDi9gsK6JLhhhEP-40" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985.0344827586207" y="1190" as="sourcePoint"/>
                        <mxPoint x="2030" y="1220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-42" value="TCP连接" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;shape=link;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-43" target="YaZeodDi9gsK6JLhhhEP-88" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-43" value="selector" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2490" y="1410" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-44" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-27" target="YaZeodDi9gsK6JLhhhEP-43" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985" y="1372.5" as="sourcePoint"/>
                        <mxPoint x="2345" y="1400" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-45" value="pendingQue" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1970" y="1705" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-5" target="YaZeodDi9gsK6JLhhhEP-45" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2045" y="1160" as="sourcePoint"/>
                        <mxPoint x="2195" y="1200" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-47" value="3. 连接响应&lt;br&gt;正式连接了" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-50" target="YaZeodDi9gsK6JLhhhEP-59" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-48" value="4. 普通收发包" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-50" target="YaZeodDi9gsK6JLhhhEP-66" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-49" value="&lt;b&gt;2. 两次握手&lt;br&gt;交换sessionId&lt;/b&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-50" target="YaZeodDi9gsK6JLhhhEP-61" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-50" value="doTransport: - &lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;两次握手&lt;/font&gt;&lt;/b&gt;&lt;br&gt;1. selector.select(timeout)开始收socket的包&lt;br&gt;2. 如果是connected事件, 回调senThread, 包装一个connectionReq, 放到outgoing队列里, 然后注册selector的write事件, 下次就发出去.&lt;br&gt;3. 如果收到了connectionRsp响应, 回调sendThread.onConnection方法, 正式建立了&lt;br&gt;&lt;b&gt;4. 普通的selector事件处理:&amp;nbsp;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2267.5" y="1440" width="185" height="110" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-51" value="连上" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-52" target="YaZeodDi9gsK6JLhhhEP-43" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-52" value="connect(addr)&lt;br&gt;1. 简单的创建socketChannel,绑定在selector上&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-style: italic ; background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;OP_CONNECT&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2282.5" y="1380" width="155" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-53" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-27" target="YaZeodDi9gsK6JLhhhEP-52" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2430" y="1385.0344827586207" as="sourcePoint"/>
                        <mxPoint x="2535" y="1420" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-54" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-52" target="YaZeodDi9gsK6JLhhhEP-50" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2370" y="1407.5" as="sourcePoint"/>
                        <mxPoint x="2370" y="1420" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-55" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-56" target="YaZeodDi9gsK6JLhhhEP-86" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-56" value="serverCnxFactory" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3886.5" y="1645.5" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-57" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-85" target="YaZeodDi9gsK6JLhhhEP-56" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3674.5" y="1041.5" as="sourcePoint"/>
                        <mxPoint x="3484.5" y="1051.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-58" value="2. watchedEvt" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-59" target="YaZeodDi9gsK6JLhhhEP-79" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-59" value="onConnected()&lt;br&gt;1. &lt;b&gt;存起来sessionId和password&lt;/b&gt;&lt;br&gt;2. 包装一个连接状态(connected)的Null事件, 给eventThread" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2010" y="1530" width="170" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-60" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-36" target="YaZeodDi9gsK6JLhhhEP-59" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2105.034482758621" y="1335" as="sourcePoint"/>
                        <mxPoint x="2105.034482758621" y="1357.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-61" value="connectionReq:" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2540" y="1460" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-62" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-63" target="YaZeodDi9gsK6JLhhhEP-66" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-63" value="&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;典型NIO收发包逻辑&lt;/font&gt;&lt;/b&gt;: buffer:&lt;br&gt;4个字节的length+真实数据:&lt;br&gt;这次buffer收不满下次收, 反正只有一个socket.&lt;br&gt;&lt;b&gt;&amp;nbsp;确保拆包粘包问题&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f8cecc;align=left;strokeColor=#b85450;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2481" y="1650" width="140" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-64" value="2. 发送完等待响应" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-66" target="YaZeodDi9gsK6JLhhhEP-45" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-65" value="1. 响应来了&lt;br&gt;处理" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.25;exitDx=0;exitDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-66" target="YaZeodDi9gsK6JLhhhEP-82" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-66" value="doIO() - &lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;普通收发包&lt;/font&gt;&lt;/b&gt;&lt;br&gt;1. 收数据时候: 收满了一条数据的byte, 就会掉sendThread&lt;br&gt;2. 发数据时候: 把数据序列化, 发出去. 如果不是ping之类的无意义请求, 把请求放在pendingQue里面等着响应." style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2270" y="1642.5" width="185" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-67" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-50" target="YaZeodDi9gsK6JLhhhEP-66" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2370" y="1460" as="sourcePoint"/>
                        <mxPoint x="2370" y="1500" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-68" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-69" target="YaZeodDi9gsK6JLhhhEP-88" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-69" value="&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic ; font-family: &amp;#34;courier new&amp;#34; , monospace&quot;&gt;协议版本号&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic&quot;&gt;0, lastZxid, sessionTimeout, sessId, sessionPasswd)&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2610" y="1465" width="310" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-70" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#FF0000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-71" target="YaZeodDi9gsK6JLhhhEP-50" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-71" value="connectionResp" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2540" y="1490" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-72" value="&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic ; font-family: &amp;#34;courier new&amp;#34; , monospace&quot;&gt;协议版本号&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; text-align: center ; color: rgb(140 , 140 , 140) ; font-style: italic&quot;&gt;0, sessionTimeout, sessId, sessionPasswd)&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2610" y="1495" width="310" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-73" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-116" target="YaZeodDi9gsK6JLhhhEP-72" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-74" value="&lt;b&gt;sessionId&lt;/b&gt;:两次握手确认" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2080" y="1115" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-75" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-5" target="YaZeodDi9gsK6JLhhhEP-74" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1985.0344827586207" y="1190" as="sourcePoint"/>
                        <mxPoint x="2030" y="1220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-76" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-5" target="YaZeodDi9gsK6JLhhhEP-77" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2045" y="1160" as="sourcePoint"/>
                        <mxPoint x="2090.0000792708142" y="1155.034482758621" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-77" value="&lt;b&gt;sessionPasswd&lt;/b&gt;" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2080" y="1157.5" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-78" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-79" target="YaZeodDi9gsK6JLhhhEP-81" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-79" value="queueEvent:&lt;br&gt;1. 从watcherMgr里挑出来感兴趣的watcher&lt;br&gt;2. 包装event-watcher入队" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1755" y="1530" width="170" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-80" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-81" target="YaZeodDi9gsK6JLhhhEP-33" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-81" value="waitingEvents:&lt;br&gt;等待处理的" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1630" y="1380" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-82" value="&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;readResponse&lt;/font&gt;&lt;/b&gt;(buffer)&lt;br&gt;TODO&lt;br&gt;&lt;b&gt;1. 如果pendingQue里面没有对应的请求, 就报错!!! 返回到run里面再建立连接.&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2010" y="1610" width="170" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-83" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-59" target="YaZeodDi9gsK6JLhhhEP-82" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2105" y="1420" as="sourcePoint"/>
                        <mxPoint x="2105" y="1540" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-84" value="启动的对应角色的组件" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-85" target="YaZeodDi9gsK6JLhhhEP-119" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-85" value="QuorumPeer:&lt;br&gt;线程, 一个zk服务" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4235.5" y="1638" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-86" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3320" y="1244.64" width="912" height="353.36" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-87" value="&lt;span style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250); display: inline; float: none;&quot;&gt;NioServerCnxnFactory:&lt;/span&gt;&lt;br style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250);&quot;&gt;&lt;span style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 12px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250); display: inline; float: none;&quot;&gt;默认的nioserver&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3720.01" y="1244.64" width="135.99" height="44.36" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-88" value="2181端口" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3238" y="1349.8037290715374" width="131.10000000000005" height="67.8462709284627" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-89" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-90" target="YaZeodDi9gsK6JLhhhEP-99" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-90" value="acceptThread" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3426" y="1306" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-91" value="selectorThreads" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3568" y="1306" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-92" value="exporerThread" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3578" y="1250" width="80" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-93" value="workerPool" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3715" y="1305" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-94" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeWidth=2;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-88" target="YaZeodDi9gsK6JLhhhEP-99" edge="1">
                    <mxGeometry x="3320" y="1241.25" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-95" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-90" target="YaZeodDi9gsK6JLhhhEP-91" edge="1">
                    <mxGeometry x="3320" y="1241.25" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-96" value="检查过期conn" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;startArrow=none;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-92" target="YaZeodDi9gsK6JLhhhEP-91" edge="1">
                    <mxGeometry x="3320" y="1241.25" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-97" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-91" target="YaZeodDi9gsK6JLhhhEP-93" edge="1">
                    <mxGeometry x="3320" y="1241.25" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-98" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=2;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-99" target="YaZeodDi9gsK6JLhhhEP-102" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-99" value="NIO接收新的socket,&amp;nbsp;&lt;br&gt;交给后面的selectorThread" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3406.95" y="1365.3000000000002" width="118.1" height="36.85" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-100" value="处理socket的事情" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3558.95" y="1357" width="118.1" height="15" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-101" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-91" target="YaZeodDi9gsK6JLhhhEP-100" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3476" y="1346" as="sourcePoint"/>
                        <mxPoint x="3475.9666666666667" y="1375.3000000000002" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-102" value="processAcceptedCnxns()&lt;br&gt;1. 为&lt;b&gt;新的socketC包装NioServerCnxn&lt;/b&gt;, 附在selectionKey里面, 记录好.&lt;br&gt;2. 注册到自己的selector上." style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3558.95" y="1372" width="118.1" height="54" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-103" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=2;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-105" target="YaZeodDi9gsK6JLhhhEP-112" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-104" value="为cnxn延期" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-105" target="YaZeodDi9gsK6JLhhhEP-117" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-105" value="select() - loop逻辑&lt;br&gt;1. 把有读写事件的selectionKey包装一下放入第一个worker里面运行&lt;br&gt;2. 同时关闭key的兴趣事件" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3558.95" y="1426" width="118.1" height="54" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-106" value="&lt;font style=&quot;font-size: 9px&quot;&gt;selector&lt;/font&gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;dashed=1;dashPattern=1 1;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3426" y="1335" width="36" height="17" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-107" value="&lt;font style=&quot;font-size: 9px&quot;&gt;selector&lt;/font&gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;dashed=1;dashPattern=1 1;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3576" y="1332.8" width="36" height="17" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-108" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-109" target="YaZeodDi9gsK6JLhhhEP-110" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-109" value="selectionKey" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3579" y="1546" width="79" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-110" value="&lt;b&gt;NIOServerCnxn&lt;/b&gt;:&lt;br&gt;维护一个client连接" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3558.95" y="1615" width="120" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-111" value="&lt;b&gt;最终socket的数据&lt;br&gt;都会来这里&lt;/b&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=2;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-112" target="YaZeodDi9gsK6JLhhhEP-116" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-112" value="第一个worker" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;dashed=1;dashPattern=1 1;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3715" y="1440" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-113" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-93" target="YaZeodDi9gsK6JLhhhEP-112" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3476.0000000000005" y="1346" as="sourcePoint"/>
                        <mxPoint x="3476.083333333333" y="1375.3000000000002" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-114" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-105" target="YaZeodDi9gsK6JLhhhEP-109" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3748" y="1346" as="sourcePoint"/>
                        <mxPoint x="3765.000000000001" y="1450" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-115" value="1.2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-116" target="YaZeodDi9gsK6JLhhhEP-126" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-116" value="doIO(selectionKey)&lt;br&gt;1. 读取事件&lt;br&gt;1,1. 和发送时候一样len+data的nio读取策略&lt;br&gt;&lt;b&gt;1.2 第一个包是握手包, 把buffer发给zkServer&lt;br&gt;1.3 其他的包也把buffer数据交给zkServer&lt;br&gt;&lt;/b&gt;&lt;br&gt;2. 发送事件&lt;br&gt;&lt;b&gt;把outgoingBuffer里面的所有buffer, 都用socket写出去&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3518.29" y="1741" width="201.72" height="143" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-117" value="cnxnExpireQue&lt;br&gt;10s过期" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3499" y="1546" width="79" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-118" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-110" target="YaZeodDi9gsK6JLhhhEP-116" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3627.916666666667" y="1490" as="sourcePoint"/>
                        <mxPoint x="3628.5" y="1556" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-119" value="&lt;b&gt;Leader&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4210" y="1741" width="171" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-120" value="Leader&lt;b&gt;ZookeeperServer&lt;br&gt;处理链条+session管理&lt;br&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3856" y="1897" width="171" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-121" value="zk" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3889" y="1816.5" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-122" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-121" target="YaZeodDi9gsK6JLhhhEP-119" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4180.5" y="1678" as="sourcePoint"/>
                        <mxPoint x="3996.5" y="1678" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-123" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-121" target="YaZeodDi9gsK6JLhhhEP-120" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3901.5" y="1880" as="sourcePoint"/>
                        <mxPoint x="3824.5" y="1505" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-124" value="3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-126" target="YaZeodDi9gsK6JLhhhEP-132" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-125" value="&#10;&#10;&lt;span style=&quot;color: rgb(0, 0, 0); font-family: helvetica; font-size: 9px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline; float: none;&quot;&gt;2. 创建session&lt;/span&gt;&#10;&#10;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-126" target="YaZeodDi9gsK6JLhhhEP-145" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-126" value="processConnectionRequests(cnxn, bytesBuff)&lt;br&gt;1. 反序列化&lt;br&gt;2. 搞一个本地的递增sessionId, 设置好cnxn&lt;br&gt;3. 把信息都包装成一个createSession类型的Request, 放入队列里" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3674" y="2019" width="201.72" height="59" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-127" value="2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-128" target="YaZeodDi9gsK6JLhhhEP-134" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-128" value="submitRequestNow()&lt;br&gt;交给process链条处理:&amp;nbsp;&lt;br&gt;1. &lt;b&gt;touchSession: 延期&lt;/b&gt;.&amp;nbsp;&lt;br&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; color: rgb(135 , 16 , 148)&quot;&gt;2. firstProcessor&lt;/span&gt;&lt;span style=&quot;color: rgb(8 , 8 , 8) ; font-family: &amp;#34;consolas&amp;#34; , monospace&quot;&gt;.processRequest(si);&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3811.64" y="2150" width="201.72" height="58" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-129" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-120" target="YaZeodDi9gsK6JLhhhEP-126" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3915.5" y="1861" as="sourcePoint"/>
                        <mxPoint x="3960" y="1826" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-130" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-126" target="YaZeodDi9gsK6JLhhhEP-128" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3915.5" y="2001" as="sourcePoint"/>
                        <mxPoint x="3917.8999999999996" y="2039" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-131" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-132" target="YaZeodDi9gsK6JLhhhEP-128" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-132" value="&lt;b&gt;RequestThrottler:&lt;br&gt;可以暂时看成阻塞的队列&lt;br&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#82b366;fillColor=none;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3835.5" y="2100" width="154" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-133" value="对于链接握手包&lt;br&gt;几乎没做什么处理" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-134" target="YaZeodDi9gsK6JLhhhEP-137" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-134" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=5;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3701" y="2236.5" width="409" height="74" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-135" value="Leader的链条:&amp;nbsp;&lt;span style=&quot;color: rgb(140 , 140 , 140) ; font-style: italic ; font-family: &amp;#34;consolas&amp;#34; , monospace&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;LeaderRequestProcessor -&amp;gt; prepRequestProcessor -&amp;gt; &lt;br&gt;proposalProcessor -&amp;gt; commitProcessor -&amp;gt; [leader -&amp;gt; finalProcessor]&lt;/font&gt;&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=9;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3734" y="2261" width="373" height="26" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-136" value="握手响应包" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-137" target="YaZeodDi9gsK6JLhhhEP-139" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-137" value="finishSessionInit()&lt;br&gt;1. 把二次握手包组装好, 用递增的sessionId, 算好passwd. 组装好, 放入serverCnxn的&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-family: &amp;#34;consolas&amp;#34; , monospace&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;outgoingBuffers&lt;/font&gt;&lt;/span&gt;&lt;span&gt;队列里. 然后会注册socket的write事件.&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3293.5" y="2243" width="237" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-138" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-139" target="YaZeodDi9gsK6JLhhhEP-116" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-139" value="outgoingBuffer" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3362" y="1675" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-140" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-110" target="YaZeodDi9gsK6JLhhhEP-139" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3629" y="1670" as="sourcePoint"/>
                        <mxPoint x="3628" y="1703" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-141" value="1. 更新session桶" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#b85450;strokeWidth=1;fillColor=#f8cecc;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-128" target="YaZeodDi9gsK6JLhhhEP-145" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4275" y="1938.2499999999995" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-142" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-143" target="YaZeodDi9gsK6JLhhhEP-132" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-143" value="&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;processPacket&lt;/font&gt;&lt;/b&gt;(cnxn, buff) - 处理普通请求&lt;br&gt;1. 反序列化, 交给队列" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3953" y="2019.5" width="201.72" height="41" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-144" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-120" target="YaZeodDi9gsK6JLhhhEP-143" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3915.5172413793107" y="2000.9999999999998" as="sourcePoint"/>
                        <mxPoint x="3915.4482758620697" y="2039.0000000000002" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-145" value="&lt;b&gt;SessionTracker:&lt;br&gt;run: 不断清理过期ses桶&lt;br&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4245" y="1954.75" width="156" height="42" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-146" value="sessionsById&lt;br&gt;&amp;lt;sessId, Session&amp;lt;id, timeout&amp;gt;&amp;gt;" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4206" y="2029.25" width="133" height="39.75" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-147" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-146" target="YaZeodDi9gsK6JLhhhEP-145" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4168.5" y="1985.75" as="sourcePoint"/>
                        <mxPoint x="4241" y="1999.25" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-148" value="sessionExpireQue" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4342" y="2028.25" width="113" height="38.75" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-149" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-148" target="YaZeodDi9gsK6JLhhhEP-145" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4168.5" y="1985.7499999999998" as="sourcePoint"/>
                        <mxPoint x="4255" y="1985.7499999999998" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-150" value="nextSessionId: [8位myId] + [40位timestamp] + [16位0]" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f8cecc;align=left;strokeColor=#b85450;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4427" y="1947" width="236" height="21.5" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-151" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-150" target="YaZeodDi9gsK6JLhhhEP-145" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4424" y="2044.25" as="sourcePoint"/>
                        <mxPoint x="4333" y="2006.75" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-152" value="expireMap&amp;lt;time, set&amp;gt;" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4474" y="2032" width="124" height="31.25" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-153" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-148" target="YaZeodDi9gsK6JLhhhEP-152" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4424" y="2044.25" as="sourcePoint"/>
                        <mxPoint x="4561" y="2048" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-154" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-155" target="YaZeodDi9gsK6JLhhhEP-152" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-155" value="session分桶管理:&lt;br&gt;10s一桶, 因为10s默认timeout" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f8cecc;align=left;strokeColor=#b85450;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4626" y="2032" width="74" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-156" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-158" target="YaZeodDi9gsK6JLhhhEP-160" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-157" value="touch session, 延期" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" parent="YaZeodDi9gsK6JLhhhEP-156" vertex="1" connectable="0">
                    <mxGeometry x="-0.0205" relative="1" as="geometry">
                        <mxPoint x="1" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-158" value="ping请求" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2508" y="1932" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-159" value="更新lastHeard时间戳, 但没有什么用. session再server维护" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-160" target="YaZeodDi9gsK6JLhhhEP-158" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-160" value="ping响应" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3081" y="1968" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-161" value="lastHeard: &lt;br&gt;时间戳: 每次响应更新" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2277" y="1602" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-162" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-50" target="YaZeodDi9gsK6JLhhhEP-161" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2370" y="1560" as="sourcePoint"/>
                        <mxPoint x="2370" y="1652.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-163" value="negotiateSession&lt;br&gt;Timeout:握手拿" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2077" y="1187.5" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-164" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-5" target="YaZeodDi9gsK6JLhhhEP-163" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2045" y="1160" as="sourcePoint"/>
                        <mxPoint x="2090.0000198176836" y="1182.4827586206898" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-165" value="run: 每桶间隔来清理" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeWidth=2;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-145" target="YaZeodDi9gsK6JLhhhEP-148" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-166" value="ConnectionExpirerThread" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#d79b00;fillColor=none;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3888" y="1328.5" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-167" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-169" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2524" y="2029.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-168" value="client这边没有发过请求, 会报错, 重新建立连接走一遍" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" parent="YaZeodDi9gsK6JLhhhEP-167" vertex="1" connectable="0">
                    <mxGeometry x="-0.0662" y="-1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-169" value="sessionTimeout之后:&amp;nbsp;&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-style: italic ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;closeSession&lt;/span&gt;" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3083" y="2014.5" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-170" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-171" target="YaZeodDi9gsK6JLhhhEP-172" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-171" value="run() 清理session会发一个请求, 最终转到zkServer发送一个sessionTimeout的请求.&lt;br&gt;还会经历process队列最终发出去的" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4435" y="1983" width="182" height="31.5" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-172" value="&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-style: italic ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;closeSession&lt;/span&gt;" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4642" y="1983.75" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-173" value="&lt;b&gt;几种典型的包和效果&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="2530" y="1892" width="588" height="19" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-174" value="" style="group" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1" connectable="0">
                    <mxGeometry x="5041" y="2119.5" width="126" height="56" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-175" value="LearnerHandler:&lt;br&gt;满足learner的需求" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-174" vertex="1">
                    <mxGeometry width="117" height="47" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-176" value="LearnerHandler:&lt;br&gt;满足learner的需求" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-174" vertex="1">
                    <mxGeometry x="3" y="3" width="117" height="47" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-177" value="LearnerHandler:&lt;br&gt;满足learner的需求" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-174" vertex="1">
                    <mxGeometry x="6" y="6" width="117" height="47" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-178" value="LearnerHandler:&lt;br&gt;满足learner的需求" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-174" vertex="1">
                    <mxGeometry x="9" y="9" width="117" height="47" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-179" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeColor=#000000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-180" target="YaZeodDi9gsK6JLhhhEP-181" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-180" value="Follower" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5692.5" y="2064" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-181" value="Learner" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5797.5" y="1951" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-182" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeColor=#000000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-183" target="YaZeodDi9gsK6JLhhhEP-181" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-183" value="Observer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5888.5" y="2064" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-184" value="2. 三次握手注册给leader" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=classic;startFill=1;strokeColor=#000000;strokeWidth=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-187" target="YaZeodDi9gsK6JLhhhEP-207" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-185" value="1. 接受follower的注册: 三次握手" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" parent="YaZeodDi9gsK6JLhhhEP-184" vertex="1" connectable="0">
                    <mxGeometry x="0.4769" y="2" relative="1" as="geometry">
                        <mxPoint x="11" y="2" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-186" value="不断地接受leader的消息" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-187" target="YaZeodDi9gsK6JLhhhEP-272" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-187" value="followerLeader()&lt;br&gt;1. 直接拿到vote的leader, 使用BIO的&lt;b&gt;socket&lt;/b&gt;连接, tcpNoDealy之类的参数设一下&lt;br&gt;2. 注册到leader上: 发送sid-zxid, 接收新的zxid" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5597.5" y="2202.5" width="310" height="105" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-188" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-180" target="YaZeodDi9gsK6JLhhhEP-187" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5102.5" y="1397" as="sourcePoint"/>
                        <mxPoint x="5102.5" y="1492" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-189" value="构造器: 创建一个BIOServerSocket, 绑定2888端口" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4488" y="1592.75" width="224" height="41" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-190" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-119" target="YaZeodDi9gsK6JLhhhEP-189" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5124" y="2246" as="sourcePoint"/>
                        <mxPoint x="5153" y="2335" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-191" value="2. 监听" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-192" target="YaZeodDi9gsK6JLhhhEP-195" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-192" value="lead() - 启动方法&lt;br&gt;1. zkServer.loadData. 准备好数据&lt;br&gt;2. 启动2888端口的acceptor&lt;br&gt;3. === 开启新的一轮epoch. TODO&lt;br&gt;..." style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4488" y="1633.75" width="224" height="109.5" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-193" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-189" target="YaZeodDi9gsK6JLhhhEP-192" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5134" y="2256" as="sourcePoint"/>
                        <mxPoint x="5134" y="2314" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-194" value="serverSockets:&lt;br&gt;2888" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4860" y="1798" width="69" height="34" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-195" value="cnxAcceptor" style="ellipse;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4860" y="1822" width="69" height="34" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-196" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-119" target="YaZeodDi9gsK6JLhhhEP-195" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5064" y="2216.0588235294117" as="sourcePoint"/>
                        <mxPoint x="5134" y="2314" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-197" value="LearnerCnxAcceptor&lt;br&gt;处理learner的连接" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4835" y="2019.5" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-198" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.422;entryY=0.45;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=9;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-199" target="YaZeodDi9gsK6JLhhhEP-203" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-199" value="run()&lt;br&gt;1. 接收2888端口的新socket, 包装一个来&lt;span style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;LearnerHandler&lt;/span&gt;&lt;span&gt;维护leader-learner的交流&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5012.5" y="2021.5" width="183" height="56" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-200" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-197" target="YaZeodDi9gsK6JLhhhEP-199" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5378" y="1987.5" as="sourcePoint"/>
                        <mxPoint x="5378" y="2034.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-201" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-197" target="YaZeodDi9gsK6JLhhhEP-195" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5464" y="2286" as="sourcePoint"/>
                        <mxPoint x="5392.5" y="2239" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-202" value="每个learner一个" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-199" target="YaZeodDi9gsK6JLhhhEP-177" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-203" value="2888" style="outlineConnect=0;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;shape=mxgraph.aws3.elastic_network_interface;fillColor=#F58534;gradientColor=none;fontSize=9;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5230.29" y="2030" width="41.21" height="43" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-204" value="TCP连接" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.98;entryY=0.532;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=9;strokeColor=#000000;strokeWidth=1;startArrow=classic;startFill=1;shape=link;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-205" target="YaZeodDi9gsK6JLhhhEP-212" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-205" value="socket" style="aspect=fixed;html=1;points=[];align=center;image;fontSize=12;image=img/lib/mscae/Connection.svg;fillColor=none;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5603.5" y="2136.5" width="50" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-206" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-180" target="YaZeodDi9gsK6JLhhhEP-205" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5762.5" y="2134" as="sourcePoint"/>
                        <mxPoint x="5829.5" y="2143" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-207" value="run()&lt;br&gt;&lt;b&gt;1. 和followersocket打开之后, 马上&quot;三次握手&quot;, 确认folower的zxid, 把自己的zxid发出去&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5017" y="2218.5" width="183" height="56" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-208" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-178" target="YaZeodDi9gsK6JLhhhEP-207" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5114" y="1997" as="sourcePoint"/>
                        <mxPoint x="5114" y="2031.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-209" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-171" target="YaZeodDi9gsK6JLhhhEP-145" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4437" y="1967.75" as="sourcePoint"/>
                        <mxPoint x="4411" y="1985.6666666666665" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-210" value="loadData()&lt;br&gt;1. 检查zkDB是不是初始化好了&lt;br&gt;2. 清理zkDB里面过期session&lt;br&gt;3. 让log组件做一个snapshot" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4054" y="1849" width="188" height="63" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-211" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-210" target="YaZeodDi9gsK6JLhhhEP-120" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3784.8599999999997" y="2088" as="sourcePoint"/>
                        <mxPoint x="3784.8599999999997" y="2139" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-212" value="socket" style="aspect=fixed;html=1;points=[];align=center;image;fontSize=12;image=img/lib/mscae/Connection.svg;fillColor=none;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5153.29" y="2136.5" width="50" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-213" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;startArrow=none;startFill=0;strokeColor=#d79b00;strokeWidth=2;endArrow=none;endFill=0;fillColor=#ffe6cc;dashed=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-13" target="YaZeodDi9gsK6JLhhhEP-214" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1555" y="1095" as="sourcePoint"/>
                        <mxPoint x="1555" y="1155" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-214" value="CRUD/.... 之类的API&lt;br&gt;包装一个Request, 包含类型路径,数据之类的命令." style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="1464" y="1690.5" width="170" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-215" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#FF0000;strokeWidth=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-23" target="YaZeodDi9gsK6JLhhhEP-214" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1304" y="1485" as="sourcePoint"/>
                        <mxPoint x="1910" y="1720" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-216" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-217" target="YaZeodDi9gsK6JLhhhEP-221" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-217" value="&lt;b&gt;LeaderRequestProcessor: 升级本地session&lt;/b&gt;&lt;br&gt;判断是不是创建临时节点并且是本地session.&lt;br&gt;是的话就升级" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3708" y="2318" width="190.72" height="37" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-218" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-219" target="YaZeodDi9gsK6JLhhhEP-229" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-219" value="&lt;b&gt;PrepRequestProcessor: 创建事务&lt;br&gt;run()&lt;br&gt;1. 给request创建下一个zxid的transaction&lt;br&gt;2. 把当前node和parentNode的两条changeRecord加入到zkServer里面的outstandingChanges&lt;/b&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3708" y="2399" width="190.72" height="69" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-220" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontSize=9;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-221" target="YaZeodDi9gsK6JLhhhEP-219" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-221" value="submittedRequests&lt;br&gt;阻塞队列" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3965" y="2368" width="133" height="39.75" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-222" value="outstandingChanges" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3715" y="1926" width="107.86" height="36" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-223" value="hzxid" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3715" y="1890" width="107.86" height="36" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-224" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-120" target="YaZeodDi9gsK6JLhhhEP-222" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3951.51724137931" y="1967" as="sourcePoint"/>
                        <mxPoint x="3784.8275862068967" y="2029" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-225" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-120" target="YaZeodDi9gsK6JLhhhEP-223" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3866" y="1937.034482758621" as="sourcePoint"/>
                        <mxPoint x="3832.8600000000006" y="1954" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-226" value="2.1&lt;br&gt;等待" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-229" target="YaZeodDi9gsK6JLhhhEP-239" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-227" value="2.2 给所有的learner发出去" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-229" target="YaZeodDi9gsK6JLhhhEP-241" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-228" value="2.3 刷盘" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;startArrow=none;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-229" target="YaZeodDi9gsK6JLhhhEP-250" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-229" value="&lt;b&gt;ProposalProcessor: 简单分发&lt;br&gt;1. 对于learner的同步请求,, 给leader执行sync&lt;br&gt;2. 对于leader的客户端的请求&lt;br&gt;2.1 交给commitProfessor&lt;br&gt;2.2 交给leader做propose()&lt;br&gt;2.3 交给syncProcessor加入DB+刷盘&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3708" y="2518" width="190.72" height="69" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-230" value="&lt;b&gt;&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4110" y="2777" width="388" height="158" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-231" value="queueRequests" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4222" y="2874" width="95" height="29" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-232" value="queueWriteRequests" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4219" y="2903" width="114" height="29" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-233" value="&lt;b style=&quot;color: rgb(0 , 0 , 0) ; font-family: &amp;#34;helvetica&amp;#34; ; font-size: 9px ; font-style: normal ; letter-spacing: normal ; text-align: left ; text-indent: 0px ; text-transform: none ; word-spacing: 0px ; background-color: rgb(255 , 255 , 255)&quot;&gt;CommitProfessor: &lt;/b&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0) ; font-family: &amp;#34;helvetica&amp;#34; ; font-size: 9px ; font-style: normal ; letter-spacing: normal ; text-align: left ; text-indent: 0px ; text-transform: none ; word-spacing: 0px ; background-color: rgb(255 , 255 , 255)&quot;&gt;把请求添加到队列里, write请求多添加到write队列里&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4190.5" y="2777" width="151.5" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-234" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-235" target="YaZeodDi9gsK6JLhhhEP-264" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-235" value="commitedReqs" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4367" y="2798" width="95" height="29" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-236" value="" style="shape=image;verticalLabelPosition=bottom;labelBackgroundColor=#ffffff;verticalAlign=top;aspect=fixed;imageAspect=0;image=https://img2018.cnblogs.com/blog/846961/201906/846961-20190605004041459-1894253433.png;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3113" y="3098.25" width="695.56" height="519" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-237" value="1. 所有req" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-239" target="YaZeodDi9gsK6JLhhhEP-231" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-238" value="2需要commit" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-239" target="YaZeodDi9gsK6JLhhhEP-232" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-239" value="&lt;b&gt;processRequest:&lt;/b&gt;&lt;br&gt;1. 加入queueRequests里&lt;br&gt;2. 需要commit的request加入到writeQueue里" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4110" y="2834.5" width="125.5" height="43" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-240" value="发给所有learner" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-241" target="YaZeodDi9gsK6JLhhhEP-243" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-241" value="propose(req)&lt;br&gt;1. 把request包装一个&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-style: italic ; font-family: &amp;#34;consolas&amp;#34; , monospace&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;PROPOSAL&lt;/font&gt;&lt;/span&gt;&lt;span&gt;的package&lt;/span&gt;&lt;br&gt;2. 发给所有的learnerHandler" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4674" y="2377.87" width="176.86" height="42" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-242" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-243" target="YaZeodDi9gsK6JLhhhEP-272" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-243" value="&lt;b&gt;queuePackage(package)&lt;br&gt;添加pacakge到发送队列&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5017" y="2363.87" width="183" height="56" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-244" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-207" target="YaZeodDi9gsK6JLhhhEP-243" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5118.5" y="2185.4999999999995" as="sourcePoint"/>
                        <mxPoint x="5118.5" y="2228.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-245" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-119" target="YaZeodDi9gsK6JLhhhEP-241" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4391" y="1781" as="sourcePoint"/>
                        <mxPoint x="4904.499999999999" y="1832" as="targetPoint"/>
                        <Array as="points">
                            <mxPoint x="4751" y="1771"/>
                            <mxPoint x="4751" y="2399"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-246" value="3. commit刷盘" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-248" target="YaZeodDi9gsK6JLhhhEP-255" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-247" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-248" target="YaZeodDi9gsK6JLhhhEP-258" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-37" value="定期定数据量做snapshot" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeColor=#000000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-248" target="YaZeodDi9gsK6JLhhhEP-255" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-248" value="&lt;b&gt;&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4165" y="2616" width="330" height="123.5" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-249" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-250" target="YaZeodDi9gsK6JLhhhEP-253" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-250" value="queueRequests" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4173" y="2680.5" width="95" height="29" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-251" value="&lt;span style=&quot;font-size: 9px ; font-style: normal ; letter-spacing: normal ; text-align: left ; text-indent: 0px ; text-transform: none ; word-spacing: 0px ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font face=&quot;helvetica&quot; style=&quot;color: rgb(0 , 0 , 0) ; font-weight: bold&quot;&gt;SyncProfessor: &lt;/font&gt;&lt;br&gt;&lt;font face=&quot;helvetica&quot;&gt;&lt;font color=&quot;#ff0000&quot;&gt;size+count+flushDelay来判断隔一会调用ZKDatabase.commit刷盘&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4245.5" y="2616" width="151.5" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-252" value="2. append追加" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-253" target="YaZeodDi9gsK6JLhhhEP-255" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-253" value="&lt;b&gt;run()&lt;br&gt;1. 从queue中阻塞(timeout)拿requ&lt;br&gt;2. 把req塞入zkDatabase.append追加log, 定时做snapshot&lt;br&gt;3. 隔一会掉ZKDB.commit, 然后交给下一个processor处理.&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4294.28" y="2660.5" width="190.72" height="69" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-254" value="syncProcessor" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3936.5" y="2593" width="95" height="29" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-255" value="zkDb" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4682" y="2649" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-256" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-229" target="YaZeodDi9gsK6JLhhhEP-254" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3908.7199999999993" y="2562.500000000001" as="sourcePoint"/>
                        <mxPoint x="3994" y="2667.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-257" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-258" target="YaZeodDi9gsK6JLhhhEP-261" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-258" value="&lt;span style=&quot;font-size: 9px ; font-style: normal ; letter-spacing: normal ; text-align: left ; text-indent: 0px ; text-transform: none ; word-spacing: 0px ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font face=&quot;helvetica&quot;&gt;&lt;b&gt;AckRequestProcessor:&lt;br&gt;&lt;/b&gt;直接调leader.processAck&lt;br&gt;&lt;/font&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4455" y="2533" width="151.5" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-259" value="2.1 票数够了, 可以commit了" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-261" target="YaZeodDi9gsK6JLhhhEP-243" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-260" value="2.2 提交req,&amp;nbsp;&lt;br&gt;已经多数写了" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-261" target="YaZeodDi9gsK6JLhhhEP-235" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4380" y="2964" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-261" value="processAck(myid, zxid)&lt;br&gt;1. 把proposal从队列里拿出来, 给它投一个server的sid票&lt;br&gt;2. 如果票数够了,&amp;nbsp;&lt;br&gt;2.1, 给所有的follower发送commit的package&lt;br&gt;2.2 调用本身的commitProcessor来提交zxid" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4649.43" y="2447" width="226" height="59" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-262" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-241" target="YaZeodDi9gsK6JLhhhEP-261" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="3908.7200000000003" y="2562.5714285714294" as="sourcePoint"/>
                        <mxPoint x="3995.25" y="2667.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-263" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-264" target="YaZeodDi9gsK6JLhhhEP-269" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-264" value="&lt;font face=&quot;helvetica&quot;&gt;&lt;b&gt;run:&lt;br&gt;&lt;/b&gt;&lt;/font&gt;1. 从commitedReq里面拿提交的req&lt;br&gt;2. 维护几个queue&lt;br&gt;3. 把commited好的req通过worker发给下一个processor" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4336.5" y="2854" width="155" height="64" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-265" value="&lt;pre style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;FinalProcessor&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4172" y="3024" width="164" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-266" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-269" target="YaZeodDi9gsK6JLhhhEP-139" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-267" value="响应" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="YaZeodDi9gsK6JLhhhEP-266" vertex="1" connectable="0">
                    <mxGeometry x="-0.6913" y="-2" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-268" value="2. 处理这条txn,到内存数据库里" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeColor=#FF0000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-269" target="YaZeodDi9gsK6JLhhhEP-255" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-269" value="&lt;b&gt;processRequest:&lt;/b&gt;&lt;br&gt;1. 根据请求的类型, 调用/包装返回 响应&lt;br&gt;2. 调用ZKDB.procesTxn, 把数据搞到内存数据库里" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4172" y="3057" width="164.5" height="43" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-270" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-272" target="YaZeodDi9gsK6JLhhhEP-243" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-271" value="proposal, commit 请求&amp;amp;响应" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="YaZeodDi9gsK6JLhhhEP-270" vertex="1" connectable="0">
                    <mxGeometry x="0.2118" y="1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-272" value="processPacket(quorumPacket):&lt;br&gt;1. 如果是proposal的请求: 大概干的事情流程&lt;br&gt;1.1 使用&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;syncProcessor&lt;/span&gt;&lt;span&gt;&amp;nbsp;刷盘&lt;br&gt;&lt;/span&gt;1.2 刷盘完成后, 交给ackProcessor给响应&lt;br&gt;2. 如果是commit请求,&amp;nbsp;&lt;br&gt;&amp;nbsp;交给follower的&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;commitProcessor&lt;/span&gt;&lt;span&gt;来处理,&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5597.5" y="2368" width="310" height="105" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-273" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-274" target="YaZeodDi9gsK6JLhhhEP-258" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-274" value="&lt;font color=&quot;#ff0000&quot;&gt;&lt;b&gt;事务顺序保证&lt;/b&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f8cecc;align=left;strokeColor=#b85450;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4498.25" y="2470" width="65" height="23" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-275" value="&lt;b&gt;ZKDatabase&lt;/b&gt;:&amp;nbsp;&lt;br&gt;维护内存数据, session, committedLog" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5284" y="2729.5" width="173" height="58.5" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-276" target="WTuq9ii3-j0sf-YxppwB-9" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-276" value="append(request)&lt;br&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5257.5" y="2844" width="226" height="59" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-277" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="6259" y="2840" width="170" height="119" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-279" value="snapshot" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="6304" y="2840" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-280" value="acceptEpoch" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="6403" y="2830.5" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-282" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-275" target="YaZeodDi9gsK6JLhhhEP-276" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="4772.4285714285725" y="2429.87" as="sourcePoint"/>
                        <mxPoint x="4772.4285714285725" y="2457" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-12" value="强制刷新: flush" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-283" target="WTuq9ii3-j0sf-YxppwB-13" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-283" value="commit()" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5257.5" y="2955" width="226" height="59" as="geometry"/>
                </mxCell>
                <mxCell id="YaZeodDi9gsK6JLhhhEP-284" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-276" target="YaZeodDi9gsK6JLhhhEP-283" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5380.5" y="2798" as="sourcePoint"/>
                        <mxPoint x="5380.5" y="2854" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeColor=#000000;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="mgQOWUdgJ6TsyV3sW42H-0" target="WTuq9ii3-j0sf-YxppwB-23" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="mgQOWUdgJ6TsyV3sW42H-0" value="processTxn()&lt;br&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5257.5" y="3052" width="226" height="59" as="geometry"/>
                </mxCell>
                <mxCell id="mgQOWUdgJ6TsyV3sW42H-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF0000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="mgQOWUdgJ6TsyV3sW42H-1" target="YaZeodDi9gsK6JLhhhEP-269" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="mgQOWUdgJ6TsyV3sW42H-1" value="&lt;b&gt;过半写之后才会走到这个刷到内存数据库里.&lt;br&gt;所以没有问题, 保证数据最终一致性&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f8cecc;align=left;strokeColor=#b85450;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="4173" y="3200" width="161.5" height="39" as="geometry"/>
                </mxCell>
                <mxCell id="mgQOWUdgJ6TsyV3sW42H-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-283" target="mgQOWUdgJ6TsyV3sW42H-0" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5380.5" y="2913" as="sourcePoint"/>
                        <mxPoint x="5380.5" y="2965" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="KmNt3pcAO71auywewYgS-0" value="snapLog" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5539" y="2759" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="KmNt3pcAO71auywewYgS-2" value="一对一" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-275" target="KmNt3pcAO71auywewYgS-0" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5380.499999999999" y="2797.9999999999995" as="sourcePoint"/>
                        <mxPoint x="5380.499999999999" y="2854" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="KmNt3pcAO71auywewYgS-4" value="&lt;b&gt;FileTxnSnapLog&lt;/b&gt;&lt;br&gt;维护txnLog, snapshot文件" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5670" y="2751.5" width="173" height="58.5" as="geometry"/>
                </mxCell>
                <mxCell id="KmNt3pcAO71auywewYgS-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="KmNt3pcAO71auywewYgS-4" target="KmNt3pcAO71auywewYgS-0" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5467" y="2768.764705882353" as="sourcePoint"/>
                        <mxPoint x="5517.0000427186305" y="2791.470588235294" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="KmNt3pcAO71auywewYgS-6" value="dataTree" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5577" y="3098.25" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="KmNt3pcAO71auywewYgS-7" value="&lt;b&gt;DataTree&lt;br&gt;树状数据+hash映射&lt;br&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5746" y="3095.25" width="173" height="58.5" as="geometry"/>
                </mxCell>
                <mxCell id="KmNt3pcAO71auywewYgS-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeWidth=2;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="KmNt3pcAO71auywewYgS-7" target="KmNt3pcAO71auywewYgS-6" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5759" y="3250.514705882353" as="sourcePoint"/>
                        <mxPoint x="5686.999957281369" y="3251.220588235294" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="KmNt3pcAO71auywewYgS-9" value="一对一" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="YaZeodDi9gsK6JLhhhEP-275" target="KmNt3pcAO71auywewYgS-6" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5467" y="2768.764705882353" as="sourcePoint"/>
                        <mxPoint x="5549.0000427186305" y="2791.470588235294" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#000000;endArrow=none;endFill=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="KmNt3pcAO71auywewYgS-10" target="KmNt3pcAO71auywewYgS-12" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="KmNt3pcAO71auywewYgS-10" value="fileTxnLog" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5933" y="2759" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="KmNt3pcAO71auywewYgS-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="KmNt3pcAO71auywewYgS-4" target="KmNt3pcAO71auywewYgS-10" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5467" y="2768.764705882353" as="sourcePoint"/>
                        <mxPoint x="5549.0000427186305" y="2791.470588235294" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="KmNt3pcAO71auywewYgS-12" value="&lt;b&gt;FileTxnLog&lt;/b&gt;&lt;br&gt;维护txnLog, 创建新的log文件" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5896.5" y="2827" width="173" height="58.5" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-11" value="写入" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="WTuq9ii3-j0sf-YxppwB-9" target="WTuq9ii3-j0sf-YxppwB-13" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-9" value="append(request)&lt;br&gt;如果没有, 就创建新的log文件,&amp;nbsp;&lt;br&gt;序列化, 写入record" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5872" y="2903" width="226" height="59" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="WTuq9ii3-j0sf-YxppwB-13" target="WTuq9ii3-j0sf-YxppwB-0" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-13" value="&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;文件buff&lt;/b&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="6128" y="2966" width="68" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-16" value="刷盘, 断掉" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="WTuq9ii3-j0sf-YxppwB-15" target="WTuq9ii3-j0sf-YxppwB-13" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-15" value="rollLog: 新文件&lt;br&gt;synchronized: 把文件输出flush流断掉, 置为null.&amp;nbsp;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5874.5" y="3001" width="217" height="35" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="KmNt3pcAO71auywewYgS-12" target="WTuq9ii3-j0sf-YxppwB-9" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5853" y="2790.8" as="sourcePoint"/>
                        <mxPoint x="5943" y="2791.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="WTuq9ii3-j0sf-YxppwB-9" target="WTuq9ii3-j0sf-YxppwB-15" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5993" y="2895.5" as="sourcePoint"/>
                        <mxPoint x="5999" y="2906" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-19" value="nodes: hash" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5937" y="3150.25" width="86.5" height="31.25" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-20" value="&lt;pre style=&quot;background-color: #ffffff ; color: #080808 ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9.0pt&quot;&gt;DataNode构成树&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5941.75" y="3153.75" width="73" height="52" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-21" value="dataWathces" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5937" y="3115.25" width="82.5" height="35" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=6;" parent="YaZeodDi9gsK6JLhhhEP-1" source="WTuq9ii3-j0sf-YxppwB-22" target="WTuq9ii3-j0sf-YxppwB-3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-22" value="childWatches" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5937.5" y="3080" width="81.5" height="35.25" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-31" value="创建" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="YaZeodDi9gsK6JLhhhEP-1" source="WTuq9ii3-j0sf-YxppwB-23" target="WTuq9ii3-j0sf-YxppwB-26" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-23" value="processTxn(hdr, record, digest)&lt;br&gt;按照hdr的请求类型. 对node树做相应的处理" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f8cecc;align=left;strokeColor=#b85450;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5737" y="3185" width="191" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-25" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="WTuq9ii3-j0sf-YxppwB-23" target="KmNt3pcAO71auywewYgS-7" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5995.028571428571" y="2972" as="sourcePoint"/>
                        <mxPoint x="5993.028571428571" y="3011" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="WTuq9ii3-j0sf-YxppwB-26" target="WTuq9ii3-j0sf-YxppwB-19" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeColor=#000000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="WTuq9ii3-j0sf-YxppwB-26" target="WTuq9ii3-j0sf-YxppwB-21" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeColor=#000000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="WTuq9ii3-j0sf-YxppwB-26" target="WTuq9ii3-j0sf-YxppwB-22" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-26" value="createNode: 检查, 校验, 添加datanode 发送事件" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5957" y="3300" width="191" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-27" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="KmNt3pcAO71auywewYgS-7" target="WTuq9ii3-j0sf-YxppwB-22" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5842.5142857142855" y="3195" as="sourcePoint"/>
                        <mxPoint x="5842.5142857142855" y="3163.75" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-34" value="fileSnap" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5869" y="2680.5" width="100" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-35" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="KmNt3pcAO71auywewYgS-4" target="WTuq9ii3-j0sf-YxppwB-34" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5853" y="2790.8" as="sourcePoint"/>
                        <mxPoint x="5943" y="2791.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="aMZuB9BBuo7aXKJsqL40-1" value="写snapshot" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endArrow=classic;endFill=1;strokeColor=#000000;strokeWidth=2;" parent="YaZeodDi9gsK6JLhhhEP-1" source="WTuq9ii3-j0sf-YxppwB-38" target="WTuq9ii3-j0sf-YxppwB-45" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-38" value="save(dataTree, sessions,issync-false)&lt;br&gt;最终就是把两个东西保存到文件里:&lt;br&gt;1. sessionMap&lt;br&gt;2. 迭代保存所有的dataNode" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5643" y="2578" width="226" height="59" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-39" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;fillColor=#ffe6cc;" parent="YaZeodDi9gsK6JLhhhEP-1" source="KmNt3pcAO71auywewYgS-4" target="WTuq9ii3-j0sf-YxppwB-38" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="5853" y="2790.75" as="sourcePoint"/>
                        <mxPoint x="5929" y="2735.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;strokeColor=#000000;" parent="YaZeodDi9gsK6JLhhhEP-1" source="WTuq9ii3-j0sf-YxppwB-40" target="WTuq9ii3-j0sf-YxppwB-38" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-40" value="&lt;b&gt;一个peer一个SyncProcessor, 控制单线程, ZKDB和dataTree都不修改了, 做snapshot&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f8cecc;align=left;strokeColor=#b85450;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="5382" y="2589" width="145.75" height="37" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-45" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;snapDir/snapshot.最后txid&lt;br&gt;&lt;/b&gt;头[magic, version, dbid]&lt;br&gt;sessionMap: [count, &amp;lt;id, timeout&amp;gt;]&lt;br&gt;acls: [count, &amp;lt;key, listsize....&amp;gt;]&lt;br&gt;dataNodes: [path, 数据]/&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="6273" y="2870" width="156" height="69" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-46" value="process(event)&lt;br&gt;给对应client发送一个event" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=none;align=left;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="3560" y="1685" width="114" height="31.5" as="geometry"/>
                </mxCell>
                <mxCell id="WTuq9ii3-j0sf-YxppwB-3" value="processEvent:&lt;br&gt;调用所有的serverCnxn, 最终会给前面的client发送&lt;span style=&quot;color: rgb(135 , 16 , 148) ; font-style: italic ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 9pt&quot;&gt;NOTIFICATION_XID&lt;/span&gt;&lt;span&gt;消息!&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f8cecc;align=left;strokeColor=#b85450;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="6128" y="3131" width="191" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="aMZuB9BBuo7aXKJsqL40-0" value="currentEpoch" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;arcSize=0;" parent="YaZeodDi9gsK6JLhhhEP-1" vertex="1">
                    <mxGeometry x="6403" y="2849.5" width="80" height="20" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram id="0C3ofVfqoXwycrIabIaV" name="ZK7. CRUD流程+监听机制">
        <mxGraphModel dx="1694" dy="790" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="850" math="0" shadow="0">
            <root>
                <mxCell id="VY3EVsiPWpCW4jtRlPIs-0"/>
                <mxCell id="VY3EVsiPWpCW4jtRlPIs-1" parent="VY3EVsiPWpCW4jtRlPIs-0"/>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>