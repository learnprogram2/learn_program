![img](协程调度GMP.assets/1650776301442-fb76123c-8d0e-4375-af35-b5728a5b1bc7.jpeg)



M与P的数量没有绝对关系，一个M阻塞，P就会去创建或者切换另一个M，所以，即使P的默认数量是1，也有可能会创建很多个M出来。

1、P何时创建：在确定了P的最大数量n后，运行时系统会根据这个数量创建n个P。

2、M何时创建：没有足够的M来关联P并运行其中的可运行的G。比如所有的M此时都阻塞住了，而P中还有很多就绪任务，就会去寻找空闲的M，而没有空闲的，就会去创建新的M。



**抢占**：co-routine需要主动让出，别的协程才能执行。goroutine最长占用cpu时间10ms，防止其他goroutine被饿死。







### go func()执行

![img](协程调度GMP.assets/1650776333419-50d3a922-bd53-4bff-b0b6-280e6abc5d74.jpeg)





















