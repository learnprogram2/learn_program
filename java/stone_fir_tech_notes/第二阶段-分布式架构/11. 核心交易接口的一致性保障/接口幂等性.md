## 01. 接口幂等性是什么? **幂等性就是数据一致性的保证**

**幂等性就是数据一致性的保证**



**唯一索引方案: 关键三点:** 

1. 唯一标识: 请求ID/订单ID
2. 流程状态标识: 是否已支付, 是否已流转.
3. 接口的幂等性校验逻辑.





## 常见接口幂等性方案

1. **业务表内唯一索引(常用)**

   **在业务表中维护唯一索引(去重和处理)**, 比如在出库系统内为销售订单ID创建唯一索引, 那么一个订单只能有一个出库记录了.

   - 常见插入操作, 关键数据系统

2. 业务表内状态机

   - **状态流转**

     update order set status = “待发货” where status = “待付款” and id = 1

3. 基于版本更新(不太常用, 调用方要先查version, 麻烦一些)

   状态机里面的校验条件改成版本就对了.

4. mysql的去重表:

   - 并发量<1000, 就挺优秀的.
   - **把请求参数拼接一个string, 然后插入表中, 如果插入成功说明第一次, 失败说明之前有过.**

5. redis/zk的去重

   redis中比较常用, 比mysql**并发好.**

   **可以基于时间段的, 方便干掉过期数据.**





## 前端创建订单的幂等性

**一个请求一个唯一ID. 如果这个请求重试过那不影响创建的幂等性.**

- **后端把requestID存在订单里面**































