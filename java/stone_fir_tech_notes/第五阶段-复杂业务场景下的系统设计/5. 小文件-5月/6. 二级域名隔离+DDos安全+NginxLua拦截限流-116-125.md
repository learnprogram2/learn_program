

### 16. 独立二级域名 隔离 秒杀系统 和电商系统

mall.zhss.com/order，mall.zhss.com/seckill **可以把URL二级域名`mall.web.com`解析到一个单独的秒杀的LVS+Nginx上面.**

- **商城域名：**mall.zhss.com

- **秒杀系统：**seckill.zhss.com

1. **秒杀系统的二级域名对接DNS到单独秒杀的LVS+Nginx服务器上, 秒杀抢购的URL地址是独立域名下的地址.**

### 118. 独立的秒杀域名解析到CDN产品 必要性: 省公网LVS的带宽.

- 争取过滤一些静态文件啊什么的, 避免占用Nginx服务器的带宽.

**nginx需要公网带宽, 很贵, 也尽量少的把静态资源的流量导到我们Nginx上.  尽量在CDN上面放置.**

但是防止CDN的Ddos攻击, 防止CDN没有拦住的请求达到Nginx上, 会把Nginx服务器流量占满, 搞光.





### 119. DDOS高防产品防止黑客

- **DDOS攻击: 灌流量**
- **危害:** 会把CDN的流量都消耗光, 然后打到我们的Nginx服务器上.
- **需要把CDN对接到DDOS高防产品上**
- 独立二级域名解析到DDoS高防产品去，DDoS高防产品的源站地址解析到SLB上去

![点击放大](6.%20%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8D%E9%9A%94%E7%A6%BB+DDos%E5%AE%89%E5%85%A8-116-125.assets/zh-cn_image_0000001123525999.png)



### 121. 云厂商验证码 拦截 黄牛和黑客

**验证码机制, 前端滑动提交一大堆的行为: ** 

o  浏览器名称、版本

o  操作系统

o  屏幕长宽

o  鼠标点击、移动

o  键盘敲击

o  屏幕滑动轨迹

o  URL

o  是否安装Flash

- **验证码服务基于大数据和AI验证是否合法**

- **Nginx在Lua脚本中调用验证码服务, 校验请求是否合法**



### 122. 开发 反作弊机制 的服务, Nginx+lua 调用拦截

**反作弊机制，往往都是要依赖大数据分析手段的，对账号过往日常行为进行分析，然后封禁账号，或者是让nginx调用反作弊接口，判定请求是否合理，这就可以过滤掉一大批作弊请求了**

- 分析黑产, 过多请求, 不符合要求的用户. 暴露服务
- **Nginx+Lua 调用校验 用户请求是否符合要求**

 





### 123. Nginx+Lua 秒杀请求限流: 阻止注定抢不到的请求

一定要在Nginx环节, 基于Lua脚本做一个秒杀系统整体性的限流, 一共有300件商品, 就不要放过过多的请求了.

- **令牌桶算法:** 队列/其他的数据结构来实现.



### 125. Nginx+Lua定制完整业务限流服务







![秒杀系统架构图 (6.%20%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8D%E9%9A%94%E7%A6%BB+DDos%E5%AE%89%E5%85%A8-116-125.assets/%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E5%9B%BE%20(1).png)](116~125%E8%B5%84%E6%96%99/125_%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8ENginx+Lua%E5%AE%9E%E7%8E%B0%E4%B8%80%E5%A5%97%E4%B8%9A%E5%8A%A1%E9%99%90%E6%B5%81%E6%9C%BA%E5%88%B6/%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E5%9B%BE%20(1).png)



![image-20210620180813256](6.%20%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8D%E9%9A%94%E7%A6%BB+DDos%E5%AE%89%E5%85%A8-116-125.assets/image-20210620180813256.png)





















